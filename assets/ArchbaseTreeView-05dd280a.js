import{j as c,a as le}from"./jsx-runtime-c9381026.js";import{a as ce}from"./lodash-4d0be66a.js";import{r as n}from"./index-8b3efc3f.js";import"./index-9e992aa6.js";import{u as Ae}from"./useArchbaseTheme-1c7b72e2.js";import{u as me}from"./use-force-update-11fe72c1.js";import{A as J}from"./ActionIcon-fece95f6.js";import{c as ye}from"./createReactComponent-60e598cf.js";import{I as Ie}from"./IconChevronRight-7b46ea5c.js";import{I as Se}from"./IconChevronDown-98fe7a40.js";import{S as we}from"./Space-934b0343.js";import{T as _e}from"./Text-55a07f1f.js";import{u as $e}from"./use-mantine-color-scheme-dd296b2f.js";import{r as fe}from"./polymorphic-factory-0a97ecf2.js";var Ee=ye("square-check","IconSquareCheck",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M9 12l2 2l4 -4",key:"svg-1"}]]),Be=ye("square","IconSquare",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]);const W=({node:s,options:i,level:E,onSelectedStatusChanged:k,onExpandedCollapsedChanged:C,onFocusedChanged:V,getFocused:x,onNodeDoubleClicked:q,onLoadDataSource:B,addNode:I,removeNode:M,id:j,customRenderText:S,update:D})=>{const[h,T]=n.useState(!1),[f,w]=n.useState(!1),_=me(),A=n.useCallback(d=>{const y=!h;T(y),C(s.id,y),d.stopPropagation()},[h,s.id,C,s.state.expanded]);n.useEffect(()=>{s.state&&T(s.state.expanded),s.state&&w(s.state.selected)},[s.state.expanded,s.state.selected]);const N=n.useCallback(d=>{const y=!f;w(y),k(s.id,y),d.stopPropagation(),_()},[f,s.id,k,s.state.selected]),P=n.useCallback(d=>{V(s.id),_(),d.stopPropagation()},[s.id,V]),R=n.useCallback(d=>{q(s.id,f),d.stopPropagation()},[s.id,f,q]),p=n.useMemo(()=>{const d={};return i.highlightSelected&&f?(d.color=i.selectedColor,d.backgroundColor=i.selectedBackgroundColor):(d.color=s.color||i.color,d.backgroundColor=s.backgroundColor||i.backgroundColor),d},[f,s,i]),z=n.useMemo(()=>{if(i.selectable)return f?c(J,{onClick:N,variant:"transparent",children:c(Ee,{size:"1.2rem",style:p})}):c(J,{onClick:N,variant:"transparent",children:c(Be,{size:"1.2rem",style:p})})},[i.selectable,f,p,N]),F=n.useMemo(()=>{var d;return h?((d=s.state)==null?void 0:d.loading)===!0?c("i",{style:{...p,width:"1rem"},className:"svg-inline--fa fa-spinner fa-w-16 fa-spin fa-lg"}):c(J,{onClick:A,variant:"transparent",children:c(Se,{size:"1.2rem",style:{...p}})}):c(J,{onClick:A,variant:"transparent",children:c(Ie,{size:"1.2rem",style:{...p}})})},[h,f,s,p,A,N]),L=n.useMemo(()=>{const d=x();return d&&d.id===s.id?{color:i.focusedColor,backgroundColor:i.focusedBackgroundColor}:{}},[s.id,x,i.focusedColor,i.focusedBackgroundColor,h,f]),u=n.useMemo(()=>{const d=[];return s.nodes&&s.state.expanded&&s.nodes.forEach(y=>{d.push(c(W,{id:`${i.id}_${y.id}`,node:y,level:E+1,onSelectedStatusChanged:k,onExpandedCollapsedChanged:C,onFocusedChanged:V,getFocused:x,onNodeDoubleClicked:q,addNode:I,removeNode:M,options:i,onLoadDataSource:B,customRenderText:S,update:D},y.id))}),d},[s.nodes,s.state,s,h,f,E,k,C,V,x,q,I,M,i,D]);return le("li",{style:p,onDoubleClick:R,id:j,children:[le("div",{style:{display:"flex"},children:[s.isleaf?c(we,{w:"md"}):F,z,le("span",{style:{...L,display:"flex"},className:"archbase-treeview-item",onClick:P,children:[s.icon,s.image?c("img",{alt:"",style:{padding:"0.2rem"},src:s.image}):null,S?S(s):c(_e,{truncate:!0,children:s.text})]})]}),c("ul",{children:u})]},`${i.id}_${s.id}`)};try{W.displayName="ArchbaseTreeViewItem",W.__docgenInfo={description:"",displayName:"ArchbaseTreeViewItem",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"ArchbaseTreeNode"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"ArchbaseTreeViewOptions"}},level:{defaultValue:null,description:"",name:"level",required:!0,type:{name:"number"}},onLoadDataSource:{defaultValue:null,description:"",name:"onLoadDataSource",required:!0,type:{name:"(id: string) => void"}},onSelectedStatusChanged:{defaultValue:null,description:"",name:"onSelectedStatusChanged",required:!0,type:{name:"(id: string, selected: boolean) => void"}},onExpandedCollapsedChanged:{defaultValue:null,description:"",name:"onExpandedCollapsedChanged",required:!0,type:{name:"(id: string, expanded: boolean) => void"}},onFocusedChanged:{defaultValue:null,description:"",name:"onFocusedChanged",required:!0,type:{name:"(id: string) => void"}},getFocused:{defaultValue:null,description:"",name:"getFocused",required:!0,type:{name:"() => ArchbaseTreeNode"}},onNodeDoubleClicked:{defaultValue:null,description:"",name:"onNodeDoubleClicked",required:!0,type:{name:"(id: string, selected: boolean) => void"}},addNode:{defaultValue:null,description:"",name:"addNode",required:!0,type:{name:"(id: string, text: string) => void"}},removeNode:{defaultValue:null,description:"",name:"removeNode",required:!0,type:{name:"(id: string) => void"}},customRenderText:{defaultValue:null,description:"",name:"customRenderText",required:!1,type:{name:"(node: ArchbaseTreeNode) => ReactNode"}},update:{defaultValue:null,description:"",name:"update",required:!0,type:{name:"number"}}}}}catch{}const pe=({id:s,selectable:i=!0,color:E="#428bca",backgroundColor:k,borderColor:C,hoverColor:V,hoverBackgroundColor:x="#e7f4f9",focusedColor:q,focusedBackgroundColor:B,selectedColor:I,selectedBackgroundColor:M="auto",iconColor:j="black",iconBackgroundColor:S,enableLinks:D=!1,highlightSelected:h=!0,withBorder:T=!0,showTags:f=!1,onDoubleClick:w,onFocusedNode:_,onLoosedFocusNode:A,onSelectedNode:N,onUnSelectedNode:P,onRemovedNode:R,onLoadDataSource:p,onAddedNode:z,onExpandedNode:F,onCollapsedNode:L,onChangedDataSource:u,dataSource:d,style:y,height:X,width:Z,focusedNode:be,customRenderText:he,update:Me=Math.random()})=>{const v=Ae(),{colorScheme:ee}=$e(),[o,U]=n.useState([]),[m,ge]=n.useState(be),g=n.useRef([]),ke=n.useRef(0),[ne,Ce]=n.useState(0),Ve=me(),te=n.useCallback(a=>a.nodes?a.nodes.map(e=>(g.current.push(e.id),{id:e.id,nodes:te(e),parentNode:a,isleaf:e.isleaf?e.isleaf:!1,state:{selected:e.state?!!e.state.selected:!1,expanded:e.state?!!e.state.expanded:!1,loading:e.state?!!e.state.loading:!1},text:e.text,icon:e.icon,color:e.color,image:e.image,data:e.data,type:e.type})):[],[]),b=n.useCallback((a,e)=>{let t;return a&&a.forEach(function(r){r.id===e?t=r:r.nodes&&(t=b(r.nodes,e)||t)}),t},[]),O=n.useCallback((a,e)=>{let t=!1;for(let r=g.current.length-1;r>=0;r--){if(t){const l=b(o,g.current[r]);if(e&&l&&l.parentNode&&l.parentNode.state&&l.parentNode.state.expanded||e&&l&&l.state&&l.state.expanded)return l}g.current[r]===a&&(t=!0)}},[o]),Q=n.useCallback((a,e)=>{let t=!1;for(let r=0;r<g.current.length;r++){if(t){const l=b(o,g.current[r]);if(e&&l&&l.parentNode&&l.parentNode.state.expanded||e&&l&&l.state&&l.state.expanded)return l}g.current[r]===a&&(t=!0)}},[o]),ae=n.useCallback((a,e)=>{if(!a||a.length<=0)return[];const t=[];return ce.each(a,r=>{r.nodes&&r.nodes.length>0&&(r.nodes=ae(r.nodes,e)),r.id!==e&&t.push(r)}),t},[]),re=n.useCallback((a,e)=>{const t=[];return a&&a.forEach(function(r){r&&r.state&&(r.state.selected=e),t.push(r),t.push(...re(r.nodes||[],e))}),t},[]),qe=n.useCallback(a=>{const e=[];return a.forEach(t=>{t&&t.state&&t.state.selected&&e.push(t),e.push(...qe(t.nodes||[]))}),e},[]),Ne=n.useCallback(a=>{!a.parentNode||!a.parentNode.state||(a.parentNode.state.selected=!0,Ne(a.parentNode))},[]),se=a=>{const e=[];for(const t of a)if(t.state.selected&&e.push(t),t.nodes&&t.nodes.length>0){const r=se(t.nodes);e.push(...r)}return e},Y=n.useCallback((a,e)=>{const t=[],r=[...o],l=b(r,a);l&&l.state&&(l.state.selected=e,t.push(l),t.push(...re(l.nodes||[],e)),U(r),u&&u(r),e===!0?N&&N(r,l,se(r)):P&&P(r,l,se(r)))},[o,u,N,P,re]);n.useEffect(()=>{Ce(a=>a+1),Ve()},[o]);const G=n.useCallback(a=>{if(p){const e=[...o],t=b(e,a);if(t){const r=p(t);r&&r.then(l=>{t&&(t.nodes=l,t.state.loading=!1),U(e),u&&u(e)},()=>{console.log("erro loaded")})}}},[o,u,p]),K=n.useCallback((a,e)=>{const t=[...o],r=[],l=b(t,a);if(l&&l.state){let H=!l.nodes&&!l.isleaf;!p&&H&&(H=!1),l.state.expanded=e,l.state.loading=H,r.push(l),U(t),u&&u(t),e===!0?F&&F(t,r):L&&L(t,r),H&&G(l.id)}},[o,u,p,G,F,L]),$=n.useCallback(a=>{A&&m&&A(m);const e=b(o,a);e&&(ge(e),_&&_(e))},[o,m,_,A]),oe=n.useCallback(()=>m,[m]),de=n.useCallback((a,e)=>{if(w){const t=b(o,a);t&&w(o,t)}},[o,w]),ie=n.useCallback((a,e)=>{const t=b(o,a);if(t){const r={text:e,state:{selected:!1,expanded:!1,loading:!1},parentNode:t,id:`${ke.current++}`,icon:"",color:"",image:""};t.nodes?t.nodes.push(r):t.nodes=[r],u&&u(o),z&&z(r,o)}},[o,u,z]),ue=n.useCallback(a=>{const e=ae([...o],a);if(e.length===0)return!1;U(e),u&&u(e),R&&R(e)},[o,ae,u,R]),ve=n.useCallback(a=>{if(m){if(a.keyCode===38){a.preventDefault();const e=O(m.id,!0);if(e){$(e.id);const t=document.getElementById(`${s}_${e.id}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}else if(a.keyCode===40){a.preventDefault();const e=Q(m.id,!0);if(e){$(e.id);const t=document.getElementById(`${s}_${e.id}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}else if(a.keyCode===33){a.preventDefault();let e=0,t=O(m.id,!0),r=t;for(;e<5&&r;)r=O(r.id,!0),r&&(t=r),e++;if(t){$(t.id);const l=document.getElementById(`${s}_${t.id}`);l&&l.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}else if(a.keyCode===34){a.preventDefault();let e=Q(m.id,!0),t=e,r=0;for(;r<5&&t;)t=Q(t.id,!0),t&&(e=t),r++;if(e){$(e.id);const l=document.getElementById(`${s}_${e.id}`);l&&l.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}else if(a.keyCode===32){a.preventDefault();const e=b(o,m.id);if(e){let t=!0;e.state.selected&&(t=!e.state.selected),Y(e.id,t)}}else if(a.keyCode===107){a.preventDefault();const e=b(o,m.id);e&&(e.state.expanded||K(e.id,!0))}else if(a.keyCode===109){a.preventDefault();const e=b(o,m.id);e&&e.state.expanded&&K(e.id,!1)}}},[m,o,g.current,O,Q,Y,K]);n.useEffect(()=>{g.current=[],U(te(ce.clone({nodes:d})))},[d,te]);const xe=n.useMemo(()=>({...T?{border:C&&`${fe(1)} solid ${ee==="dark"?v.colors.dark[4]:v.colors.gray[3]}`}:{border:"none"},...X?{height:X}:{},...Z?{width:Z}:{},marginLeft:"-20px",...y}),[y,T,C,X,Z]),Te=n.useMemo(()=>o.map(a=>c(W,{id:`${s}_${a.id}`,node:a,level:1,onSelectedStatusChanged:Y,onExpandedCollapsedChanged:K,onFocusedChanged:$,onNodeDoubleClicked:de,onLoadDataSource:G,getFocused:oe,addNode:ie,removeNode:ue,customRenderText:he,update:ne,options:{selectable:i,color:E,backgroundColor:k||"transparent",hoverColor:V||v.black,hoverBackgroundColor:x,focusedColor:q||v.white,focusedBackgroundColor:B||v.colors[v.primaryColor][5],selectedColor:I||"orange",selectedBackgroundColor:M,iconColor:j,iconBackgroundColor:S,enableLinks:D,highlightSelected:h,borderColor:C||`${fe(1)} solid ${ee==="dark"?v.colors.dark[4]:v.colors.gray[3]}`,withBorder:T,showTags:f,id:s}},a.id)),[o,i,E,k,V,x,q,B,I,M,j,S,D,h,T,f,Y,K,$,de,G,oe,ie,ue,ne]);return c("div",{tabIndex:-1,className:"archbase-treeview",onKeyDown:ve,style:xe,children:c("ul",{style:{height:"100%",overflowY:"auto"},children:Te})})};try{pe.displayName="ArchbaseTreeView",pe.__docgenInfo={description:"",displayName:"ArchbaseTreeView",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},selectable:{defaultValue:{value:"true"},description:"",name:"selectable",required:!1,type:{name:"boolean"}},color:{defaultValue:{value:"#428bca"},description:"",name:"color",required:!1,type:{name:"string"}},backgroundColor:{defaultValue:null,description:"",name:"backgroundColor",required:!1,type:{name:"string"}},borderColor:{defaultValue:null,description:"",name:"borderColor",required:!1,type:{name:"string"}},hoverColor:{defaultValue:null,description:"",name:"hoverColor",required:!1,type:{name:"string"}},hoverBackgroundColor:{defaultValue:{value:"#e7f4f9"},description:"",name:"hoverBackgroundColor",required:!1,type:{name:"string"}},focusedColor:{defaultValue:null,description:"",name:"focusedColor",required:!1,type:{name:"string"}},focusedBackgroundColor:{defaultValue:null,description:"",name:"focusedBackgroundColor",required:!1,type:{name:"string"}},selectedColor:{defaultValue:null,description:"",name:"selectedColor",required:!1,type:{name:"string"}},selectedBackgroundColor:{defaultValue:{value:"auto"},description:"",name:"selectedBackgroundColor",required:!1,type:{name:"string"}},iconColor:{defaultValue:{value:"black"},description:"",name:"iconColor",required:!1,type:{name:"string"}},iconBackgroundColor:{defaultValue:null,description:"",name:"iconBackgroundColor",required:!1,type:{name:"string"}},enableLinks:{defaultValue:{value:"false"},description:"",name:"enableLinks",required:!1,type:{name:"boolean"}},highlightSelected:{defaultValue:{value:"true"},description:"",name:"highlightSelected",required:!1,type:{name:"boolean"}},withBorder:{defaultValue:{value:"true"},description:"",name:"withBorder",required:!1,type:{name:"boolean"}},showTags:{defaultValue:{value:"false"},description:"",name:"showTags",required:!1,type:{name:"boolean"}},nodes:{defaultValue:null,description:"",name:"nodes",required:!1,type:{name:"ArchbaseTreeNode[]"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[], node: ArchbaseTreeNode) => void"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"() => void"}},onFocusedNode:{defaultValue:null,description:"",name:"onFocusedNode",required:!1,type:{name:"(node: ArchbaseTreeNode) => void"}},onLoosedFocusNode:{defaultValue:null,description:"",name:"onLoosedFocusNode",required:!1,type:{name:"(focused: ArchbaseTreeNode) => void"}},onSelectedNode:{defaultValue:null,description:"",name:"onSelectedNode",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[], node: ArchbaseTreeNode, selectedNodes: ArchbaseTreeNode[]) => void"}},onUnSelectedNode:{defaultValue:null,description:"",name:"onUnSelectedNode",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[], node: ArchbaseTreeNode, selectedNodes: ArchbaseTreeNode[]) => void"}},onRemovedNode:{defaultValue:null,description:"",name:"onRemovedNode",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[]) => void"}},onLoadDataSource:{defaultValue:null,description:"",name:"onLoadDataSource",required:!1,type:{name:"(node: ArchbaseTreeNode) => Promise<ArchbaseTreeNode[]>"}},onAddedNode:{defaultValue:null,description:"",name:"onAddedNode",required:!1,type:{name:"(node: ArchbaseTreeNode, dataSource: ArchbaseTreeNode[]) => void"}},onExpandedNode:{defaultValue:null,description:"",name:"onExpandedNode",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[], expandedNodes: ArchbaseTreeNode[]) => void"}},onCollapsedNode:{defaultValue:null,description:"",name:"onCollapsedNode",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[], expandedNodes: ArchbaseTreeNode[]) => void"}},onChangedDataSource:{defaultValue:null,description:"",name:"onChangedDataSource",required:!1,type:{name:"(dataSource: ArchbaseTreeNode[]) => void"}},dataSource:{defaultValue:null,description:"",name:"dataSource",required:!0,type:{name:"ArchbaseTreeNode[]"}},focusedNode:{defaultValue:null,description:"",name:"focusedNode",required:!1,type:{name:"ArchbaseTreeNode"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string"}},customRenderText:{defaultValue:null,description:"",name:"customRenderText",required:!1,type:{name:"(node: ArchbaseTreeNode) => ReactNode"}},update:{defaultValue:{value:"Math.random()"},description:"",name:"update",required:!1,type:{name:"number"}}}}}catch{}export{pe as A};
