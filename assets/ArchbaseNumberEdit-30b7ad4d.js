import{j as Q}from"./jsx-runtime-c9381026.js";import{b as pe,c as be,d as ye}from"./useArchbaseDataSource-bc04723a.js";import"./index-9e992aa6.js";import{r as c}from"./index-8b3efc3f.js";import{u as ge}from"./use-force-update-11fe72c1.js";import{D as h}from"./useArchbaseDataSourceListener-92dd263c.js";import{C as Ve}from"./Input-7a6e621e.js";import{T as Ee}from"./TextInput-7248445a.js";function he(t){const n=c.useRef();return c.useEffect(()=>{n.current=t},[t]),n.current}function M(t,n=2,v=".",R=",",L=!1,G="",w="",T=Number.MIN_SAFE_INTEGER,p=Number.MAX_SAFE_INTEGER,_=!1){if(t==null||t==="")return{value:null,maskedValue:""};let u=typeof t=="number"?String(t).replace(".",v):String(t).replace(new RegExp(`[^0-9${v}\\-]`,"g"),""),i=!1;L&&u.includes("-")&&(i=!0,u=u.replace(/-/g,""));let[l,r=""]=u.split(v);if(_){const a=(l+r).replace(/^0+/,"")||"0",k=a.length;k<=n?(l="0",r=a.padStart(n,"0")):(l=a.slice(0,k-n),r=a.slice(k-n))}l=l||"0",r=r.slice(0,n).padEnd(n,"0");let m=+`${i?"-":""}${l}.${r}`;m=Math.min(Math.max(m,T),p),m===0&&(i=!1),[l,r]=Math.abs(m).toFixed(n).split("."),l=l.replace(/\B(?=(\d{3})+(?!\d))/g,R);let o=`${G}${i?"-":""}${l}${n>0?v+r:""}${w}`;return{value:m,maskedValue:o.trim()}}function F({dataSource:t,dataField:n,disabled:v=!1,readOnly:R,style:L,className:G="",onFocusExit:w=()=>{},onFocusEnter:T=()=>{},onChangeValue:p=()=>{},value:_=0,decimalSeparator:u=",",thousandSeparator:i=".",precision:l=2,allowNegative:r=!1,allowEmpty:m=!1,clearable:O=!0,prefix:o="",suffix:a="",integer:k=!1,wrapperProps:ve,clearButtonProps:Y,rightSection:Z,unstyled:S,classNames:ke,width:ee,size:te,error:ne,innerRef:le,onClear:U,minValue:g=Number.MIN_SAFE_INTEGER,maxValue:V=Number.MAX_SAFE_INTEGER,...re}){const[q,b]=c.useState(""),[se,y]=c.useState(0);he(q);const D=le||c.useRef(null),[ae,W]=c.useState(ne),z=ge();c.useEffect(()=>{W(void 0)},[q,se]);const P=c.useCallback(()=>{let e=_;return t&&n&&(e=t.getFieldValue(n)),!e&&e!==0?{maskedValue:"",value:m?null:0}:(typeof e=="string"&&(e=e.replace(new RegExp(`\\${i}`,"g"),"").replace(u,".").replace(/[^0-9-.]/g,""),e=Number.parseFloat(e)),k&&(l=0),M(e,l,u,i,r,o,a,g,V))},[_,t,n,l,u,i,r,o,a,g,V,k,m]),B=c.useCallback(()=>{if(t&&n){const e=P();b(e.maskedValue),y(e.value)}},[t,n,P]),X=c.useCallback(()=>{B()},[B]),K=c.useCallback(e=>{t&&n&&((e.type===h.dataChanged||e.type===h.recordChanged||e.type===h.afterScroll||e.type===h.afterCancel||e.type===h.afterEdit||e.type===h.afterSave)&&(B(),z()),e.type===h.onFieldError&&e.fieldName===n&&W(e.error))},[t,n,B,z]);pe(()=>{const e=P();b(e.maskedValue),y(e.value),t&&n&&(t.addListener(K),t.addFieldChangeListener(n,X))}),be(()=>{const e=P();b(e.maskedValue),y(e.value)},[_]),ye(()=>{t&&n&&(t.removeListener(K),t.removeFieldChangeListener(n,X))});const ue=e=>{e.preventDefault();let s=e.target.value;const f=q;if(!r&&s.includes("-"))s=f;else if(r){const d=s.includes("-"),C=s.replace(/-/g,"");d?s="-"+C:s=C}const{maskedValue:N,value:E}=M(s,l,u,i,r,o,a,g,V,!0);b(N),y(E),t&&!t.isBrowsing()&&n&&t.setFieldValue(n,E),p&&p(N,E,e)},ie=e=>{if(D.current){const s=D.current.value,f=o.length,N=s.length-a.length;D.current.setSelectionRange(f,N)}T&&T(e)},oe=e=>{const s=M(q,l,u,i,r,o,a,g,V);b(s.maskedValue),y(s.value),w&&w(e)},ce=()=>{const e=M("",l,u,i,r,o,a,g,V);b(e.maskedValue),y(e.value),t&&!t.isBrowsing()&&n&&t.setFieldValue(n,m?null:0),U&&U()},fe=e=>{const s=e.currentTarget,f=s.selectionStart||0,N=s.selectionEnd||0,E=s.value;if(e.key==="-"){if(e.preventDefault(),!r)return;let d=E.replace(o,"").replace(a,"").replace(/-/g,"");const C=d==="0"||d===""?"-0":"-"+d,{maskedValue:A,value:I}=M(C,l,u,i,r,o,a,g,V,!0);b(A),y(I),t&&!t.isBrowsing()&&n&&t.setFieldValue(n,I),p&&p(A,I,e),setTimeout(()=>{const $=f;s.setSelectionRange($,$)},0);return}if(e.key==="Backspace"&&a){const d=E.slice(0,-a.length);if(f!==N)return;e.preventDefault();const C=E.length-f,A=Math.min(f,d.length),I=d.slice(0,A-1),$=d.slice(A),me=I+$,{maskedValue:H,value:j}=M(me,l,u,i,r,o,a,g,V,!0);b(H),y(j),t&&!t.isBrowsing()&&n&&t.setFieldValue(n,j),p&&p(H,j,e),setTimeout(()=>{const J=f>d.length?H.length-C:Math.max(o.length,f-1);s.setSelectionRange(J,J)},0)}},x=()=>R!==void 0?R:t?t.isBrowsing():!1,de=Z||(O&&q&&!x()?Q(Ve,{variant:"transparent",onMouseDown:e=>e.preventDefault(),tabIndex:-1,onClick:ce,unstyled:S,...Y}):null);return Q(Ee,{...re,disabled:v,className:G,ref:D,type:"text",value:q,rightSection:de,size:te,error:ae,style:{width:ee,...L},readOnly:x(),onChange:ue,onBlur:oe,onFocus:ie,onKeyDown:fe,styles:{input:{textAlign:"right"}}})}F.defaultProps={decimalSeparator:",",thousandSeparator:".",precision:2,allowNegative:!1,prefix:"",suffix:"",integer:!1,disabled:!1,allowEmpty:!0,clearable:!0,value:"0"};F.displayName="ArchbaseNumberEdit";try{F.displayName="ArchbaseNumberEdit",F.__docgenInfo={description:"",displayName:"ArchbaseNumberEdit",props:{clearable:{defaultValue:{value:"true"},description:"",name:"clearable",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:"CloseButtonProps"}},dataSource:{defaultValue:null,description:"",name:"dataSource",required:!1,type:{name:"ArchbaseDataSource<T, ID>"}},dataField:{defaultValue:null,description:"",name:"dataField",required:!1,type:{name:"string"}},disabled:{defaultValue:{value:"false"},description:"Sets `disabled` attribute on the `input` element",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},style:{defaultValue:null,description:"Inline style added to root component element, can subscribe to theme defined on MantineProvider",name:"style",required:!1,type:{name:"CSSProperties"}},size:{defaultValue:null,description:"Controls input `height` and horizontal `padding`, `'sm'` by default",name:"size",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},className:{defaultValue:{value:""},description:"Class added to the root element, if applicable",name:"className",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Contents of `Input.Error` component. If not set, error is not rendered.",name:"error",required:!1,type:{name:"string"}},onFocusExit:{defaultValue:{value:"() => { }"},description:"",name:"onFocusExit",required:!1,type:{name:"FocusEventHandler<HTMLInputElement>"}},onFocusEnter:{defaultValue:{value:"() => { }"},description:"",name:"onFocusEnter",required:!1,type:{name:"FocusEventHandler<HTMLInputElement>"}},onChangeValue:{defaultValue:{value:"() => { }"},description:"",name:"onChangeValue",required:!1,type:{name:"(maskValue: string, value: number, event: any) => void"}},value:{defaultValue:{value:"0"},description:"",name:"value",required:!1,type:{name:"string | number"}},decimalSeparator:{defaultValue:{value:","},description:"",name:"decimalSeparator",required:!1,type:{name:"string"}},thousandSeparator:{defaultValue:{value:"."},description:"",name:"thousandSeparator",required:!1,type:{name:"string"}},precision:{defaultValue:{value:"2"},description:"",name:"precision",required:!1,type:{name:"number"}},allowNegative:{defaultValue:{value:"false"},description:"",name:"allowNegative",required:!1,type:{name:"boolean"}},allowEmpty:{defaultValue:{value:"true"},description:"",name:"allowEmpty",required:!1,type:{name:"boolean"}},prefix:{defaultValue:{value:""},description:"",name:"prefix",required:!1,type:{name:"string"}},suffix:{defaultValue:{value:""},description:"",name:"suffix",required:!1,type:{name:"string"}},integer:{defaultValue:{value:"false"},description:"",name:"integer",required:!1,type:{name:"boolean"}},innerRef:{defaultValue:null,description:"",name:"innerRef",required:!1,type:{name:"RefObject<HTMLInputElement>"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!1,type:{name:"() => void"}},minValue:{defaultValue:{value:"Number.MIN_SAFE_INTEGER"},description:"",name:"minValue",required:!1,type:{name:"number"}},maxValue:{defaultValue:{value:"Number.MAX_SAFE_INTEGER"},description:"",name:"maxValue",required:!1,type:{name:"number"}}}}}catch{}export{F as A};
