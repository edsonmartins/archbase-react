import{R as O,r as T}from"./index-76fb7be0.js";import{i as v}from"./i18next-a4b2730f.js";import{a as ie,A as we,b as y,D as S}from"./useArchbaseDataSourceListener-cbed610e.js";import{j as L}from"./jsx-runtime-29545a09.js";import{p as b}from"./useArchbaseRemoteServiceApi-05255476.js";import{D as se}from"./ArchbaseRemoteApiService-ede5188b.js";const ke=-2,Be=-1,Te="normal",xe="quick",ve="advanced",Ue="contains",Ge="=";class k{constructor(){}get id(){return this._id}get companyId(){return this._companyId}get filter(){return this._filter}get name(){return this._name}get viewName(){return this._viewName}get componentName(){return this._componentName}get userName(){return this._userName}get isShared(){return this._shared}get code(){return this._code}get isNewFilter(){return this._isNewFilter}setId(e){this._id=e}setCompanyId(e){this._companyId=e}setFilter(e){this._filter=e}setName(e){this._name=e}setViewName(e){this._viewName=e}setComponentName(e){this._componentName=e}setUserName(e){this._userName=e}setShared(e){this._shared=e}setCode(e){this._code=e}setIsNewFilter(e){this._isNewFilter=e}static createInstance(){return new k}static createInstanceWithValues(e){const t=new k;return e.id!==void 0&&t.setId(e.id),e.companyId!==void 0&&t.setCompanyId(e.companyId),e.filter&&t.setFilter(e.filter),typeof e.name=="string"&&t.setName(e.name),typeof e.viewName=="string"&&t.setViewName(e.viewName),typeof e.componentName=="string"&&t.setComponentName(e.componentName),typeof e.userName=="string"&&t.setUserName(e.userName),typeof e.shared=="boolean"&&t.setShared(e.shared),typeof e.code=="string"&&t.setCode(e.code),typeof e.isNewFilter=="boolean"&&t.setIsNewFilter(e.isNewFilter),t}}class C extends T.Component{static get componentName(){return"FilterField"}render(){return null}}C.defaultProps={sortable:!0,quickFilter:!0,quickFilterSort:!1};class B extends T.Component{static get componentName(){return"FilterFieldValue"}render(){return null}}class U extends T.Component{static get componentName(){return"FilterFields"}render(){return L("div",{children:this.props.children})}}const ae=s=>{let e="",t=!1;return s.sort.sortFields.forEach(r=>{r.selected&&(t&&(e+=", "),e+=r.label+"("+(r.asc_desc==="asc"?"A":"D")+")",t=!0)}),e},G=s=>{let e=[];return O.Children.toArray(s).forEach(function(r){r&&r.type&&r.type.componentName==="QueryFields"&&r.props.children&&O.Children.toArray(r.props.children).forEach(function(o,a){let u=[];O.Children.toArray(o.props.children).forEach(function(I){u.push(L(B,{...I.props},"fld"+a))}),e.push(L(C,{...o.props,children:u},"fld"+a))})}),L(U,{children:e})},z=s=>{let e=[],t=G(s.children);return t&&O.Children.toArray(t).forEach(i=>{i.type&&i.type.componentName==="FilterFields"&&i.props.children&&O.Children.toArray(i.props.children).forEach(a=>{if(a.type&&a.type.componentName!=="FilterField")throw new ie("Somente filhos do tipo FilterField podem ser usados com FilterFields.");let u=[];O.Children.toArray(a.props.children).forEach(I=>{if(I.type&&I.type.componentName!=="FilterFieldValue")throw new ie("Somente filhos do tipo FilterFieldValue podem ser usados com FilterFields");u.push({label:I.props.label,value:I.props.value})}),e.push({name:a.props.name,label:a.props.label,dataType:a.props.dataType,operator:a.props.operator,quickFilter:a.props.quickFilter,quickFilterSort:a.props.quickFilterSort,sortable:a.props.sortable,listValues:u,searchComponent:a.props.searchComponent,searchField:a.props.searchField})})}),e},H=s=>{let e=[];return s&&s.forEach(t=>{t.quickFilter===!0&&e.push({name:t.name,label:t.label,dataType:"string",operator:"",quickFilter:!1,quickFilterSort:!1,sortable:!1,listValues:[],searchComponent:void 0,searchField:void 0})}),e},ne=s=>{let e=[];return s&&s.forEach((t,r)=>{t.quickFilterSort===!0&&e.push({name:t.name,label:t.label,selected:!1,order:r,asc_desc:"asc"})}),e},M=s=>{let e="",t=!1;return s.forEach(function(r){r.quickFilterSort===!0&&(t&&(e+=","),e+=r.name,t=!0)}),e},oe=s=>{let e="",t=!1;return s.forEach(r=>{r.selected&&t&&(e+=","),e+=r.name,t=!0}),e},Oe=(s,e)=>{let t=[];return e&&(e.forEach(function(r,i){let o=!1,a="asc",u=i;s&&s.forEach(function(F){F.name===r.name&&(o=F.selected,a=F.asc_desc,u=F.order)}),t.push({name:r.name,selected:o,order:u,asc_desc:a||"asc",label:r.label})}),t=t.sort(function(r,i){return r.order-i.order})),t},be=(s,e)=>{let t="",r=!1;return s&&s.filter&&(!s.filter.selectedFields||s.filter.selectedFields.length===0?e.forEach(i=>{i.quickFilter===!0&&(r&&(t=t+","),t+=i.name),r=!0}):s.filter.selectedFields.forEach(i=>{r&&(t+=","),t+=i.name,r=!0})),t},ze=()=>({id:0,name:"",viewName:"",apiVersion:"",filter:{id:"root",selectedFields:[],quickFilterText:"",rules:[],condition:"",filterType:"normal",quickFilterFieldsText:""},sort:{quickFilterSort:"",sortFields:[],activeIndex:-1}}),He=()=>[{name:"null",label:"Em branco",dataTypes:["string","number","date","date_time","time","boolean"]},{name:"notNull",label:"Preenchido",dataTypes:["string","number","date","date_time","time","boolean"]},{name:"contains",label:"Contém",dataTypes:["string"]},{name:"startsWith",label:"Iniciado com",dataTypes:["string"]},{name:"endsWith",label:"Terminado com",dataTypes:["string"]},{name:"=",label:"Igual",dataTypes:["string","number","date","date_time","time","boolean"]},{name:"!=",label:"Diferente",dataTypes:["string","number","date","date_time","time","boolean"]},{name:"<",label:"Menor",dataTypes:["string","number","date","date_time","time"]},{name:">",label:"Maior",dataTypes:["string","number","date","date_time","time"]},{name:"<=",label:"Menor igual",dataTypes:["string","number","date","date_time","time"]},{name:">=",label:"Maior igual",dataTypes:["string","number","date","date_time","time"]},{name:"between",label:"Entre",dataTypes:["string","number","date","date_time","time"]},{name:"inList",label:"Na lista",dataTypes:["string","number","date","time"]},{name:"notInList",label:"Fora da lista",dataTypes:["string","number","date","time"]}],Me=()=>[{name:"and",label:"E"},{name:"or",label:"Ou"}],le=(s,e)=>{let t=z(s),r={id:-1,name:"",viewName:"",apiVersion:"",filter:{id:"root",selectedFields:[],quickFilterText:"",quickFilterFieldsText:"",rules:[],condition:"",filterType:e},sort:{quickFilterSort:"",sortFields:[],activeIndex:-1}};return r.filter.selectedFields=H(t),r.filter.quickFilterFieldsText=be(null,t),r.sort.sortFields=Oe([],t),r.sort.quickFilterSort=M(t),r};class de extends T.Component{static get componentName(){return"QueryFields"}render(){const{children:e}=this.props;return L("div",{children:e})}}class J extends O.Component{static get componentName(){return"QueryField"}render(){return null}}J.defaultProps={sortable:!0,quickFilter:!0,quickFilterSort:!1,operator:"=",mask:""};class pe extends T.Component{static get componentName(){return"QueryFieldValue"}render(){return null}}try{pe.displayName="QueryFieldValue",pe.__docgenInfo={description:"",displayName:"QueryFieldValue",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}}}}}catch{}try{J.displayName="QueryField",J.__docgenInfo={description:"",displayName:"QueryField",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},dataType:{defaultValue:null,description:"",name:"dataType",required:!0,type:{name:"enum",value:[{value:'"string"'},{value:'"number"'},{value:'"boolean"'},{value:'"time"'},{value:'"date"'},{value:'"date_time"'}]}},operator:{defaultValue:{value:"="},description:"",name:"operator",required:!1,type:{name:"enum",value:[{value:'"="'},{value:'"contains"'},{value:'"startsWith"'},{value:'"endsWith"'},{value:'"!="'},{value:'"<"'},{value:'">"'},{value:'"<="'},{value:'">="'},{value:'"between"'},{value:'"inList"'},{value:'"notInList"'}]}},sortable:{defaultValue:{value:"true"},description:"",name:"sortable",required:!1,type:{name:"boolean"}},quickFilter:{defaultValue:{value:"true"},description:"",name:"quickFilter",required:!1,type:{name:"boolean"}},quickFilterSort:{defaultValue:{value:"false"},description:"",name:"quickFilterSort",required:!1,type:{name:"boolean"}},searchComponent:{defaultValue:null,description:"",name:"searchComponent",required:!1,type:{name:"any"}},mask:{defaultValue:{value:""},description:"",name:"mask",required:!1,type:{name:"string | Function"}},filterWithMask:{defaultValue:null,description:"",name:"filterWithMask",required:!1,type:{name:"boolean"}}}}}catch{}try{de.displayName="QueryFields",de.__docgenInfo={description:"",displayName:"QueryFields",props:{}}}catch{}try{C.displayName="FilterField",C.__docgenInfo={description:"",displayName:"FilterField",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},dataType:{defaultValue:null,description:"",name:"dataType",required:!0,type:{name:"enum",value:[{value:'"string"'},{value:'"number"'},{value:'"boolean"'},{value:'"time"'},{value:'"date"'},{value:'"date_time"'}]}},sortable:{defaultValue:{value:"true"},description:"",name:"sortable",required:!1,type:{name:"boolean"}},quickFilter:{defaultValue:{value:"true"},description:"",name:"quickFilter",required:!1,type:{name:"boolean"}},quickFilterSort:{defaultValue:{value:"false"},description:"",name:"quickFilterSort",required:!1,type:{name:"boolean"}}}}}catch{}try{B.displayName="FilterFieldValue",B.__docgenInfo={description:"",displayName:"FilterFieldValue",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}}}}}catch{}try{U.displayName="FilterFields",U.__docgenInfo={description:"",displayName:"FilterFields",props:{}}}catch{}try{le.displayName="getDefaultFilter",le.__docgenInfo={description:"",displayName:"getDefaultFilter",props:{persistenceDelegator:{defaultValue:null,description:"",name:"persistenceDelegator",required:!0,type:{name:"ArchbaseQueryFilterDelegator"}},showClearButton:{defaultValue:null,description:"",name:"showClearButton",required:!1,type:{name:"boolean"}},showToggleButton:{defaultValue:null,description:"",name:"showToggleButton",required:!1,type:{name:"boolean"}},showPrintButton:{defaultValue:null,description:"",name:"showPrintButton",required:!1,type:{name:"boolean"}},showExportButton:{defaultValue:null,description:"",name:"showExportButton",required:!1,type:{name:"boolean"}},onClearFilter:{defaultValue:null,description:"",name:"onClearFilter",required:!1,type:{name:"(self: any) => {}"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"light"'},{value:'"filled"'},{value:'"outline"'},{value:'"default"'},{value:'"transparent"'},{value:'"white"'},{value:'"subtle"'},{value:'"gradient"'}]}},viewName:{defaultValue:null,description:"",name:"viewName",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},apiVersion:{defaultValue:null,description:"",name:"apiVersion",required:!0,type:{name:"string"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string"}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"string"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},detailsWidth:{defaultValue:null,description:"",name:"detailsWidth",required:!1,type:{name:"number"}},detailsHeight:{defaultValue:null,description:"",name:"detailsHeight",required:!1,type:{name:"number"}},currentFilter:{defaultValue:null,description:"",name:"currentFilter",required:!1,type:{name:"ArchbaseQueryFilter"}},expandedFilter:{defaultValue:null,description:"",name:"expandedFilter",required:!1,type:{name:"boolean"}},activeFilterIndex:{defaultValue:null,description:"",name:"activeFilterIndex",required:!0,type:{name:"number"}},onToggleExpandedFilter:{defaultValue:null,description:"",name:"onToggleExpandedFilter",required:!1,type:{name:"(value: boolean) => void"}},onFilterChanged:{defaultValue:null,description:"",name:"onFilterChanged",required:!1,type:{name:"(currentFilter: ArchbaseQueryFilter, index: number, callback?: () => void) => void"}},onSearchByFilter:{defaultValue:null,description:"",name:"onSearchByFilter",required:!1,type:{name:"() => void"}},onSelectedFilter:{defaultValue:null,description:"",name:"onSelectedFilter",required:!1,type:{name:"(filter: ArchbaseQueryFilter, index: number) => void"}},userName:{defaultValue:null,description:"",name:"userName",required:!1,type:{name:"any"}},onPrint:{defaultValue:null,description:"",name:"onPrint",required:!1,type:{name:"() => void"}},onExport:{defaultValue:null,description:"",name:"onExport",required:!1,type:{name:"() => void"}}}}}catch{}try{M.displayName="getQuickFilterSort",M.__docgenInfo={description:"",displayName:"getQuickFilterSort",props:{}}}catch{}try{H.displayName="getQuickFields",H.__docgenInfo={description:"",displayName:"getQuickFields",props:{}}}catch{}try{z.displayName="getFields",z.__docgenInfo={description:"",displayName:"getFields",props:{}}}catch{}try{ne.displayName="getQuickFieldsSort",ne.__docgenInfo={description:"",displayName:"getQuickFieldsSort",props:{}}}catch{}try{oe.displayName="getQuickFilterSortBySelectedFields",oe.__docgenInfo={description:"",displayName:"getQuickFilterSortBySelectedFields",props:{}}}catch{}try{G.displayName="convertQueryFields",G.__docgenInfo={description:"",displayName:"convertQueryFields",props:{}}}catch{}try{ae.displayName="getSortString",ae.__docgenInfo={description:"",displayName:"getSortString",props:{sort:{defaultValue:null,description:"",name:"sort",required:!0,type:{name:"{ sortFields: any[]; }"}}}}}catch{}const d={IS:"IS",BETWEEN:"BETWEEN",LIKE:"LIKE",EQ:"EQ",NEQ:"NEQ",GEQ:"GEQ",LEQ:"LEQ",GT:"GT",LT:"LT",NOT:"NOT",IN:"IN",IS_NOT:"IS_NOT",AND:"AND",OR:"OR"};function A(s,e){const t=Object.prototype.toString.call(e).slice(8,-1);return e!=null&&t===s}function De(s){return s===d.IS||s===d.BETWEEN||s===d.LIKE||s===d.EQ||s===d.NEQ||s===d.GEQ||s===d.LEQ||s===d.GT||s===d.LT||s===d.NOT||s===d.IN||s===d.IS_NOT||s===d.AND||s===d.OR}const g={FIELD:"FIELD",FILTER:"FILTER",GROUP:"GROUP",OPERATION:"OPERATION",AND:"AND",OR:"OR",IN:"IN",BETWEEN:"BETWEEN"};class n{constructor(e){this.message=e,this.name="FilterException"}}class q{constructor(e,t){this.fieldName=e,this.fieldSql=t,this.expressionType=g.FIELD}getFieldName(){return this.fieldName()}setFieldName(e){this.fieldName=e}toJSON(e){e.append('"type" : "FIELD",'),e.append('"name" : "'+this.fieldName+'"'),this.fieldSql&&e.append(', "nameSql" : "'+this.fieldSql+'"')}}class V{constructor(){this.expressionType=g.FILTER}applyOperation(e,t){throw new n("applyOperation só pode ser usado nas classes concretas.")}applyInOperation(){throw new n("applyInOperation só pode ser usado nas classes concretas.")}applyNotInOperation(){throw new n("applyNotInOperation só pode ser usado nas classes concretas.")}applyBetweenOperation(){throw new n("applyBetweenOperation só pode ser usado nas classes concretas.")}EQ(e){return this.applyOperation(d.EQ,e)}NEQ(e){return this.applyOperation(d.NEQ,e)}GEQ(e){return this.applyOperation(d.GEQ,e)}GT(e){return this.applyOperation(d.GT,e)}LT(e){return this.applyOperation(d.LT,e)}AND(){if(arguments.length===3)return new P(this,new x(arguments[0],arguments[1],arguments[2]));if(arguments.length===1)if(typeof arguments[0]=="object"){if(arguments[0].expressionType===void 0)throw new n("Tipo de parâmetro incorreto para uso de AND. Parâmetro "+arguments[0]);return arguments[0].expressionType===g.FIELD?new P(this,new x(arguments[0])):new P(this,arguments[0])}else throw new n("Parâmetro deve ser do tipo Object.");else throw new n("Número de parâmetros incorretos para a chamade de AND")}OR(){if(arguments.length===4)return new R(this,new R(arguments[0],arguments[1],arguments[2]));if(arguments.length===1)if(typeof arguments[0]=="object"){if(arguments[0].expressionType===void 0)throw new n("Tipo de parâmetro incorreto para uso de OR. Parâmetro "+arguments[0]);return arguments[0].expressionType===g.FIELD?new R(this,new x(arguments[0])):new R(this,arguments[0])}else throw new n("Parâmetro deve ser do tipo Object.");else throw new n("Número de parâmetros incorretos para a chamade de OR")}LEQ(e){return this.applyOperation(d.LEQ,e)}LIKE(e){return this.applyOperation(d.LIKE,e)}BETWEEN(e,t){return this.applyBetweenOperation(e,t)}STARTSWITH(e){if(ArchbaseStringUtils.isEmpty(e))throw new n("Para usar STARTSWITH informe um valor.");return e=e.concat("%"),this.applyOperation(d.LIKE,e)}ENDSWITH(e){if(ArchbaseStringUtils.isEmpty(e))throw new n("Para usar ENDSWITH informe um valor.");return e="%".concat(e),this.applyOperation(d.LIKE,e)}CONTAINS(e){if(ArchbaseStringUtils.isEmpty(e))throw new n("Para usar v informe um valor.");return e="%".concat(e.concat("%")),this.applyOperation(d.LIKE,e)}IN(){return this.applyInOperation(arguments[0])}NOTIN(){return this.applyNotInOperation(arguments[0])}ISNULL(){return this.applyOperation(d.IS,"NULL")}ISNOTNULL(){return this.applyOperation(d.IS_NOT,"NULL")}toJSON(e){throw new n("toJSON deve ser implementado nas classes concretas herdadas de FilterExpression.")}}class x extends V{constructor(e,t,r){super(),this.lhsValue=e,this.rhsValue=r,this.operator=t,this.expressionType=g.OPERATION}applyOperation(e,t){if(!De(e))throw new n(e+" não é um operador válido.");if(this.operator!==void 0)throw new n("Não é possível aplicar "+e+" operation on an "+this.operator+" expression.");return new x(this.lhsValue,e,t)}applyInOperation(){if(arguments[0].length===0)throw new n("Para usar operação IN é necessário informar os valores.");if(!(this.lhsValue instanceof q))throw new n("Somente é possível aplicar a operação 'IN' em uma coluna.");return new ue(this.lhsValue,!1,arguments[0])}applyNotInOperation(){if(arguments[0].length===0)throw new n("Para usar operação NOT IN é necessário informar os valores.");if(!(this.lhsValue instanceof q))throw new n("Somente é possível aplicar a operação 'NOT IN' em uma coluna.");return new ue(this.lhsValue,!0,arguments[0])}applyBetweenOperation(e,t){if(e===void 0)throw new n("Para usar operação BETWEEN é necessário informar o valor inicial.");if(t===void 0)throw new n("Para usar operação BETWEEN é necessário informar o valor final.");if(!(this.lhsValue instanceof q))throw new n("Somente é possível aplicar a operação 'BETWEEN' em uma coluna.");return new Le(this.lhsValue,e,t)}toJSON(e){e.append('"type" : "OP",'),e.append('"lhsValue" : {'),this.lhsValue.toJSON(e),e.append("},"),A("Number",this.rhsValue)?e.append('"rhsValue" : '+this.rhsValue+","):e.append('"rhsValue" : "'+this.rhsValue+'",'),e.append('"operator" : "'+this.operator+'"')}}class he extends V{constructor(e){super(),this.expressions=e,this.expressionType=g.GROUP}getExpressions(){return this.expressions}getOperator(){throw new n("Uso incorreto do método. Este método deve ser implementado por classes concretas que herdam de GroupExpression.")}applyOperation(e,t){const r=this.expressions.length-1,i=this.expressions[r];return this.expressions[r]=i.applyOperation(e,t),this}applyInOperation(){const e=this.expressions.length-1,t=this.expressions[e];return this.expressions[e]=t.applyInOperation(arguments[0]),this}applyNotInOperation(){const e=this.expressions.length-1,t=this.expressions[e];return this.expressions[e]=t.applyNotInOperation(arguments[0]),this}applyBetweenOperation(e,t){const r=this.expressions.length-1,i=this.expressions[r];return this.expressions[r]=i.applyBetweenOperation(e,t),this}toJSON(e){e.append('"type" : "'+this.getOperator()+'",'),e.append('"expressions" : [');let t=!1;for(let r=0;r<this.expressions.length;r++)t&&e.append(","),e.append("{"),this.expressions[r].toJSON(e),e.append("}"),t=!0;e.append("]")}}class ue extends V{constructor(){if(super(),arguments.length<3)throw new n("Para usar a expressão IN informe os parâmetros corretamente.");this.field=arguments[0],this.negative=arguments[1],this.values=arguments[2],this.expressionType=g.IN}isNegative(){return this.negative}applyOperation(e,t){throw new n("Não é possível aplicar a operação "+e+" na expressão IN.")}applyInOperation(){throw new n("Não é possível aplicar a operação IN na expressão IN.")}applyNotInOperation(){throw new n("Não é possível aplicar a operação NOT IN na expressão IN.")}applyBetweenOperation(e,t){throw new n("Não é possível aplicar a operação BETWEEEN na expressão IN.")}toJSON(e){e.append('"type" : "IN",'),e.append('"field" : {'),this.field.toJSON(e),e.append("},"),e.append('"values" : [');let t=!1;for(let r=0;r<this.values.length;r++)t&&e.append(","),A("Number",this.values[r])?e.append(this.values[r]):e.append('"'+this.values[r]+'"'),t=!0;e.append("],"),e.append('"negative" : '+this.negative)}}class Le extends V{constructor(e,t,r){if(super(),e===void 0)throw new n("Informe o valor do field para usar BETWEEN.");if(t===void 0)throw new n("Informe o valor inicial para usar BETWEEN.");if(r===void 0)throw new n("Informe o valor final para usar BETWEEN.");this.field=e,this.valueStart=t,this.valueEnd=r,this.expressionType=g.BETWEEN}applyOperation(e,t){throw new n("Não é possível aplicar a operação "+e+" na expressão BETWEEN.")}applyInOperation(){throw new n("Não é possível aplicar a operação IN na expressão BETWEEN.")}applyNotInOperation(){throw new n("Não é possível aplicar a operação NOT IN na expressão BETWEEN.")}applyBetweenOperation(e,t){throw new n("Não é possível aplicar a operação BETWEEEN na expressão BETWEEN.")}toJSON(e){e.append('"type" : "BETWEEN",'),e.append('"field" : {'),this.field.toJSON(e),e.append("},"),A("Number",this.valueStart)?e.append('"valueStart" : '+this.valueStart+","):e.append('"valueStart" : "'+this.valueStart+'",'),A("Number",this.valueEnd)?e.append('"valueEnd" : '+this.valueEnd):e.append('"valueEnd" : "'+this.valueEnd+'"')}}class P extends he{constructor(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);super(e),this.expressionType=g.AND}getOperator(){return d.AND}}class R extends he{constructor(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);super(e),this.expressionType=g.OR}getOperator(){return d.OR}}class qe{constructor(){this.filterExpression=null,this.fieldsToSort=[],this.processRules=this.processRules.bind(this),this.WHERE=this.WHERE.bind(this),this.EQ=this.EQ.bind(this),this.NEQ=this.NEQ.bind(this),this.GEQ=this.GEQ.bind(this),this.LEQ=this.LEQ.bind(this),this.GT=this.GT.bind(this),this.LT=this.LT.bind(this),this.LIKE=this.LIKE.bind(this),this.IN=this.IN.bind(this),this.NOTIN=this.NOTIN.bind(this),this.AND=this.AND.bind(this),this.OR=this.OR.bind(this),this.ISNULL=this.ISNULL.bind(this),this.ISNOTNULL=this.ISNOTNULL.bind(this),this.betweenOrOp=this.betweenOrOp.bind(this),this.BETWEEN=this.BETWEEN.bind(this),this.OP=this.OP.bind(this),this.STARTSWITH=this.STARTSWITH.bind(this),this.CONTAINS=this.CONTAINS.bind(this),this.toJSON=this.toJSON.bind(this)}assertWhereClauseIsInitialized(e){if(this.filterExpression===null||this.filterExpression===void 0)throw new n("Não é possível aplicar '"+e+"' operador se o cláusula WHERE não existir.")}buildFrom(e,t){e.rules&&(this.processRules(e.condition,e.rules,!0),t&&t.sortFields&&t.sortFields.forEach(r=>{r.selected&&this.fieldsToSort.push(r.name+" "+r.asc_desc)}))}processRules(e,t,r){t.forEach(i=>{if(i.field&&!i.disabled){let o=_this.AND;e==="or"&&(o=_this.OR),r&&(o=_this.WHERE);let a=i.value,u=i.value2;a&&a!==""&&(i.dataType==="date"?a=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(a,"DD/MM/YYYY"),Archbase.dataSourceDatetimeFormat):i.dataType==="date_time"&&(a=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(a,"DD/MM/YYYY hh:mm:ss"),Archbase.dataSourceDatetimeFormat))),u&&u!==""&&(i.dataType==="date"?u=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(u,"DD/MM/YYYY"),Archbase.dataSourceDatetimeFormat):i.dataType==="date_time"&&(u=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(u,"DD/MM/YYYY hh:mm:ss"),Archbase.dataSourceDatetimeFormat))),i.operator==="null"?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).ISNULL(),r=!1):i.operator==="notNull"?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).ISNOTNULL(),r=!1):i.operator==="contains"&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).CONTAINS(a),r=!1):i.operator==="startsWith"&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).STARTSWITH(a),r=!1):i.operator==="endsWith"&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).ENDSWITH(a),r=!1):i.operator==="="&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).EQ(a),r=!1):i.operator==="!="&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).NEQ(a),r=!1):i.operator==="<"&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).LT(a),r=!1):i.operator===">"&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).GT(a),r=!1):i.operator==="<="&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).LEQ(a),r=!1):i.operator===">="&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).GEQ(a),r=!1):i.operator==="between"&&a&&a!==""&&u&&u!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).BETWEEN(a,u),r=!1):i.operator==="inList"&&a&&a!==""?(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).IN(a),r=!1):i.operator==="notInList"&&a&&a!==""&&(o(_this.EXP(_this.FIELD(i.field,i.fieldSql))).NOTIN(a),r=!1)}}),t.forEach(i=>{i.rules&&this.processRules(i.condition,i.rules,r)})}FIELD(e,t){return new q(e,t)}EXP(e){return new x(e)}WHERE(){if(arguments.length<1)throw new n("Para criar uma condição WHERE informe ao menos um parâmetro.");return arguments.length===3?arguments[2]!==void 0&&(this.filterExpression=new x(arguments[0],arguments[1],arguments[2])):(this.filterExpression=arguments[0],arguments[0].expressionType!==void 0&&arguments[0].expressionType===g.FIELD&&(this.filterExpression=new x(arguments[0]))),this}EQ(e){return this.assertWhereClauseIsInitialized("eq"),this.filterExpression=this.filterExpression.EQ(e),this}NEQ(e){return this.assertWhereClauseIsInitialized("neq"),this.filterExpression=this.filterExpression.NEQ(e),this}GEQ(e){return this.assertWhereClauseIsInitialized("geq"),this.filterExpression=this.filterExpression.GEQ(e),this}LEQ(e){return this.assertWhereClauseIsInitialized("leq"),this.filterExpression=this.filterExpression.LEQ(e),this}GT(e){return this.assertWhereClauseIsInitialized("gt"),this.filterExpression=this.filterExpression.GT(e),this}LT(e){return this.assertWhereClauseIsInitialized("lt"),this.filterExpression=this.filterExpression.LT(e),this}LIKE(e){return this.assertWhereClauseIsInitialized("like"),this.filterExpression=this.filterExpression.LIKE(e),this}IN(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);return this.assertWhereClauseIsInitialized("in"),this.filterExpression=this.filterExpression.IN(e),this}NOTIN(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);return this.assertWhereClauseIsInitialized("not in"),this.filterExpression=this.filterExpression.NOTIN(e),this}AND(e){return this.assertWhereClauseIsInitialized("and"),this.filterExpression=this.filterExpression.AND(e),this}OR(e){return this.assertWhereClauseIsInitialized("or"),this.filterExpression=this.filterExpression.OR(e),this}ISNULL(){return this.assertWhereClauseIsInitialized("isNull"),this.filterExpression=this.filterExpression.ISNULL(),this}ISNOTNULL(){return this.assertWhereClauseIsInitialized("isNotNull"),this.filterExpression=this.filterExpression.ISNOTNULL(),this}betweenOrOp(e,t,r){return this.assertWhereClauseIsInitialized(e),this.filterExpression=this.filterExpression.betweenOrOp(e,t,r),this}BETWEEN(e,t){return this.assertWhereClauseIsInitialized("between"),this.filterExpression=this.filterExpression.BETWEEN(e,t),this}OP(e,t){return this.assertWhereClauseIsInitialized(e),this.filterExpression=this.filterExpression.applyOperation(e,t),this}STARTSWITH(e){return this.assertWhereClauseIsInitialized("startsWith"),this.filterExpression=this.filterExpression.STARTSWITH(e),this}CONTAINS(e){return this.assertWhereClauseIsInitialized("contains"),this.filterExpression=this.filterExpression.CONTAINS(e),this}SORTBY(e,t){e instanceof q?this.fieldsToSort.push(e.getFieldName+(t===!0?" DESC":" ASC")):this.fieldsToSort.push(e+(t===!0?" DESC":" ASC"))}toJSON(){if(this.filterExpression!==void 0&&this.filterExpression!=null){const e=ArchbaseStringUtils.createStringBuilder();e.append("{"),e.append('   "filterExpression" : {'),this.filterExpression.toJSON(e),e.append("}, "),e.append('    "fieldsToSort" : [');let t=!1;return this.fieldsToSort.forEach(function(r){t===!0&&e.append(", "),e.append('{ "field" : "'+r+'" }'),t=!0}),e.append("]"),e.append("}"),e.toString()}}}class Re extends we{constructor(e,t,r,i){super(t,r,i),this.service=e}async save(e){if(this.validateDataSourceActive("save"),!this.inserting&&!this.editing){const t=v.t("archbase:saveRecordIsNotAllowed",{dataSourceName:this.name});throw this.publishEventError(t,{}),new y(t)}if(!this.currentRecord){const t=v.t("archbase:noRecordToSave",{dataSourceName:this.name});throw this.publishEventError(t,{}),new y(t)}if(this.emitter.emit("beforeSave",this.currentRecord),this.emit({type:S.beforeSave,record:this.currentRecord,index:this.getCurrentIndex()}),this.validator){const t=this.validator.validateEntity(this.currentRecord);if(t&&t.length>0)if(this.publishEventErrors(t),t[0].fieldName){const r=v.t("archbase:errorSavingRecord",{dataSourceName:this.label});throw new y(r)}else throw new y(t[0].errorMessage)}try{let t=-1;this.records.forEach((r,i)=>{r===this.currentRecord&&(t=i)}),this.currentRecord=await this.service.save(this.currentRecord),this.editing&&(this.filteredRecords[this.getCurrentIndex()]=this.currentRecord),t>=0?this.records[t]=this.currentRecord:this.records.push(this.currentRecord),this.editing=!1,this.inserting=!1,this.lastDataChangedAt=new Date().getTime(),this.emitter.emit("afterSave",this.currentRecord),this.emit({type:S.afterSave,record:this.currentRecord,index:this.getCurrentIndex()}),e&&e()}catch(t){t.response&&t.response.data&&t.response.data.apierror&&t.response.data.apierror.subErrors&&t.response.data.apierror.subErrors.forEach(i=>{i.field&&(this.emitter.emit("onFieldError",i.field,i.message),this.emit({type:S.onFieldError,fieldName:i.field,error:i.message,originalError:i.message}))});const r=b(t);throw this.emitter.emit("onError",r,t),this.emit({type:S.onError,error:r,originalError:t}),e&&e(r),new y(r)}return this.currentRecord}async remove(e){if(this.validateDataSourceActive("remove"),this.inserting||this.editing){const t=v.t("archbase:removingRecordIsNotAllowed",{dataSourceName:this.name});throw this.publishEventError(t,{}),new y(t)}if(this.isEmpty()||!this.currentRecord){const t=v.t("archbase:noRecordsToEdit",{dataSourceName:this.name});throw this.publishEventError(t,{}),new y(t)}if(this.isBOF()){const t=v.t("archbase:BOFDataSource",{dataSourceName:this.name});throw this.publishEventError(t,{}),new y(t)}if(this.isEOF()){const t=v.t("archbase:EOFDataSource",{dataSourceName:this.name});throw this.publishEventError(t,{}),new y(t)}this.emitter.emit("beforeRemove",this.currentRecord,this.currentRecordIndex),this.emit({type:S.beforeRemove,record:this.currentRecord,index:this.getCurrentIndex()});try{await this.service.delete(this.service.getId(this.currentRecord));let t=-1;const r=this.currentRecord,i=this.currentRecordIndex;return this.records.forEach((o,a)=>{this.currentRecord===o&&(t=a)}),t>=0&&this.records.splice(t,1),this.records!==this.filteredRecords&&this.filteredRecords.splice(this.getCurrentIndex(),1),this.grandTotalRecords--,this.filteredRecords.length===0?(this.currentRecord=void 0,this.currentRecordIndex=-1):(this.currentRecordIndex>this.filteredRecords.length-1&&this.currentRecordIndex--,this.currentRecord=this.filteredRecords[this.currentRecordIndex]),this.editing=!1,this.inserting=!1,this.emitter.emit("afterScroll"),this.emit({type:S.afterScroll}),this.emitter.emit("afterRemove",r,i),this.emit({type:S.afterRemove,record:r,index:i}),this.lastDataBrowsingOn=new Date().getTime(),this.lastDataChangedAt=new Date().getTime(),e&&e(),r}catch(t){const r=b(t);throw this.emitter.emit("onError",r,t),this.emit({type:S.onError,error:r,originalError:t}),e&&e(r),new y(r)}}applyRemoteFilter(e,t,r){return e&&e.filter.filterType===xe&&e.filter.quickFilterText&&e.filter.quickFilterText!==""?this.getDataWithQuickFilter(e,t):e&&(e.filter.filterType===Te||e.filter.filterType===ve)?this.getDataWithFilter(e,t):this.getDataWithoutFilter(t)}async getDataWithFilter(e,t){const r=new qe;r.buildFrom(e.filter,e.sort);const i=r.toJSON();let o;return i?o=await this.service.findAllWithFilter(r.toJSON(),t,this.getPageSize()):o=this.getDataWithoutFilter(t),o}getDataWithoutFilter(e){let t;return this.defaultSortFields.length>0?t=this.service.findAllWithSort(e,this.getPageSize(),this.defaultSortFields):t=this.service.findAll(e,this.getPageSize()),t}getDataWithQuickFilter(e,t){return this.service.findAllMultipleFields(e.filter.quickFilterText,e.filter.quickFilterFieldsText,t,this.getPageSize(),this.getSortFields(e))}getSortFields(e){return e&&e.sort?e.sort.quickFilterSort:this.defaultSortFields}}function Je(s){const{name:e,label:t,service:r,filter:i,sort:o,transformData:a,onLoadComplete:u,onDestroy:F,filterData:I,findAll:X,findAllWithSort:Y,findAllWithFilter:K,findAllWithFilterAndSort:j,initialDataSource:D,pageSize:Q=50,currentPage:Z=0,loadOnStart:ce=!0,store:N,id:fe,validator:$}=s,me=()=>!!(N&&N.existsValue(e)||D),Ee=()=>N&&N.existsValue(e)?N.getValue(e):D||new Re(r,e,{records:[],grandTotalRecords:0,currentPage:Z,totalPages:0,pageSize:Q,validator:$},t),ge=()=>N&&N.existsValue(e)?N.getValue(e).getCurrentPage():D?D.getCurrentPage():0,[p,_]=T.useState({dataSource:Ee(),isLoading:!1,isError:!1,error:"",name:e,label:t,filter:i,sort:o,id:fe,currentPage:ge(),pageSize:Q,loadDataCount:me()?1:0}),ee=async(m,l,h,E,c,W,Ie,Se,_e)=>{let f;if(W){const w=await r.findOne(W);w?f=se.createFromValues([w],1,0,0,0):f=se.createFromValues([],0,0,0,0)}else j&&E&&c&&c.length>0?f=await j(E,l,h,c):K&&E?f=await K(E,l,h):Y&&c&&c.length>0?f=await Y(l,h,c):X?f=await X(l,h):E&&c&&c.length>0?f=await r.findAllWithFilterAndSort(E,l,h,c):E?f=await r.findAllWithFilter(E,l,h):c&&c.length>0?f=await r.findAllWithSort(l,h,c):f=await r.findAll(l,h);I&&(f=I(f)),a&&(f=a(f)),_(w=>{const re={records:f.content,grandTotalRecords:f.totalElements,totalPages:f.totalPages,currentPage:f.pageable.pageNumber,pageSize:h,filter:E,sort:c,originFilter:Ie,originGlobalFilter:_e,originSort:Se,validator:$};return w.dataSource.isActive()?w.dataSource.setData(re):w.dataSource.open(re),{...w,currentPage:l,pageSize:h,filter:E,sort:c,id:W,isLoading:!1,isError:!1,error:"",loadDataCount:w.loadDataCount+1}}),N&&N.setValue(e,p.dataSource)};T.useEffect(()=>{u&&p.loadDataCount>0&&u(p.dataSource)},[p.loadDataCount]);const te=m=>{if(m.type===S.refreshData){const l=m.options;try{_(h=>({...h,isLoading:!0,filter:l.filter,sort:l.sort,currentPage:l.currentPage,id:l.id})),ee(p.name,l.currentPage,l.pageSize,l.filter,l.sort,l.id,l.originFilter,l.originSort,l.originGlobalFilter).catch(h=>{const E=b(h);_(c=>({...c,isError:!0,isLoading:!1,error:E})),s.onError&&s.onError(E,h)})}catch(h){const E=b(h);_(c=>({...c,isError:!0,isLoading:!1,error:E})),s.onError&&s.onError(E,h)}}},Ne=m=>{m.addListener(te)},ye=m=>{m.removeListener(te)};T.useEffect(()=>{try{return Ne(p.dataSource),ce&&p.loadDataCount===0?(_(m=>({...m,isLoading:!0})),ee(p.name,Z,Q,p.filter,p.sort,p.id).catch(m=>{const l=b(m);_(h=>({...h,isError:!0,isLoading:!1,error:l})),s.onError&&s.onError(l,m)})):u&&u(p.dataSource),()=>{F&&(ye(p.dataSource),F(p.dataSource))}}catch(m){const l=b(m);_(h=>({...h,isError:!0,isLoading:!1,error:l})),s.onError&&s.onError(l,m)}},[p.name,p.sort,p.filter,p.id,p.currentPage,p.pageSize]);const Fe=()=>{_(m=>({...m,isError:!1,isLoading:!1,error:""}))};return{isLoading:p.isLoading,isError:p.isError,error:p.error,dataSource:p.dataSource,clearError:Fe}}export{ve as A,Be as N,Ue as O,de as Q,J as a,pe as b,Ge as c,ae as d,He as e,Me as f,ze as g,z as h,ke as i,Te as j,H as k,G as l,ne as m,le as n,xe as o,be as p,k as q,Je as u};
