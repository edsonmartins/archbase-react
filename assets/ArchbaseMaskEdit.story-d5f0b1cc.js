import{j as y,a as x}from"./jsx-runtime-c9381026.js";import{r as F}from"./index-8b3efc3f.js";import{u as W,a as H}from"./useArchbaseDataSource-c5d317be.js";import{u as J,D as K}from"./useArchbaseDataSourceListener-92dd263c.js";import"./index-9e992aa6.js";import{A as L,M as Y}from"./ArchbaseMaskEdit-663eced9.js";import{t as B}from"./i18next-a4b2730f.js";import{p as q}from"./pessoasData-6b8000da.js";import{G as A}from"./Grid-a32d8833.js";import{C as V}from"./Card-a798b247.js";import{G as S}from"./Group-4c03121b.js";import{T as P}from"./Text-f3cc4e22.js";import{B as z}from"./Button-115efac8.js";import{A as Q}from"./ArchbaseNotifications-d2943952.js";import{A as X}from"./ArchbaseObjectInspector-cc5955d4.js";import"./_commonjsHelpers-de833af9.js";import"./lodash-4d0be66a.js";import"./index-1905cc86.js";import"./index-d0400ba7.js";import"./input-30511812.js";import"./index-9d475cdf.js";import"./use-input-props-317debde.js";import"./polymorphic-factory-f5c952a9.js";import"./Mantine.context-1df84d45.js";import"./use-id-3df0f1f4.js";import"./use-isomorphic-effect-aa890e3d.js";import"./use-force-update-11fe72c1.js";import"./Input-c2ac992d.js";import"./create-optional-context-86e78b6c.js";import"./types-5decf4ed.js";import"./create-safe-context-941c9e18.js";import"./get-sorted-breakpoints-91e0685a.js";import"./px-90b8b31c.js";import"./Paper-4536b30f.js";import"./Loader-7e5b6750.js";import"./Transition-31651d20.js";import"./index-a38d0dca.js";import"./use-reduced-motion-98306cff.js";import"./use-media-query-78751440.js";import"./use-did-update-bccd292e.js";import"./UnstyledButton-5ed8db2e.js";import"./notifications.store-79c361f9.js";import"./store-704b6bc9.js";import"./IconBug-b91acd15.js";import"./createReactComponent-60e598cf.js";import"./use-mantine-color-scheme-bbd48c20.js";class R{constructor(t){this.groups=[],this.each=!1,this.context=void 0,this.type=t.type,this.name=t.name,this.target=t.target,this.propertyName=t.propertyName,this.constraints=t==null?void 0:t.constraints,this.constraintCls=t.constraintCls,this.validationTypeOptions=t.validationTypeOptions,t.validationOptions&&(this.message=t.validationOptions.message,this.groups=t.validationOptions.groups,this.always=t.validationOptions.always,this.each=t.validationOptions.each,this.context=t.validationOptions.context)}}class Z{transform(t){const i=[];return Object.keys(t.properties).forEach(s=>{t.properties[s].forEach(e=>{const r={message:e.message,groups:e.groups,always:e.always,each:e.each},a={type:e.type,name:e.name,target:t.name,propertyName:s,constraints:e.constraints,validationTypeOptions:e.options,validationOptions:r};i.push(new R(a))})}),i}}function j(n){return n instanceof Map?Array.from(n.values()):Array.isArray(n)?n:Array.from(n)}function tt(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function I(n){return n!==null&&typeof n=="object"&&typeof n.then=="function"}class U{constructor(){this.validationMetadatas=new Map,this.constraintMetadatas=new Map}get hasValidationMetaData(){return!!this.validationMetadatas.size}addValidationSchema(t){new Z().transform(t).forEach(s=>this.addValidationMetadata(s))}addValidationMetadata(t){const i=this.validationMetadatas.get(t.target);i?i.push(t):this.validationMetadatas.set(t.target,[t])}addConstraintMetadata(t){const i=this.constraintMetadatas.get(t.target);i?i.push(t):this.constraintMetadatas.set(t.target,[t])}groupByPropertyName(t){const i={};return t.forEach(s=>{i[s.propertyName]||(i[s.propertyName]=[]),i[s.propertyName].push(s)}),i}getTargetValidationMetadatas(t,i,s,e,r){const a=o=>typeof o.always<"u"?o.always:o.groups&&o.groups.length?!1:s,c=o=>!!(e&&(!r||!r.length)&&o.groups&&o.groups.length),d=(this.validationMetadatas.get(t)||[]).filter(o=>o.target!==t&&o.target!==i?!1:a(o)?!0:c(o)?!1:r&&r.length>0?o.groups&&!!o.groups.find(f=>r.indexOf(f)!==-1):!0),u=[];for(const[o,f]of this.validationMetadatas.entries())t.prototype instanceof o&&u.push(...f);const l=u.filter(o=>typeof o.target=="string"||o.target===t||o.target instanceof Function&&!(t.prototype instanceof o.target)?!1:a(o)?!0:c(o)?!1:r&&r.length>0?o.groups&&!!o.groups.find(f=>r.indexOf(f)!==-1):!0).filter(o=>!d.find(f=>f.propertyName===o.propertyName&&f.type===o.type));return d.concat(l)}getTargetValidatorConstraints(t){return this.constraintMetadatas.get(t)||[]}}function T(){const n=tt();return n.classValidatorMetadataStorage||(n.classValidatorMetadataStorage=new U),n.classValidatorMetadataStorage}class C{toString(t=!1,i=!1,s="",e=!1){const r=t?"\x1B[1m":"",a=t?"\x1B[22m":"",c=()=>(e?Object.values:Object.keys)(this.constraints??{}).join(", "),p=d=>` - property ${r}${s}${d}${a} has failed the following constraints: ${r}${c()}${a} 
`;if(i){const d=Number.isInteger(+this.property)?`[${this.property}]`:`${s?".":""}${this.property}`;return this.constraints?p(d):this.children?this.children.map(u=>u.toString(t,!0,`${s}${d}`,e)).join(""):""}else return`An instance of ${r}${this.target?this.target.constructor.name:"an object"}${a} has failed the validation:
`+(this.constraints?p(this.property):"")+(this.children?this.children.map(d=>d.toString(t,!0,this.property,e)).join(""):"")}}class h{static isValid(t){return t!=="isValid"&&t!=="getMessage"&&Object.keys(this).map(i=>this[i]).indexOf(t)!==-1}}h.CUSTOM_VALIDATION="customValidation";h.NESTED_VALIDATION="nestedValidation";h.PROMISE_VALIDATION="promiseValidation";h.CONDITIONAL_VALIDATION="conditionalValidation";h.WHITELIST="whitelistValidation";h.IS_DEFINED="isDefined";function it(n){return Array.isArray(n)?n.join(", "):(typeof n=="symbol"&&(n=n.description),`${n}`)}class et{static replaceMessageSpecialTokens(t,i){let s;return t instanceof Function?s=t(i):typeof t=="string"&&(s=t),s&&Array.isArray(i.constraints)&&i.constraints.forEach((e,r)=>{s=s.replace(new RegExp(`\\$constraint${r+1}`,"g"),it(e))}),s&&i.value!==void 0&&i.value!==null&&["string","boolean","number"].includes(typeof i.value)&&(s=s.replace(/\$value/g,i.value)),s&&(s=s.replace(/\$property/g,i.property)),s&&(s=s.replace(/\$target/g,i.targetName)),s}}class D{constructor(t,i){this.validator=t,this.validatorOptions=i,this.awaitingPromises=[],this.ignoreAsyncValidations=!1,this.metadataStorage=T()}execute(t,i,s){var u,O;!this.metadataStorage.hasValidationMetaData&&((u=this.validatorOptions)==null?void 0:u.enableDebugMessages)===!0&&console.warn(`No validation metadata found. No validation will be  performed. There are multiple possible reasons:
  - There may be multiple class-validator versions installed. You will need to flatten your dependencies to fix the issue.
  - This validation runs before any file with validation decorator was parsed by NodeJS.`);const e=this.validatorOptions?this.validatorOptions.groups:void 0,r=this.validatorOptions&&this.validatorOptions.strictGroups||!1,a=this.validatorOptions&&this.validatorOptions.always||!1,c=((O=this.validatorOptions)==null?void 0:O.forbidUnknownValues)===void 0||this.validatorOptions.forbidUnknownValues!==!1,p=this.metadataStorage.getTargetValidationMetadatas(t.constructor,i,a,r,e),d=this.metadataStorage.groupByPropertyName(p);if(this.validatorOptions&&c&&!p.length){const l=new C;(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(l.target=t),l.value=void 0,l.property=void 0,l.children=[],l.constraints={unknownValue:"an unknown value was passed to the validate function"},s.push(l);return}this.validatorOptions&&this.validatorOptions.whitelist&&this.whitelist(t,d,s),Object.keys(d).forEach(l=>{const o=t[l],f=d[l].filter(g=>g.type===h.IS_DEFINED),v=d[l].filter(g=>g.type!==h.IS_DEFINED&&g.type!==h.WHITELIST);o instanceof Promise&&v.find(g=>g.type===h.PROMISE_VALIDATION)?this.awaitingPromises.push(o.then(g=>{this.performValidations(t,g,l,f,v,s)})):this.performValidations(t,o,l,f,v,s)})}whitelist(t,i,s){const e=[];Object.keys(t).forEach(r=>{(!i[r]||i[r].length===0)&&e.push(r)}),e.length>0&&(this.validatorOptions&&this.validatorOptions.forbidNonWhitelisted?e.forEach(r=>{const a=this.generateValidationError(t,t[r],r);a.constraints={[h.WHITELIST]:`property ${r} should not exist`},a.children=void 0,s.push(a)}):e.forEach(r=>delete t[r]))}stripEmptyErrors(t){return t.filter(i=>{if(i.children&&(i.children=this.stripEmptyErrors(i.children)),Object.keys(i.constraints).length===0){if(i.children.length===0)return!1;delete i.constraints}return!0})}performValidations(t,i,s,e,r,a){const c=r.filter(l=>l.type===h.CUSTOM_VALIDATION),p=r.filter(l=>l.type===h.NESTED_VALIDATION),d=r.filter(l=>l.type===h.CONDITIONAL_VALIDATION),u=this.generateValidationError(t,i,s);a.push(u),this.conditionalValidations(t,i,d)&&(this.customValidations(t,i,e,u),this.mapContexts(t,i,e,u),!(i===void 0&&this.validatorOptions&&this.validatorOptions.skipUndefinedProperties===!0)&&(i===null&&this.validatorOptions&&this.validatorOptions.skipNullProperties===!0||i==null&&this.validatorOptions&&this.validatorOptions.skipMissingProperties===!0||(this.customValidations(t,i,c,u),this.nestedValidations(i,p,u),this.mapContexts(t,i,r,u),this.mapContexts(t,i,c,u))))}generateValidationError(t,i,s){const e=new C;return(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(e.target=t),(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.value===void 0||this.validatorOptions.validationError.value===!0)&&(e.value=i),e.property=s,e.children=[],e.constraints={},e}conditionalValidations(t,i,s){return s.map(e=>e.constraints[0](t,i)).reduce((e,r)=>e&&r,!0)}customValidations(t,i,s,e){s.forEach(r=>{this.metadataStorage.getTargetValidatorConstraints(r.constraintCls).forEach(a=>{if(a.async&&this.ignoreAsyncValidations||this.validatorOptions&&this.validatorOptions.stopAtFirstError&&Object.keys(e.constraints||{}).length>0)return;const c={targetName:t.constructor?t.constructor.name:void 0,property:r.propertyName,object:t,value:i,constraints:r.constraints};if(!r.each||!(Array.isArray(i)||i instanceof Set||i instanceof Map)){const l=a.instance.validate(i,c);if(I(l)){const o=l.then(f=>{if(!f){const[v,g]=this.createValidationError(t,i,r,a);e.constraints[v]=g,r.context&&(e.contexts||(e.contexts={}),e.contexts[v]=Object.assign(e.contexts[v]||{},r.context))}});this.awaitingPromises.push(o)}else if(!l){const[o,f]=this.createValidationError(t,i,r,a);e.constraints[o]=f}return}const d=j(i).map(l=>a.instance.validate(l,c));if(d.some(l=>I(l))){const l=d.map(f=>I(f)?f:Promise.resolve(f)),o=Promise.all(l).then(f=>{if(!f.every(g=>g)){const[g,G]=this.createValidationError(t,i,r,a);e.constraints[g]=G,r.context&&(e.contexts||(e.contexts={}),e.contexts[g]=Object.assign(e.contexts[g]||{},r.context))}});this.awaitingPromises.push(o);return}if(!d.every(l=>l)){const[l,o]=this.createValidationError(t,i,r,a);e.constraints[l]=o}})})}nestedValidations(t,i,s){t!==void 0&&i.forEach(e=>{if(!(e.type!==h.NESTED_VALIDATION&&e.type!==h.PROMISE_VALIDATION)&&!(this.validatorOptions&&this.validatorOptions.stopAtFirstError&&Object.keys(s.constraints||{}).length>0))if(Array.isArray(t)||t instanceof Set||t instanceof Map)(t instanceof Set?Array.from(t):t).forEach((a,c)=>{this.performValidations(t,a,c.toString(),[],i,s.children)});else if(t instanceof Object){const r=typeof e.target=="string"?e.target:e.target.name;this.execute(t,r,s.children)}else{const[r,a]=this.createValidationError(e.target,t,e);s.constraints[r]=a}})}mapContexts(t,i,s,e){return s.forEach(r=>{if(r.context){let a;r.type===h.CUSTOM_VALIDATION&&(a=this.metadataStorage.getTargetValidatorConstraints(r.constraintCls)[0]);const c=this.getConstraintType(r,a);e.constraints[c]&&(e.contexts||(e.contexts={}),e.contexts[c]=Object.assign(e.contexts[c]||{},r.context))}})}createValidationError(t,i,s,e){const r=t.constructor?t.constructor.name:void 0,a=this.getConstraintType(s,e),c={targetName:r,property:s.propertyName,object:t,value:i,constraints:s.constraints};let p=s.message||"";!s.message&&(!this.validatorOptions||this.validatorOptions&&!this.validatorOptions.dismissDefaultMessages)&&e&&e.instance.defaultMessage instanceof Function&&(p=e.instance.defaultMessage(c));const d=et.replaceMessageSpecialTokens(p,c);return[a,d]}getConstraintType(t,i){return i&&i.name?i.name:t.type}}class E{validate(t,i,s){return this.coreValidate(t,i,s)}async validateOrReject(t,i,s){const e=await this.coreValidate(t,i,s);if(e.length)return Promise.reject(e)}validateSync(t,i,s){const e=typeof t=="string"?i:t,r=typeof t=="string"?s:i,a=typeof t=="string"?t:void 0,c=new D(this,r);c.ignoreAsyncValidations=!0;const p=[];return c.execute(e,a,p),c.stripEmptyErrors(p)}coreValidate(t,i,s){const e=typeof t=="string"?i:t,r=typeof t=="string"?s:i,a=typeof t=="string"?t:void 0,c=new D(this,r),p=[];return c.execute(e,a,p),Promise.all(c.awaitingPromises).then(()=>c.stripEmptyErrors(p))}}const st=new class{constructor(){this.instances=[]}get(n){let t=this.instances.find(i=>i.type===n);return t||(t={type:n,object:new n},this.instances.push(t)),t.object}};let N,_;function m(n){if(N)try{const t=N.get(n);if(t||!_||!_.fallback)return t}catch(t){throw t}return st.get(n)}class nt{constructor(t,i,s=!1){this.target=t,this.name=i,this.async=s}get instance(){return m(this.target)}}function rt(n){let t;if(n.validator instanceof Function){if(t=n.validator,m(U).getTargetValidatorConstraints(n.validator).length>1)throw`More than one implementation of ValidatorConstraintInterface found for validator on: ${n.target.name}:${n.propertyName}`}else{const s=n.validator;t=class{validate(r,a){return s.validate(r,a)}defaultMessage(r){return s.defaultMessage?s.defaultMessage(r):""}},T().addConstraintMetadata(new nt(t,n.name,n.async))}const i={type:n.name&&h.isValid(n.name)?n.name:h.CUSTOM_VALIDATION,name:n.name,target:n.target,propertyName:n.propertyName,validationOptions:n.options,constraintCls:t,constraints:n.constraints};T().addValidationMetadata(new R(i))}function at(n,t){return i=>{const s=t&&t.each?`${B("archbase:each value in ")}`:"";return n(s,i)}}function ot(n,t){return function(i,s){rt({name:n.name,target:i.constructor,propertyName:s,options:t,constraints:n.constraints,validator:n.validator})}}const lt="isNotEmpty";function ct(n){return n!==""&&n!==null&&n!==void 0}function dt(n){return ot({name:lt,validator:{validate:(t,i)=>ct(t),defaultMessage:at(t=>t+`${B("archbase:$property should not be empty")}`,n)}},n)}function ft(n,t,i){return typeof n=="string"?m(E).validate(n,t,i):m(E).validate(n,t)}function pt(n,t,i){return typeof n=="string"?m(E).validateOrReject(n,t,i):m(E).validateOrReject(n,t)}function ht(n,t,i){return typeof n=="string"?m(E).validateSync(n,t,i):m(E).validateSync(n,t)}class ut{constructor(){}validateEntity(t){const i=ht(t),s=[];return i.forEach(e=>{if(e.constraints)for(const[r,a]of Object.entries(e.constraints))s.push({errorMessage:a,debugMessage:`key: ${r} value: ${a}`,fieldName:e.property})}),s}validate(t,i){return ft(t,i)}validateOrReject(t,i){return pt(t,i)}}const gt=()=>{const[n,t]=F.useState();if(!n){const i=new ut;return t(i),i}return n};var yt=Object.defineProperty,vt=Object.getOwnPropertyDescriptor,mt=(n,t,i,s)=>{for(var e=s>1?void 0:s?vt(t,i):t,r=n.length-1,a;r>=0;r--)(a=n[r])&&(e=(s?a(t,i,e):a(e))||e);return s&&e&&yt(t,i,e),e};const M=class{constructor(t){this.id=t.id,this.nome=t.nome,this.idade=t.idade,this.cpf=t.cpf,this.rg=t.rg,this.data_nasc=t.data_nasc,this.sexo=t.sexo,this.signo=t.signo,this.mae=t.mae,this.pai=t.pai,this.email=t.email,this.senha=t.senha,this.cep=t.cep,this.endereco=t.endereco,this.numero=t.numero,this.bairro=t.bairro,this.cidade=t.cidade,this.estado=t.estado,this.telefone_fixo=t.telefone_fixo,this.celular=t.celular,this.altura=t.altura,this.peso=t.peso,this.avaliacao=t.avaliacao,this.tipo_sanguineo=t.tipo_sanguineo,this.cor=t.cor,this.foto=t.foto,this.status=t.status,this.observacao=t.observacao,this.codigoJson=t.codigoJson,this.creditoOK=t.creditoOK}};M.newInstance=()=>new M({});mt([dt({message:"CPF é obrigatório"})],M.prototype,"cpf",2);let Et=M;const Ot=()=>{const[n,t]=F.useState(!1),i=W(),s=gt(),{dataSource:e}=H({initialData:Vt,validator:s,name:"dsPessoas"});return e!=null&&e.isBrowsing()&&!(e!=null&&e.isEmpty())&&e.edit(),J({dataSource:e,listener:r=>{switch(r.type){case K.fieldChanged:{i();break}}}}),x(A,{children:[y(A.Col,{offset:1,span:4,children:x(V,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[y(V.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:y(S,{justify:"space-between",children:y(P,{fw:500,children:"Mask Edit Component"})})}),y(L,{title:"CPF",dataSource:e,dataField:"cpf",mask:Y.CPF,onChangeError:r=>t(!!r)}),y(z,{onClick:()=>{n||e.save(()=>{Q.showSuccess("Sucesso","CPF salvo"),e.edit()})},children:"Salvar"})]})}),y(A.Col,{span:4,children:x(V,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[y(V.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:y(S,{justify:"space-between",children:y(P,{fw:500,children:"DataSource dsPessoas"})})}),y(X,{data:e})]})})]})},Vt=[new Et(q[0])],yi={title:"Editores/Mask Edit",component:L},w={name:"Exemplo simples",render:()=>y(Ot,{})};var b,$,k;w.parameters={...w.parameters,docs:{...(b=w.parameters)==null?void 0:b.docs,source:{originalSource:`{
  name: 'Exemplo simples',
  render: () => <ArchbaseEditExample />
}`,...(k=($=w.parameters)==null?void 0:$.docs)==null?void 0:k.source}}};export{w as Primary,yi as default};
