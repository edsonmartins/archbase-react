import{r as c}from"./index-8b3efc3f.js";import{u as I}from"./use-window-event-860a85e7.js";function p(t,u="use-local-storage"){try{return JSON.stringify(t)}catch{throw new Error(`@mantine/hooks ${u}: Failed to serialize the value`)}}function F(t){try{return t&&JSON.parse(t)}catch{return t}}function N(t){return{getItem:r=>{try{return window[t].getItem(r)}catch{return console.warn("use-local-storage: Failed to get value from storage, localStorage is blocked"),null}},setItem:(r,i)=>{try{window[t].setItem(r,i)}catch{console.warn("use-local-storage: Failed to set value to storage, localStorage is blocked")}},removeItem:r=>{try{window[t].removeItem(r)}catch{console.warn("use-local-storage: Failed to remove value from storage, localStorage is blocked")}}}}function O(t,u){const a=t==="localStorage"?"mantine-local-storage":"mantine-session-storage",{getItem:v,setItem:r,removeItem:i}=N(t);return function({key:o,defaultValue:n,getInitialValueInEffect:b=!0,sync:f=!0,deserialize:S=F,serialize:h=g=>p(g,u)}){const g=c.useCallback(e=>{let s;try{s=typeof window>"u"||!(t in window)||window[t]===null||!!e}catch{s=!0}if(s)return n;const l=v(o);return l!==null?S(l):n},[o,n]),[m,d]=c.useState(g(b)),w=c.useCallback(e=>{e instanceof Function?d(s=>{const l=e(s);return r(o,h(l)),window.dispatchEvent(new CustomEvent(a,{detail:{key:o,value:e(s)}})),l}):(r(o,h(e)),window.dispatchEvent(new CustomEvent(a,{detail:{key:o,value:e}})),d(e))},[o]),C=c.useCallback(()=>{i(o),window.dispatchEvent(new CustomEvent(a,{detail:{key:o,value:n}}))},[]);return I("storage",e=>{f&&e.storageArea===window[t]&&e.key===o&&d(S(e.newValue??void 0))}),I(a,e=>{f&&e.detail.key===o&&d(e.detail.value)}),c.useEffect(()=>{n!==void 0&&m===void 0&&w(n)},[n,m,w]),c.useEffect(()=>{const e=g();e!==void 0&&w(e)},[o]),[m===void 0?n:m,w,C]}}function A(t){return O("localStorage","use-local-storage")(t)}export{A as u};
