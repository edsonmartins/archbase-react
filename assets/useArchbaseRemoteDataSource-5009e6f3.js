import{r as Y}from"./index-402471b7.js";import{a as ne,P as g,D as S,p as D,R as oe,S as he,T as le}from"./ArchbaseGlobalFilter-aa9cced9.js";import{i as x,D as H}from"./ArchbaseRemoteApiService-751ad5a8.js";const o={IS:"IS",BETWEEN:"BETWEEN",LIKE:"LIKE",EQ:"EQ",NEQ:"NEQ",GEQ:"GEQ",LEQ:"LEQ",GT:"GT",LT:"LT",NOT:"NOT",IN:"IN",IS_NOT:"IS_NOT",AND:"AND",OR:"OR"};function v(n,e){const t=Object.prototype.toString.call(e).slice(8,-1);return e!=null&&t===n}function pe(n){return n===o.IS||n===o.BETWEEN||n===o.LIKE||n===o.EQ||n===o.NEQ||n===o.GEQ||n===o.LEQ||n===o.GT||n===o.LT||n===o.NOT||n===o.IN||n===o.IS_NOT||n===o.AND||n===o.OR}const N={FIELD:"FIELD",FILTER:"FILTER",GROUP:"GROUP",OPERATION:"OPERATION",AND:"AND",OR:"OR",IN:"IN",BETWEEN:"BETWEEN"};class a{constructor(e){this.message=e,this.name="FilterException"}}class y{constructor(e,t){this.fieldName=e,this.fieldSql=t,this.expressionType=N.FIELD}getFieldName(){return this.fieldName()}setFieldName(e){this.fieldName=e}toJSON(e){e.append('"type" : "FIELD",'),e.append('"name" : "'+this.fieldName+'"'),this.fieldSql&&e.append(', "nameSql" : "'+this.fieldSql+'"')}}class A{constructor(){this.expressionType=N.FILTER}applyOperation(e,t){throw new a("applyOperation só pode ser usado nas classes concretas.")}applyInOperation(){throw new a("applyInOperation só pode ser usado nas classes concretas.")}applyNotInOperation(){throw new a("applyNotInOperation só pode ser usado nas classes concretas.")}applyBetweenOperation(){throw new a("applyBetweenOperation só pode ser usado nas classes concretas.")}EQ(e){return this.applyOperation(o.EQ,e)}NEQ(e){return this.applyOperation(o.NEQ,e)}GEQ(e){return this.applyOperation(o.GEQ,e)}GT(e){return this.applyOperation(o.GT,e)}LT(e){return this.applyOperation(o.LT,e)}AND(){if(arguments.length===3)return new b(this,new O(arguments[0],arguments[1],arguments[2]));if(arguments.length===1)if(typeof arguments[0]=="object"){if(arguments[0].expressionType===void 0)throw new a("Tipo de parâmetro incorreto para uso de AND. Parâmetro "+arguments[0]);return arguments[0].expressionType===N.FIELD?new b(this,new O(arguments[0])):new b(this,arguments[0])}else throw new a("Parâmetro deve ser do tipo Object.");else throw new a("Número de parâmetros incorretos para a chamade de AND")}OR(){if(arguments.length===4)return new R(this,new R(arguments[0],arguments[1],arguments[2]));if(arguments.length===1)if(typeof arguments[0]=="object"){if(arguments[0].expressionType===void 0)throw new a("Tipo de parâmetro incorreto para uso de OR. Parâmetro "+arguments[0]);return arguments[0].expressionType===N.FIELD?new R(this,new O(arguments[0])):new R(this,arguments[0])}else throw new a("Parâmetro deve ser do tipo Object.");else throw new a("Número de parâmetros incorretos para a chamade de OR")}LEQ(e){return this.applyOperation(o.LEQ,e)}LIKE(e){return this.applyOperation(o.LIKE,e)}BETWEEN(e,t){return this.applyBetweenOperation(e,t)}STARTSWITH(e){if(ArchbaseStringUtils.isEmpty(e))throw new a("Para usar STARTSWITH informe um valor.");return e=e.concat("%"),this.applyOperation(o.LIKE,e)}ENDSWITH(e){if(ArchbaseStringUtils.isEmpty(e))throw new a("Para usar ENDSWITH informe um valor.");return e="%".concat(e),this.applyOperation(o.LIKE,e)}CONTAINS(e){if(ArchbaseStringUtils.isEmpty(e))throw new a("Para usar v informe um valor.");return e="%".concat(e.concat("%")),this.applyOperation(o.LIKE,e)}IN(){return this.applyInOperation(arguments[0])}NOTIN(){return this.applyNotInOperation(arguments[0])}ISNULL(){return this.applyOperation(o.IS,"NULL")}ISNOTNULL(){return this.applyOperation(o.IS_NOT,"NULL")}toJSON(e){throw new a("toJSON deve ser implementado nas classes concretas herdadas de FilterExpression.")}}class O extends A{constructor(e,t,s){super(),this.lhsValue=e,this.rhsValue=s,this.operator=t,this.expressionType=N.OPERATION}applyOperation(e,t){if(!pe(e))throw new a(e+" não é um operador válido.");if(this.operator!==void 0)throw new a("Não é possível aplicar "+e+" operation on an "+this.operator+" expression.");return new O(this.lhsValue,e,t)}applyInOperation(){if(arguments[0].length===0)throw new a("Para usar operação IN é necessário informar os valores.");if(!(this.lhsValue instanceof y))throw new a("Somente é possível aplicar a operação 'IN' em uma coluna.");return new X(this.lhsValue,!1,arguments[0])}applyNotInOperation(){if(arguments[0].length===0)throw new a("Para usar operação NOT IN é necessário informar os valores.");if(!(this.lhsValue instanceof y))throw new a("Somente é possível aplicar a operação 'NOT IN' em uma coluna.");return new X(this.lhsValue,!0,arguments[0])}applyBetweenOperation(e,t){if(e===void 0)throw new a("Para usar operação BETWEEN é necessário informar o valor inicial.");if(t===void 0)throw new a("Para usar operação BETWEEN é necessário informar o valor final.");if(!(this.lhsValue instanceof y))throw new a("Somente é possível aplicar a operação 'BETWEEN' em uma coluna.");return new de(this.lhsValue,e,t)}toJSON(e){e.append('"type" : "OP",'),e.append('"lhsValue" : {'),this.lhsValue.toJSON(e),e.append("},"),v("Number",this.rhsValue)?e.append('"rhsValue" : '+this.rhsValue+","):e.append('"rhsValue" : "'+this.rhsValue+'",'),e.append('"operator" : "'+this.operator+'"')}}class K extends A{constructor(e){super(),this.expressions=e,this.expressionType=N.GROUP}getExpressions(){return this.expressions}getOperator(){throw new a("Uso incorreto do método. Este método deve ser implementado por classes concretas que herdam de GroupExpression.")}applyOperation(e,t){const s=this.expressions.length-1,r=this.expressions[s];return this.expressions[s]=r.applyOperation(e,t),this}applyInOperation(){const e=this.expressions.length-1,t=this.expressions[e];return this.expressions[e]=t.applyInOperation(arguments[0]),this}applyNotInOperation(){const e=this.expressions.length-1,t=this.expressions[e];return this.expressions[e]=t.applyNotInOperation(arguments[0]),this}applyBetweenOperation(e,t){const s=this.expressions.length-1,r=this.expressions[s];return this.expressions[s]=r.applyBetweenOperation(e,t),this}toJSON(e){e.append('"type" : "'+this.getOperator()+'",'),e.append('"expressions" : [');let t=!1;for(let s=0;s<this.expressions.length;s++)t&&e.append(","),e.append("{"),this.expressions[s].toJSON(e),e.append("}"),t=!0;e.append("]")}}class X extends A{constructor(){if(super(),arguments.length<3)throw new a("Para usar a expressão IN informe os parâmetros corretamente.");this.field=arguments[0],this.negative=arguments[1],this.values=arguments[2],this.expressionType=N.IN}isNegative(){return this.negative}applyOperation(e,t){throw new a("Não é possível aplicar a operação "+e+" na expressão IN.")}applyInOperation(){throw new a("Não é possível aplicar a operação IN na expressão IN.")}applyNotInOperation(){throw new a("Não é possível aplicar a operação NOT IN na expressão IN.")}applyBetweenOperation(e,t){throw new a("Não é possível aplicar a operação BETWEEEN na expressão IN.")}toJSON(e){e.append('"type" : "IN",'),e.append('"field" : {'),this.field.toJSON(e),e.append("},"),e.append('"values" : [');let t=!1;for(let s=0;s<this.values.length;s++)t&&e.append(","),v("Number",this.values[s])?e.append(this.values[s]):e.append('"'+this.values[s]+'"'),t=!0;e.append("],"),e.append('"negative" : '+this.negative)}}class de extends A{constructor(e,t,s){if(super(),e===void 0)throw new a("Informe o valor do field para usar BETWEEN.");if(t===void 0)throw new a("Informe o valor inicial para usar BETWEEN.");if(s===void 0)throw new a("Informe o valor final para usar BETWEEN.");this.field=e,this.valueStart=t,this.valueEnd=s,this.expressionType=N.BETWEEN}applyOperation(e,t){throw new a("Não é possível aplicar a operação "+e+" na expressão BETWEEN.")}applyInOperation(){throw new a("Não é possível aplicar a operação IN na expressão BETWEEN.")}applyNotInOperation(){throw new a("Não é possível aplicar a operação NOT IN na expressão BETWEEN.")}applyBetweenOperation(e,t){throw new a("Não é possível aplicar a operação BETWEEEN na expressão BETWEEN.")}toJSON(e){e.append('"type" : "BETWEEN",'),e.append('"field" : {'),this.field.toJSON(e),e.append("},"),v("Number",this.valueStart)?e.append('"valueStart" : '+this.valueStart+","):e.append('"valueStart" : "'+this.valueStart+'",'),v("Number",this.valueEnd)?e.append('"valueEnd" : '+this.valueEnd):e.append('"valueEnd" : "'+this.valueEnd+'"')}}class b extends K{constructor(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);super(e),this.expressionType=N.AND}getOperator(){return o.AND}}class R extends K{constructor(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);super(e),this.expressionType=N.OR}getOperator(){return o.OR}}class ue{constructor(){this.filterExpression=null,this.fieldsToSort=[],this.processRules=this.processRules.bind(this),this.WHERE=this.WHERE.bind(this),this.EQ=this.EQ.bind(this),this.NEQ=this.NEQ.bind(this),this.GEQ=this.GEQ.bind(this),this.LEQ=this.LEQ.bind(this),this.GT=this.GT.bind(this),this.LT=this.LT.bind(this),this.LIKE=this.LIKE.bind(this),this.IN=this.IN.bind(this),this.NOTIN=this.NOTIN.bind(this),this.AND=this.AND.bind(this),this.OR=this.OR.bind(this),this.ISNULL=this.ISNULL.bind(this),this.ISNOTNULL=this.ISNOTNULL.bind(this),this.betweenOrOp=this.betweenOrOp.bind(this),this.BETWEEN=this.BETWEEN.bind(this),this.OP=this.OP.bind(this),this.STARTSWITH=this.STARTSWITH.bind(this),this.CONTAINS=this.CONTAINS.bind(this),this.toJSON=this.toJSON.bind(this)}assertWhereClauseIsInitialized(e){if(this.filterExpression===null||this.filterExpression===void 0)throw new a("Não é possível aplicar '"+e+"' operador se o cláusula WHERE não existir.")}buildFrom(e,t){e.rules&&(this.processRules(e.condition,e.rules,!0),t&&t.sortFields&&t.sortFields.forEach(s=>{s.selected&&this.fieldsToSort.push(s.name+" "+s.asc_desc)}))}processRules(e,t,s){t.forEach(r=>{if(r.field&&!r.disabled){let l=_this.AND;e==="or"&&(l=_this.OR),s&&(l=_this.WHERE);let i=r.value,m=r.value2;i&&i!==""&&(r.dataType==="date"?i=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(i,"DD/MM/YYYY"),Archbase.dataSourceDatetimeFormat):r.dataType==="date_time"&&(i=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(i,"DD/MM/YYYY hh:mm:ss"),Archbase.dataSourceDatetimeFormat))),m&&m!==""&&(r.dataType==="date"?m=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(m,"DD/MM/YYYY"),Archbase.dataSourceDatetimeFormat):r.dataType==="date_time"&&(m=ArchbaseDateUtils.formatDate(ArchbaseDateUtils.parseDateWithFormat(m,"DD/MM/YYYY hh:mm:ss"),Archbase.dataSourceDatetimeFormat))),r.operator==="null"?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).ISNULL(),s=!1):r.operator==="notNull"?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).ISNOTNULL(),s=!1):r.operator==="contains"&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).CONTAINS(i),s=!1):r.operator==="startsWith"&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).STARTSWITH(i),s=!1):r.operator==="endsWith"&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).ENDSWITH(i),s=!1):r.operator==="="&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).EQ(i),s=!1):r.operator==="!="&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).NEQ(i),s=!1):r.operator==="<"&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).LT(i),s=!1):r.operator===">"&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).GT(i),s=!1):r.operator==="<="&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).LEQ(i),s=!1):r.operator===">="&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).GEQ(i),s=!1):r.operator==="between"&&i&&i!==""&&m&&m!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).BETWEEN(i,m),s=!1):r.operator==="inList"&&i&&i!==""?(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).IN(i),s=!1):r.operator==="notInList"&&i&&i!==""&&(l(_this.EXP(_this.FIELD(r.field,r.fieldSql))).NOTIN(i),s=!1)}}),t.forEach(r=>{r.rules&&this.processRules(r.condition,r.rules,s)})}FIELD(e,t){return new y(e,t)}EXP(e){return new O(e)}WHERE(){if(arguments.length<1)throw new a("Para criar uma condição WHERE informe ao menos um parâmetro.");return arguments.length===3?arguments[2]!==void 0&&(this.filterExpression=new O(arguments[0],arguments[1],arguments[2])):(this.filterExpression=arguments[0],arguments[0].expressionType!==void 0&&arguments[0].expressionType===N.FIELD&&(this.filterExpression=new O(arguments[0]))),this}EQ(e){return this.assertWhereClauseIsInitialized("eq"),this.filterExpression=this.filterExpression.EQ(e),this}NEQ(e){return this.assertWhereClauseIsInitialized("neq"),this.filterExpression=this.filterExpression.NEQ(e),this}GEQ(e){return this.assertWhereClauseIsInitialized("geq"),this.filterExpression=this.filterExpression.GEQ(e),this}LEQ(e){return this.assertWhereClauseIsInitialized("leq"),this.filterExpression=this.filterExpression.LEQ(e),this}GT(e){return this.assertWhereClauseIsInitialized("gt"),this.filterExpression=this.filterExpression.GT(e),this}LT(e){return this.assertWhereClauseIsInitialized("lt"),this.filterExpression=this.filterExpression.LT(e),this}LIKE(e){return this.assertWhereClauseIsInitialized("like"),this.filterExpression=this.filterExpression.LIKE(e),this}IN(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);return this.assertWhereClauseIsInitialized("in"),this.filterExpression=this.filterExpression.IN(e),this}NOTIN(){const e=[];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);return this.assertWhereClauseIsInitialized("not in"),this.filterExpression=this.filterExpression.NOTIN(e),this}AND(e){return this.assertWhereClauseIsInitialized("and"),this.filterExpression=this.filterExpression.AND(e),this}OR(e){return this.assertWhereClauseIsInitialized("or"),this.filterExpression=this.filterExpression.OR(e),this}ISNULL(){return this.assertWhereClauseIsInitialized("isNull"),this.filterExpression=this.filterExpression.ISNULL(),this}ISNOTNULL(){return this.assertWhereClauseIsInitialized("isNotNull"),this.filterExpression=this.filterExpression.ISNOTNULL(),this}betweenOrOp(e,t,s){return this.assertWhereClauseIsInitialized(e),this.filterExpression=this.filterExpression.betweenOrOp(e,t,s),this}BETWEEN(e,t){return this.assertWhereClauseIsInitialized("between"),this.filterExpression=this.filterExpression.BETWEEN(e,t),this}OP(e,t){return this.assertWhereClauseIsInitialized(e),this.filterExpression=this.filterExpression.applyOperation(e,t),this}STARTSWITH(e){return this.assertWhereClauseIsInitialized("startsWith"),this.filterExpression=this.filterExpression.STARTSWITH(e),this}CONTAINS(e){return this.assertWhereClauseIsInitialized("contains"),this.filterExpression=this.filterExpression.CONTAINS(e),this}SORTBY(e,t){e instanceof y?this.fieldsToSort.push(e.getFieldName+(t===!0?" DESC":" ASC")):this.fieldsToSort.push(e+(t===!0?" DESC":" ASC"))}toJSON(){if(this.filterExpression!==void 0&&this.filterExpression!=null){const e=ArchbaseStringUtils.createStringBuilder();e.append("{"),e.append('   "filterExpression" : {'),this.filterExpression.toJSON(e),e.append("}, "),e.append('    "fieldsToSort" : [');let t=!1;return this.fieldsToSort.forEach(function(s){t===!0&&e.append(", "),e.append('{ "field" : "'+s+'" }'),t=!0}),e.append("]"),e.append("}"),e.toString()}}}class ce extends ne{constructor(e,t,s,r){super(t,s,r),this.service=e}async save(e){if(this.validateDataSourceActive("save"),!this.inserting&&!this.editing){const t=x.t("archbase:saveRecordIsNotAllowed",{dataSourceName:this.name});throw this.publishEventError(t,{}),new g(t)}if(!this.currentRecord){const t=x.t("archbase:noRecordToSave",{dataSourceName:this.name});throw this.publishEventError(t,{}),new g(t)}if(this.emitter.emit("beforeSave",this.currentRecord),this.emit({type:S.beforeSave,record:this.currentRecord,index:this.getCurrentIndex()}),this.validator){const t=this.validator.validateEntity(this.currentRecord);if(t&&t.length>0)if(this.publishEventErrors(t),t[0].fieldName){const s=x.t("archbase:errorSavingRecord",{dataSourceName:this.label});throw new g(s)}else throw new g(t[0].errorMessage)}try{this.currentRecord=await this.service.save(this.currentRecord),this.editing&&(this.filteredRecords[this.getCurrentIndex()]=this.currentRecord);let t=-1;this.records.forEach((s,r)=>{s===this.currentRecord&&(t=r)}),t>=0?this.records[t]=this.currentRecord:this.records.push(this.currentRecord),this.editing=!1,this.inserting=!1,this.lastDataChangedAt=new Date().getTime(),this.emitter.emit("afterSave",this.currentRecord),this.emit({type:S.afterSave,record:this.currentRecord,index:this.getCurrentIndex()}),e&&e()}catch(t){t.response&&t.response.data&&t.response.data.apierror&&t.response.data.apierror.subErrors&&t.response.data.apierror.subErrors.forEach(r=>{r.field&&(this.emitter.emit("onFieldError",r.field,r.message),this.emit({type:S.onFieldError,fieldName:r.field,error:r.message,originalError:r.message}))});const s=D(t);throw this.emitter.emit("onError",s,t),this.emit({type:S.onError,error:s,originalError:t}),e&&e(s),new g(s)}return this.currentRecord}async remove(e){if(this.validateDataSourceActive("remove"),this.inserting||this.editing){const t=x.t("archbase:removingRecordIsNotAllowed",{dataSourceName:this.name});throw this.publishEventError(t,{}),new g(t)}if(this.isEmpty()||!this.currentRecord){const t=x.t("archbase:noRecordsToEdit",{dataSourceName:this.name});throw this.publishEventError(t,{}),new g(t)}if(this.isBOF()){const t=x.t("archbase:BOFDataSource",{dataSourceName:this.name});throw this.publishEventError(t,{}),new g(t)}if(this.isEOF()){const t=x.t("archbase:EOFDataSource",{dataSourceName:this.name});throw this.publishEventError(t,{}),new g(t)}this.emitter.emit("beforeRemove",this.currentRecord,this.currentRecordIndex),this.emit({type:S.beforeRemove,record:this.currentRecord,index:this.getCurrentIndex()});try{await this.service.delete(this.service.getId(this.currentRecord));let t=-1;const s=this.currentRecord,r=this.currentRecordIndex;return this.records.forEach((l,i)=>{this.currentRecord===l&&(t=i)}),t>=0&&this.records.splice(t,1),this.filteredRecords.splice(this.getCurrentIndex(),1),this.grandTotalRecords--,this.filteredRecords.length===0?(this.currentRecord=void 0,this.currentRecordIndex=-1):(this.currentRecordIndex>this.filteredRecords.length-1&&this.currentRecordIndex--,this.currentRecord=this.filteredRecords[this.currentRecordIndex]),this.editing=!1,this.inserting=!1,this.emitter.emit("afterScroll"),this.emit({type:S.afterScroll}),this.emitter.emit("afterRemove",s,r),this.emit({type:S.afterRemove,record:s,index:r}),this.lastDataBrowsingOn=new Date().getTime(),this.lastDataChangedAt=new Date().getTime(),e&&e(),s}catch(t){const s=D(t);throw this.emitter.emit("onError",s,t),this.emit({type:S.onError,error:s,originalError:t}),e&&e(s),new g(s)}}applyRemoteFilter(e,t,s){return e&&e.filter.filterType===oe&&e.filter.quickFilterText&&e.filter.quickFilterText!==""?this.getDataWithQuickFilter(e,t):e&&(e.filter.filterType===he||e.filter.filterType===le)?this.getDataWithFilter(e,t):this.getDataWithoutFilter(t)}async getDataWithFilter(e,t){const s=new ue;s.buildFrom(e.filter,e.sort);const r=s.toJSON();let l;return r?l=await this.service.findAllWithFilter(s.toJSON(),t,this.getPageSize()):l=this.getDataWithoutFilter(t),l}getDataWithoutFilter(e){let t;return this.defaultSortFields.length>0?t=this.service.findAllWithSort(e,this.getPageSize(),this.defaultSortFields):t=this.service.findAll(e,this.getPageSize()),t}getDataWithQuickFilter(e,t){return this.service.findAllMultipleFields(e.filter.quickFilterText,e.filter.quickFilterFieldsText,t,this.getPageSize(),this.getSortFields(e))}getSortFields(e){return e&&e.sort?e.sort.quickFilterSort:this.defaultSortFields}}function Ne(n){const{name:e,label:t,service:s,filter:r,sort:l,transformData:i,onLoadComplete:m,onDestroy:C,filterData:P,findAll:Q,findAllWithSort:B,findAllWithFilter:_,findAllWithFilterAndSort:U,initialDataSource:L,pageSize:F=50,currentPage:q=0,loadOnStart:M=!0,store:I,id:j,validator:V}=n,k=()=>!!(I&&I.existsValue(e)||L),Z=()=>I&&I.existsValue(e)?I.getValue(e):L||new ce(s,e,{records:[],grandTotalRecords:0,currentPage:q,totalPages:0,pageSize:F,validator:V},t),$=()=>I&&I.existsValue(e)?I.getValue(e).getCurrentPage():L?L.getCurrentPage():0,[p,T]=Y.useState({dataSource:Z(),isLoading:!1,isError:!1,error:"",name:e,label:t,filter:r,sort:l,id:j,currentPage:$(),pageSize:F,loadDataCount:k()?1:0}),G=async(f,h,d,E,u,W,re,ie,ae)=>{let c;if(W){const w=await s.findOne(W);w?c=H.createFromValues([w],1,0,0,0):c=H.createFromValues([],0,0,0,0)}else U&&E&&u&&u.length>0?c=await U(E,h,d,u):_&&E?c=await _(E,h,d):B&&u&&u.length>0?c=await B(h,d,u):Q?c=await Q(h,d):E&&u&&u.length>0?c=await s.findAllWithFilterAndSort(E,h,d,u):E?c=await s.findAllWithFilter(E,h,d):u&&u.length>0?c=await s.findAllWithSort(h,d,u):c=await s.findAll(h,d);P&&(c=P(c)),i&&(c=i(c)),T(w=>{const J={records:c.content,grandTotalRecords:c.totalElements,totalPages:c.totalPages,currentPage:c.pageable.pageNumber,pageSize:d,filter:E,sort:u,originFilter:re,originGlobalFilter:ae,originSort:ie,validator:V};return w.dataSource.isActive()?w.dataSource.setData(J):w.dataSource.open(J),{...w,currentPage:h,pageSize:d,filter:E,sort:u,id:W,isLoading:!1,isError:!1,error:"",loadDataCount:w.loadDataCount+1}}),I&&I.setValue(e,p.dataSource),m&&m(p.dataSource)},z=f=>{if(f.type===S.refreshData){const h=f.options;try{T(d=>({...d,isLoading:!0,filter:h.filter,sort:h.sort,currentPage:h.currentPage})),G(p.name,h.currentPage,h.pageSize,h.filter,h.sort,p.id,h.originFilter,h.originSort,h.originGlobalFilter).catch(d=>{const E=D(d);T(u=>({...u,isError:!0,isLoading:!1,error:E})),n.onError&&n.onError(E,d)})}catch(d){const E=D(d);T(u=>({...u,isError:!0,isLoading:!1,error:E})),n.onError&&n.onError(E,d)}}},ee=f=>{f.addListener(z)},te=f=>{f.removeListener(z)};Y.useEffect(()=>{try{return ee(p.dataSource),M&&p.loadDataCount===0&&(T(f=>({...f,isLoading:!0})),G(p.name,q,F,p.filter,p.sort,p.id).catch(f=>{const h=D(f);T(d=>({...d,isError:!0,isLoading:!1,error:h})),n.onError&&n.onError(h,f)})),()=>{C&&(te(p.dataSource),C(p.dataSource))}}catch(f){const h=D(f);T(d=>({...d,isError:!0,isLoading:!1,error:h})),n.onError&&n.onError(h,f)}},[p.name,p.sort,p.filter,p.id,p.currentPage,p.pageSize]);const se=()=>{T(f=>({...f,isError:!1,isLoading:!1,error:""}))};return{isLoading:p.isLoading,isError:p.isError,error:p.error,dataSource:p.dataSource,clearError:se}}export{Ne as u};
//# sourceMappingURL=useArchbaseRemoteDataSource-5009e6f3.js.map
