import{j as l,a as Se}from"./jsx-runtime-c9381026.js";import{l as X}from"./lodash-4d0be66a.js";import{R as we,r as o}from"./index-8b3efc3f.js";import{b as De,d as xe,c as Pe}from"./useArchbaseDataSource-c192df6e.js";import"./index-9e992aa6.js";import{u as Fe,C as V,a as Ae,b as Ie}from"./Combobox-de7c8f4c.js";import{u as Re}from"./use-debounced-value-a36920eb.js";import{D as m}from"./useArchbaseDataSourceListener-a0bbc6ee.js";import{I as Te}from"./InputBase-3bc61936.js";import{L as _e}from"./Loader-5375ea1f.js";import{C as ze}from"./CloseButton-02fd9bf4.js";import{S as Le}from"./ScrollArea-9ec9a13f.js";const $=we.createContext({}),ke=$.Provider;function Y(s,i,n,a){return s?a?s.map(t=>({label:i(t),value:n(t),image:a(t),origin:t,key:X.uniqueId("select")})):s.map(t=>({label:i(t),value:n(t),origin:t,key:X.uniqueId("select")})):[]}function da({allowDeselect:s=!0,clearable:i=!0,dataSource:n,dataField:a,disabled:t=!1,debounceTime:E=500,minCharsToSearch:O=3,readOnly:A=!1,placeholder:ee,initialOptions:f={options:[],page:0,totalPages:0},searchable:Ne=!0,label:ae,description:ne,error:oe,icon:te,iconWidth:le,required:re,getOptionLabel:d,getOptionValue:I,getOptionImage:R,getOptions:ue,onFocusEnter:T,onFocusExit:_,onSelectValue:z,value:L,defaultValue:je,filter:Be,size:He,style:Me,width:se,initiallyOpened:Ue,itemComponent:k,onDropdownOpen:We,onDropdownClose:Qe,limit:N,nothingFound:Ze,zIndex:ie,dropdownPosition:de,onErrorLoadOptions:y,innerRef:ce,onSearchChange:j,converter:S,getConvertedOption:B}){const c=Fe({onDropdownClose:()=>c.resetSelectedOption()}),[w,H]=o.useState(Y(f.options,d,I,R)),[p,D]=o.useState(),[Ge,pe]=o.useState(0),[h,x]=o.useState(""),[u]=Re(h,E),[me,g]=o.useState(!1),[v,fe]=o.useState(f.page),[P,ye]=o.useState(f.totalPages),[Je,he]=o.useState(v===P-1),[ge,ve]=o.useState(f.options);ce||o.useRef();const[be,M]=o.useState(oe),b=async()=>{let e=L;n&&a&&(e=n.getFieldValue(a),e||(e=null)),B&&S&&e&&(e=await B(e)),D(e),x(d(e)||"")},U=o.useCallback(()=>{b()},[]),W=o.useCallback(e=>{n&&a&&((e.type===m.dataChanged||e.type===m.recordChanged||e.type===m.afterScroll||e.type===m.afterCancel)&&b(),e.type===m.beforeClose&&H([]),e.type===m.onFieldError&&e.fieldName===a&&M(e.error))},[]);De(()=>{b(),n&&a&&(n.addListener(W),n.addFieldChangeListener(a,U))}),xe(()=>{n&&a&&(n.removeListener(W),n.removeFieldChangeListener(a,U))}),o.useEffect(()=>{j&&j(u),u&&u.length>=O&&u!=d(p)&&(g(!0),Z(0,!1))},[u]),o.useEffect(()=>{},[v,P]),Pe(()=>{b()},[]),o.useEffect(()=>{M(void 0)},[L,p,u]);const Q=e=>S&&e?S(e):e,qe=e=>{D(J=>e),n&&!n.isBrowsing()&&a&&n.getFieldValue(a)!==Q(e)&&n.setFieldValue(a,Q(e)),z&&z(e)},Ve=e=>{_&&_(e)},Ce=e=>{T&&T(e)},Ee=()=>{u&&u.length>=O&&v<P-1&&(g(!0),Z(v+1,!0))},F=e=>{p||x(e)},Z=async(e,J=!1)=>{ue(e,u).then(r=>{g(!1),(r===void 0||r==null)&&y&&y("Response incorreto.");const K=J?ge.concat(r.options):r.options;ve(K),H(Y(K,d,I,R)),fe(r.page),ye(r.totalPages),he(r.page===r.totalPages-1),pe(Oe=>Oe+1)},r=>{g(!1),y&&y(r)})},G=()=>{let e=A;return n&&!A&&(e=n.isBrowsing()),e},q=w.every(e=>e!==h)?w.filter(e=>e.label.toLowerCase().includes(h.toLowerCase().trim())):w;return l(ke,{value:{handleDropdownScrollEnded:Ee},children:Se(V,{store:c,withinPortal:!0,position:de,zIndex:ie,onOptionSubmit:e=>{qe(e),F(d(e)),c.closeDropdown()},children:[l(Ae,{children:l(Te,{disabled:t,readOnly:G(),width:se,required:re,leftSection:te,leftSectionWidth:le,label:ae,description:ne,error:be,value:h,onChange:e=>{q.length>0&&c.openDropdown(),c.updateSelectedOptionIndex(),F(e.currentTarget.value)},onBlur:e=>{Ve(e),F(d(p)||"")},onFocus:e=>Ce(e),rightSection:me?l(_e,{size:"xs"}):p!==null?l(ze,{disabled:t,hidden:G(),size:"sm",onMouseDown:e=>e.preventDefault(),onClick:()=>{x(""),D(null)},"aria-label":"Clear value"}):l(V.Chevron,{}),onClick:()=>{q.length>0&&c.openDropdown()},rightSectionPointerEvents:p===null?"none":"all",placeholder:ee})}),l(Ie,{children:l(V.Options,{children:l(C,{mah:280,children:q.slice(0,N||q.length).map(e=>l(V.Option,{value:e.value,children:k?l(k,{...e}):e.label},e.key))})})})]})})}const C=o.forwardRef(({style:s,...i},n)=>{const a=o.useRef(),t=o.useContext($),E=O=>{a&&a.current&&a.current.scrollTop===a.current.scrollHeight-a.current.offsetHeight&&t.handleDropdownScrollEnded()};return l(Le.Autosize,{...i,style:{width:"100%",...s},viewportProps:{tabIndex:-1},viewportRef:a,onScrollPositionChange:E,children:i.children})});C.displayName="CustomSelectScrollArea";try{C.displayName="CustomSelectScrollArea",C.__docgenInfo={description:"",displayName:"CustomSelectScrollArea",props:{allowDeselect:{defaultValue:{value:"true"},description:"Permite ou não delecionar um item",name:"allowDeselect",required:!1,type:{name:"boolean"}},clearable:{defaultValue:{value:"true"},description:"Indicador se permite limpar o select",name:"clearable",required:!1,type:{name:"boolean"}},dataSource:{defaultValue:null,description:"Fonte de dados onde será atribuido o item selecionado",name:"dataSource",required:!1,type:{name:"ArchbaseDataSource<T, ID>"}},dataField:{defaultValue:null,description:"Campo onde deverá ser atribuido o item selecionado na fonte de dados",name:"dataField",required:!1,type:{name:"string"}},debounceTime:{defaultValue:{value:"500"},description:"Tempo de espero antes de realizar a busca",name:"debounceTime",required:!1,type:{name:"number"}},minCharsToSearch:{defaultValue:{value:"3"},description:"Minimo caracteres para busca",name:"minCharsToSearch",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"Indicador se o select está desabilitado",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:{value:"false"},description:"Indicador se o select é somente leitura. Obs: usado em conjunto com o status da fonte de dados",name:"readOnly",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:null,description:"Texto explicativo do select",name:"placeholder",required:!1,type:{name:"string"}},label:{defaultValue:null,description:"Título do select",name:"label",required:!1,type:{name:"string"}},description:{defaultValue:null,description:"Descrição do select",name:"description",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Último erro ocorrido no select",name:"error",required:!1,type:{name:"string"}},searchable:{defaultValue:{value:"true"},description:"Permite pesquisar no select",name:"searchable",required:!1,type:{name:"boolean"}},icon:{defaultValue:null,description:"Icon a esquerda do select",name:"icon",required:!1,type:{name:"ReactNode"}},iconWidth:{defaultValue:null,description:"Largura do icone a esquerda do select",name:"iconWidth",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},value:{defaultValue:null,description:"Valor de entrada controlado",name:"value",required:!1,type:{name:"any"}},defaultValue:{defaultValue:null,description:"Valor padrão de entrada não controlado",name:"defaultValue",required:!1,type:{name:"any"}},filter:{defaultValue:null,description:"Função com base em quais itens no menu suspenso são filtrados",name:"filter",required:!1,type:{name:"OptionsFilter"}},style:{defaultValue:null,description:"Estilo do select",name:"style",required:!1,type:{name:"CSSProperties"}},size:{defaultValue:null,description:"Tamanho do campo",name:"size",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},width:{defaultValue:null,description:"Largura do select",name:"width",required:!1,type:{name:"string | number"}},initiallyOpened:{defaultValue:null,description:"Estado aberto do menu suspenso inicial",name:"initiallyOpened",required:!1,type:{name:"boolean"}},itemComponent:{defaultValue:null,description:"Alterar renderizador de item",name:"itemComponent",required:!1,type:{name:"FC<any>"}},onDropdownOpen:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownOpen",required:!1,type:{name:"() => void"}},onDropdownClose:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownClose",required:!1,type:{name:"() => void"}},limit:{defaultValue:null,description:"Limite a quantidade de itens exibidos por vez para seleção pesquisável",name:"limit",required:!1,type:{name:"number"}},nothingFound:{defaultValue:null,description:"Rótulo nada encontrado",name:"nothingFound",required:!1,type:{name:"ReactNode"}},zIndex:{defaultValue:null,description:"Índice z dropdown",name:"zIndex",required:!1,type:{name:"ZIndex"}},dropdownPosition:{defaultValue:null,description:"Comportamento de posicionamento dropdown",name:"dropdownPosition",required:!1,type:{name:"enum",value:[{value:'"top"'},{value:'"right"'},{value:'"bottom"'},{value:'"left"'},{value:'"top-end"'},{value:'"top-start"'},{value:'"right-end"'},{value:'"right-start"'},{value:'"bottom-end"'},{value:'"bottom-start"'},{value:'"left-end"'},{value:'"left-start"'}]}},onSelectValue:{defaultValue:null,description:"Evento quando um valor é selecionado",name:"onSelectValue",required:!1,type:{name:"(value: O) => void"}},onFocusExit:{defaultValue:null,description:"Evento quando o foco sai do select",name:"onFocusExit",required:!1,type:{name:"FocusEventHandler<T>"}},onFocusEnter:{defaultValue:null,description:"Evento quando o select recebe o foco",name:"onFocusEnter",required:!1,type:{name:"FocusEventHandler<T>"}},initialOptions:{defaultValue:{value:"{ options: [], page: 0, totalPages: 0 }"},description:"Opções de seleção iniciais",name:"initialOptions",required:!1,type:{name:"OptionsResult<O>"}},getOptionLabel:{defaultValue:null,description:"Function que retorna o label de uma opção",name:"getOptionLabel",required:!0,type:{name:"(option: O) => string"}},getOptionValue:{defaultValue:null,description:"Function que retorna o valor de uma opção",name:"getOptionValue",required:!0,type:{name:"(option: O) => any"}},getOptionImage:{defaultValue:null,description:"Function que retorna a imagem de uma opção",name:"getOptionImage",required:!1,type:{name:"(option: O) => any"}},getOptions:{defaultValue:null,description:"Function responsável por retornar uma promessa contendo opções. Usado para buscar dados remotos.",name:"getOptions",required:!0,type:{name:"(page: number, value: string) => Promise<OptionsResult<O>>"}},onErrorLoadOptions:{defaultValue:null,description:"Evento quando ocorreu um erro carregando dados através da promessa fornecida por getOptions.",name:"onErrorLoadOptions",required:!1,type:{name:"(error: string) => void"}},required:{defaultValue:null,description:"Indica se o select tem o preenchimento obrigatório",name:"required",required:!1,type:{name:"boolean"}},innerRef:{defaultValue:null,description:"Referência para o componente interno",name:"innerRef",required:!1,type:{name:"RefObject<HTMLInputElement>"}},onSearchChange:{defaultValue:null,description:"Chamado sempre que o valor da pesquisa muda",name:"onSearchChange",required:!1,type:{name:"(query: string) => void"}},converter:{defaultValue:null,description:"Converte o valor antes de atribuir ao field do registro atual no datasource",name:"converter",required:!1,type:{name:"(value: O) => any"}},getConvertedOption:{defaultValue:null,description:"Function que busca o valor original antes de converter pelo valor de retorno do converter",name:"getConvertedOption",required:!1,type:{name:"(value: any) => Promise<O>"}}}}}catch{}export{da as A,C};
