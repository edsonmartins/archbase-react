import{j as u,a as A}from"./jsx-runtime-c9381026.js";import{r as b}from"./index-8b3efc3f.js";import{u as L,a as R}from"./useArchbaseDataSource-c5d317be.js";import{u as B,D as N}from"./useArchbaseDataSourceListener-92dd263c.js";import"./index-9e992aa6.js";import{g as U,V as y,a as v,I as G}from"./IsNotEmpty-d2b4946f.js";import{A as F,M as W}from"./ArchbaseMaskEdit-a7832614.js";import{p as J}from"./pessoasData-6b8000da.js";import{G as S}from"./Grid-7c641e6e.js";import{C as x}from"./Card-2d38024c.js";import{G as P}from"./Group-085e5d86.js";import{T}from"./Text-abd6ac62.js";import{B as H}from"./Button-b17c03b7.js";import{A as K}from"./ArchbaseNotifications-3bf0a446.js";import{A as Y}from"./ArchbaseObjectInspector-cc5955d4.js";import"./_commonjsHelpers-de833af9.js";import"./i18next-a4b2730f.js";import"./lodash-4d0be66a.js";import"./index-1905cc86.js";import"./index-d0400ba7.js";import"./input-30511812.js";import"./index-9d475cdf.js";import"./use-input-props-0d35260a.js";import"./polymorphic-factory-8fbd487e.js";import"./Mantine.context-1df84d45.js";import"./use-id-3df0f1f4.js";import"./use-isomorphic-effect-aa890e3d.js";import"./use-force-update-11fe72c1.js";import"./Input-77c95749.js";import"./create-optional-context-86e78b6c.js";import"./types-5decf4ed.js";import"./create-safe-context-941c9e18.js";import"./get-sorted-breakpoints-91e0685a.js";import"./px-90b8b31c.js";import"./Paper-c978ba1b.js";import"./Loader-279e7115.js";import"./Transition-1b2bc7c1.js";import"./index-a38d0dca.js";import"./use-reduced-motion-98306cff.js";import"./use-media-query-78751440.js";import"./use-did-update-bccd292e.js";import"./UnstyledButton-a7b3e9d9.js";import"./notifications.store-79c361f9.js";import"./store-704b6bc9.js";import"./IconBug-b91acd15.js";import"./createReactComponent-60e598cf.js";import"./use-mantine-color-scheme-bbd48c20.js";function q(e){return e instanceof Map?Array.from(e.values()):Array.isArray(e)?e:Array.from(e)}function I(e){return e!==null&&typeof e=="object"&&typeof e.then=="function"}class C{toString(t=!1,i=!1,r="",s=!1){const n=t?"\x1B[1m":"",o=t?"\x1B[22m":"",c=()=>(s?Object.values:Object.keys)(this.constraints??{}).join(", "),d=l=>` - property ${n}${r}${l}${o} has failed the following constraints: ${n}${c()}${o} 
`;if(i){const l=Number.isInteger(+this.property)?`[${this.property}]`:`${r?".":""}${this.property}`;return this.constraints?d(l):this.children?this.children.map(h=>h.toString(t,!0,`${r}${l}`,s)).join(""):""}else return`An instance of ${n}${this.target?this.target.constructor.name:"an object"}${o} has failed the validation:
`+(this.constraints?d(this.property):"")+(this.children?this.children.map(l=>l.toString(t,!0,this.property,s)).join(""):"")}}function z(e){return Array.isArray(e)?e.join(", "):(typeof e=="symbol"&&(e=e.description),`${e}`)}class Q{static replaceMessageSpecialTokens(t,i){let r;return t instanceof Function?r=t(i):typeof t=="string"&&(r=t),r&&Array.isArray(i.constraints)&&i.constraints.forEach((s,n)=>{r=r.replace(new RegExp(`\\$constraint${n+1}`,"g"),z(s))}),r&&i.value!==void 0&&i.value!==null&&["string","boolean","number"].includes(typeof i.value)&&(r=r.replace(/\$value/g,i.value)),r&&(r=r.replace(/\$property/g,i.property)),r&&(r=r.replace(/\$target/g,i.targetName)),r}}class ${constructor(t,i){this.validator=t,this.validatorOptions=i,this.awaitingPromises=[],this.ignoreAsyncValidations=!1,this.metadataStorage=U()}execute(t,i,r){var h,V;!this.metadataStorage.hasValidationMetaData&&((h=this.validatorOptions)==null?void 0:h.enableDebugMessages)===!0&&console.warn(`No validation metadata found. No validation will be  performed. There are multiple possible reasons:
  - There may be multiple class-validator versions installed. You will need to flatten your dependencies to fix the issue.
  - This validation runs before any file with validation decorator was parsed by NodeJS.`);const s=this.validatorOptions?this.validatorOptions.groups:void 0,n=this.validatorOptions&&this.validatorOptions.strictGroups||!1,o=this.validatorOptions&&this.validatorOptions.always||!1,c=((V=this.validatorOptions)==null?void 0:V.forbidUnknownValues)===void 0||this.validatorOptions.forbidUnknownValues!==!1,d=this.metadataStorage.getTargetValidationMetadatas(t.constructor,i,o,n,s),l=this.metadataStorage.groupByPropertyName(d);if(this.validatorOptions&&c&&!d.length){const a=new C;(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(a.target=t),a.value=void 0,a.property=void 0,a.children=[],a.constraints={unknownValue:"an unknown value was passed to the validate function"},r.push(a);return}this.validatorOptions&&this.validatorOptions.whitelist&&this.whitelist(t,l,r),Object.keys(l).forEach(a=>{const g=t[a],f=l[a].filter(p=>p.type===y.IS_DEFINED),m=l[a].filter(p=>p.type!==y.IS_DEFINED&&p.type!==y.WHITELIST);g instanceof Promise&&m.find(p=>p.type===y.PROMISE_VALIDATION)?this.awaitingPromises.push(g.then(p=>{this.performValidations(t,p,a,f,m,r)})):this.performValidations(t,g,a,f,m,r)})}whitelist(t,i,r){const s=[];Object.keys(t).forEach(n=>{(!i[n]||i[n].length===0)&&s.push(n)}),s.length>0&&(this.validatorOptions&&this.validatorOptions.forbidNonWhitelisted?s.forEach(n=>{const o=this.generateValidationError(t,t[n],n);o.constraints={[y.WHITELIST]:`property ${n} should not exist`},o.children=void 0,r.push(o)}):s.forEach(n=>delete t[n]))}stripEmptyErrors(t){return t.filter(i=>{if(i.children&&(i.children=this.stripEmptyErrors(i.children)),Object.keys(i.constraints).length===0){if(i.children.length===0)return!1;delete i.constraints}return!0})}performValidations(t,i,r,s,n,o){const c=n.filter(a=>a.type===y.CUSTOM_VALIDATION),d=n.filter(a=>a.type===y.NESTED_VALIDATION),l=n.filter(a=>a.type===y.CONDITIONAL_VALIDATION),h=this.generateValidationError(t,i,r);o.push(h),this.conditionalValidations(t,i,l)&&(this.customValidations(t,i,s,h),this.mapContexts(t,i,s,h),!(i===void 0&&this.validatorOptions&&this.validatorOptions.skipUndefinedProperties===!0)&&(i===null&&this.validatorOptions&&this.validatorOptions.skipNullProperties===!0||i==null&&this.validatorOptions&&this.validatorOptions.skipMissingProperties===!0||(this.customValidations(t,i,c,h),this.nestedValidations(i,d,h),this.mapContexts(t,i,n,h),this.mapContexts(t,i,c,h))))}generateValidationError(t,i,r){const s=new C;return(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.target===void 0||this.validatorOptions.validationError.target===!0)&&(s.target=t),(!this.validatorOptions||!this.validatorOptions.validationError||this.validatorOptions.validationError.value===void 0||this.validatorOptions.validationError.value===!0)&&(s.value=i),s.property=r,s.children=[],s.constraints={},s}conditionalValidations(t,i,r){return r.map(s=>s.constraints[0](t,i)).reduce((s,n)=>s&&n,!0)}customValidations(t,i,r,s){r.forEach(n=>{this.metadataStorage.getTargetValidatorConstraints(n.constraintCls).forEach(o=>{if(o.async&&this.ignoreAsyncValidations||this.validatorOptions&&this.validatorOptions.stopAtFirstError&&Object.keys(s.constraints||{}).length>0)return;const c={targetName:t.constructor?t.constructor.name:void 0,property:n.propertyName,object:t,value:i,constraints:n.constraints};if(!n.each||!(Array.isArray(i)||i instanceof Set||i instanceof Map)){const a=o.instance.validate(i,c);if(I(a)){const g=a.then(f=>{if(!f){const[m,p]=this.createValidationError(t,i,n,o);s.constraints[m]=p,n.context&&(s.contexts||(s.contexts={}),s.contexts[m]=Object.assign(s.contexts[m]||{},n.context))}});this.awaitingPromises.push(g)}else if(!a){const[g,f]=this.createValidationError(t,i,n,o);s.constraints[g]=f}return}const l=q(i).map(a=>o.instance.validate(a,c));if(l.some(a=>I(a))){const a=l.map(f=>I(f)?f:Promise.resolve(f)),g=Promise.all(a).then(f=>{if(!f.every(p=>p)){const[p,M]=this.createValidationError(t,i,n,o);s.constraints[p]=M,n.context&&(s.contexts||(s.contexts={}),s.contexts[p]=Object.assign(s.contexts[p]||{},n.context))}});this.awaitingPromises.push(g);return}if(!l.every(a=>a)){const[a,g]=this.createValidationError(t,i,n,o);s.constraints[a]=g}})})}nestedValidations(t,i,r){t!==void 0&&i.forEach(s=>{if(!(s.type!==y.NESTED_VALIDATION&&s.type!==y.PROMISE_VALIDATION)&&!(this.validatorOptions&&this.validatorOptions.stopAtFirstError&&Object.keys(r.constraints||{}).length>0))if(Array.isArray(t)||t instanceof Set||t instanceof Map)(t instanceof Set?Array.from(t):t).forEach((o,c)=>{this.performValidations(t,o,c.toString(),[],i,r.children)});else if(t instanceof Object){const n=typeof s.target=="string"?s.target:s.target.name;this.execute(t,n,r.children)}else{const[n,o]=this.createValidationError(s.target,t,s);r.constraints[n]=o}})}mapContexts(t,i,r,s){return r.forEach(n=>{if(n.context){let o;n.type===y.CUSTOM_VALIDATION&&(o=this.metadataStorage.getTargetValidatorConstraints(n.constraintCls)[0]);const c=this.getConstraintType(n,o);s.constraints[c]&&(s.contexts||(s.contexts={}),s.contexts[c]=Object.assign(s.contexts[c]||{},n.context))}})}createValidationError(t,i,r,s){const n=t.constructor?t.constructor.name:void 0,o=this.getConstraintType(r,s),c={targetName:n,property:r.propertyName,object:t,value:i,constraints:r.constraints};let d=r.message||"";!r.message&&(!this.validatorOptions||this.validatorOptions&&!this.validatorOptions.dismissDefaultMessages)&&s&&s.instance.defaultMessage instanceof Function&&(d=s.instance.defaultMessage(c));const l=Q.replaceMessageSpecialTokens(d,c);return[o,l]}getConstraintType(t,i){return i&&i.name?i.name:t.type}}class E{validate(t,i,r){return this.coreValidate(t,i,r)}async validateOrReject(t,i,r){const s=await this.coreValidate(t,i,r);if(s.length)return Promise.reject(s)}validateSync(t,i,r){const s=typeof t=="string"?i:t,n=typeof t=="string"?r:i,o=typeof t=="string"?t:void 0,c=new $(this,n);c.ignoreAsyncValidations=!0;const d=[];return c.execute(s,o,d),c.stripEmptyErrors(d)}coreValidate(t,i,r){const s=typeof t=="string"?i:t,n=typeof t=="string"?r:i,o=typeof t=="string"?t:void 0,c=new $(this,n),d=[];return c.execute(s,o,d),Promise.all(c.awaitingPromises).then(()=>c.stripEmptyErrors(d))}}function X(e,t,i){return typeof e=="string"?v(E).validate(e,t,i):v(E).validate(e,t)}function Z(e,t,i){return typeof e=="string"?v(E).validateOrReject(e,t,i):v(E).validateOrReject(e,t)}function j(e,t,i){return typeof e=="string"?v(E).validateSync(e,t,i):v(E).validateSync(e,t)}class tt{constructor(){}validateEntity(t){const i=j(t),r=[];return i.forEach(s=>{if(s.constraints)for(const[n,o]of Object.entries(s.constraints))r.push({errorMessage:o,debugMessage:`key: ${n} value: ${o}`,fieldName:s.property})}),r}validate(t,i){return X(t,i)}validateOrReject(t,i){return Z(t,i)}}const it=()=>{const[e,t]=b.useState();if(!e){const i=new tt;return t(i),i}return e};var st=Object.defineProperty,rt=Object.getOwnPropertyDescriptor,nt=(e,t,i,r)=>{for(var s=r>1?void 0:r?rt(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&st(t,i,s),s};const O=class{constructor(t){this.id=t.id,this.nome=t.nome,this.idade=t.idade,this.cpf=t.cpf,this.rg=t.rg,this.data_nasc=t.data_nasc,this.sexo=t.sexo,this.signo=t.signo,this.mae=t.mae,this.pai=t.pai,this.email=t.email,this.senha=t.senha,this.cep=t.cep,this.endereco=t.endereco,this.numero=t.numero,this.bairro=t.bairro,this.cidade=t.cidade,this.estado=t.estado,this.telefone_fixo=t.telefone_fixo,this.celular=t.celular,this.altura=t.altura,this.peso=t.peso,this.avaliacao=t.avaliacao,this.tipo_sanguineo=t.tipo_sanguineo,this.cor=t.cor,this.foto=t.foto,this.status=t.status,this.observacao=t.observacao,this.codigoJson=t.codigoJson,this.creditoOK=t.creditoOK}};O.newInstance=()=>new O({});nt([G({message:"CPF é obrigatório"})],O.prototype,"cpf",2);let et=O;const ot=()=>{const[e,t]=b.useState(!1),i=L(),r=it(),{dataSource:s}=R({initialData:at,validator:r,name:"dsPessoas"});return s!=null&&s.isBrowsing()&&!(s!=null&&s.isEmpty())&&s.edit(),B({dataSource:s,listener:n=>{switch(n.type){case N.fieldChanged:{i();break}}}}),A(S,{children:[u(S.Col,{offset:1,span:4,children:A(x,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[u(x.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:u(P,{justify:"space-between",children:u(T,{fw:500,children:"Mask Edit Component"})})}),u(F,{title:"CPF",dataSource:s,dataField:"cpf",mask:W.CPF,onChangeError:n=>t(!!n)}),u(H,{onClick:()=>{e||s.save(()=>{K.showSuccess("Sucesso","CPF salvo"),s.edit()})},children:"Salvar"})]})}),u(S.Col,{span:4,children:A(x,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[u(x.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:u(P,{justify:"space-between",children:u(T,{fw:500,children:"DataSource dsPessoas"})})}),u(Y,{data:s})]})})]})},at=[new et(J[0])],si={title:"Editores/Mask Edit",component:F},w={name:"Exemplo simples",render:()=>u(ot,{})};var D,_,k;w.parameters={...w.parameters,docs:{...(D=w.parameters)==null?void 0:D.docs,source:{originalSource:`{
  name: 'Exemplo simples',
  render: () => <ArchbaseEditExample />
}`,...(k=(_=w.parameters)==null?void 0:_.docs)==null?void 0:k.source}}};export{w as Primary,si as default};
