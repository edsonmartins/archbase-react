import{j as a,a as P}from"./jsx-runtime-c9381026.js";import{A as Le}from"./DemoIOCTypes-d657846a.js";import{b as ze,d as Be,c as Ne,u as je,a as ke}from"./useArchbaseDataSource-c5d317be.js";import{D as f,u as Ue}from"./useArchbaseDataSourceListener-92dd263c.js";import{u as Ge}from"./useArchbaseRemoteServiceApi-5974aa1a.js";import{l as ae}from"./lodash-4d0be66a.js";import{r as n}from"./index-8b3efc3f.js";import"./index-9e992aa6.js";import{A as He,a as Me}from"./ArchbaseAsyncSelect.context-0429ae81.js";import{u as We,C as D,a as Qe,b as Ze}from"./Combobox-77ce269d.js";import{u as Ye}from"./use-debounced-value-a36920eb.js";import{I as Je}from"./InputBase-8ff9b957.js";import{L as Ke}from"./Loader-ca6f2ca5.js";import{C as Xe}from"./CloseButton-cc9ab058.js";import{S as ue}from"./ScrollArea-d64d5d85.js";import{G as z}from"./Grid-8b653004.js";import{C as x}from"./Card-40454cf0.js";import{G as te}from"./Group-3f75be89.js";import{T as re}from"./Text-892c464b.js";import{B as $e}from"./polymorphic-factory-a4611e92.js";import{A as eo}from"./ArchbaseObjectInspector-4ab874a7.js";import{p as oo}from"./ArchbaseErrorHelper-1b9b234b.js";import{p as ao}from"./pedidosData-e328d4f3.js";import"./i18next-a4b2730f.js";import"./index-1905cc86.js";import"./index-d0400ba7.js";import"./_commonjsHelpers-de833af9.js";import"./Popover-3b96ff35.js";import"./OptionalPortal-2778d3e2.js";import"./index-a38d0dca.js";import"./use-isomorphic-effect-aa890e3d.js";import"./use-merged-ref-add91123.js";import"./DirectionProvider-1e219af7.js";import"./use-floating-auto-update-0ad8ad15.js";import"./use-did-update-bccd292e.js";import"./create-safe-context-941c9e18.js";import"./FocusTrap-03f7f7d2.js";import"./use-id-3df0f1f4.js";import"./Transition-fa62c8ad.js";import"./use-reduced-motion-98306cff.js";import"./use-media-query-78751440.js";import"./use-uncontrolled-f56237fb.js";import"./Input-4fafcb95.js";import"./create-optional-context-86e78b6c.js";import"./use-input-props-33fafcda.js";import"./UnstyledButton-a8273c7a.js";import"./get-sorted-breakpoints-e9679440.js";import"./px-90b8b31c.js";import"./Paper-3fe2af31.js";import"./Mantine.context-e727d900.js";import"./use-mantine-color-scheme-a3f41383.js";import"./types-5decf4ed.js";function ne(s,i,o,t){return s?t?s.map(r=>({label:i(r),value:o(r),image:t(r),origin:r,key:ae.uniqueId("select")})):s.map(r=>({label:i(r),value:o(r),origin:r,key:ae.uniqueId("select")})):[]}function de({allowDeselect:s=!0,clearable:i=!0,dataSource:o,dataField:t,disabled:r=!1,debounceTime:g=500,minCharsToSearch:h=3,readOnly:y=!1,placeholder:d,initialOptions:b={options:[],page:0,totalPages:0},searchable:lo=!0,label:ce,description:pe,error:me,icon:fe,iconWidth:he,required:ge,getOptionLabel:c,getOptionValue:B,getOptionImage:N,getOptions:ye,onFocusEnter:j,onFocusExit:k,onSelectValue:v,value:U,defaultValue:so,filter:io,size:uo,style:be,width:ve,initiallyOpened:co,itemComponent:G,onDropdownOpen:po,onDropdownClose:mo,limit:H,nothingFound:fo,zIndex:Ee,dropdownPosition:qe,onErrorLoadOptions:E,innerRef:Ce,onSearchChange:M,converter:I,getConvertedOption:W}){const p=We({onDropdownClose:()=>p.resetSelectedOption()}),[T,Q]=n.useState(ne(b.options,c,B,N)),[m,R]=n.useState(),[ho,Ve]=n.useState(0),[q,C]=n.useState(""),[u]=Ye(q,g),[we,V]=n.useState(!1),[w,Se]=n.useState(b.page),[_,Ae]=n.useState(b.totalPages),[go,De]=n.useState(w===_-1),[xe,Oe]=n.useState(b.options);Ce||n.useRef();const[Pe,Z]=n.useState(me),S=async()=>{let e=U;o&&t&&(e=o.getFieldValue(t),e||(e=null)),W&&I&&e&&(e=await W(e)),R(e),C(c(e)||"")},Y=n.useCallback(()=>{S()},[]),J=n.useCallback(e=>{o&&t&&((e.type===f.dataChanged||e.type===f.recordChanged||e.type===f.afterScroll||e.type===f.afterCancel)&&S(),e.type===f.beforeClose&&Q([]),e.type===f.onFieldError&&e.fieldName===t&&Z(e.error))},[]);ze(()=>{S(),o&&t&&(o.addListener(J),o.addFieldChangeListener(t,Y))}),Be(()=>{o&&t&&(o.removeListener(J),o.removeFieldChangeListener(t,Y))}),n.useEffect(()=>{M&&M(u),u&&u.length>=h&&u!==c(m)&&(V(!0),X(0,!1))},[u]),n.useEffect(()=>{},[w,_]),Ne(()=>{S()},[]),n.useEffect(()=>{Z(void 0)},[U,m,u]);const K=e=>I&&e?I(e):e,Fe=e=>{R(ee=>e),o&&!o.isBrowsing()&&t&&o.getFieldValue(t)!==K(e)&&o.setFieldValue(t,K(e)),v&&v(e)},Ie=e=>{k&&k(e)},Te=e=>{j&&j(e)},Re=()=>{u&&u.length>=h&&w<_-1&&(V(!0),X(w+1,!0))},L=e=>{m||C(e),e&&c(m)!==e&&e.length>=h&&p.openDropdown()},X=async(e,ee=!1)=>{ye(e,u).then(l=>{V(!1),(l===void 0||l==null)&&E&&E("Response incorreto.");const oe=ee?xe.concat(l.options):l.options;Oe(oe),Q(ne(oe,c,B,N)),Se(l.page),Ae(l.totalPages),De(l.page===l.totalPages-1),Ve(_e=>_e+1)},l=>{V(!1),E&&E(l)})},$=()=>{let e=y;return o&&!y&&(e=o.isBrowsing()),e},A=T.every(e=>e!==q)?T.filter(e=>e.label.toLowerCase().includes(q.toLowerCase().trim())):T;return a(He,{value:{handleDropdownScrollEnded:Re},children:P(D,{store:p,withinPortal:!0,position:qe,zIndex:Ee,onOptionSubmit:e=>{Fe(e),L(c(e)),p.closeDropdown()},children:[a(Qe,{children:a(Je,{disabled:r,readOnly:$(),style:be,w:ve,required:ge,leftSection:fe,leftSectionWidth:he,label:ce,description:pe,error:Pe,value:q,onChange:e=>{C(e.currentTarget.value),A.length>0&&p.openDropdown(),p.updateSelectedOptionIndex(),L(e.currentTarget.value)},onBlur:e=>{Ie(e),L(c(m)||"")},onFocus:e=>Te(e),rightSection:we?a(Ke,{size:"xs"}):m!==null&&i&&!r&&!$()?a(Xe,{size:"sm",onMouseDown:e=>e.preventDefault(),onClick:()=>{C(""),R(null),v&&v(null)},"aria-label":"Clear value"}):a(D.Chevron,{}),onClick:()=>{A.length>0&&p.openDropdown()},rightSectionPointerEvents:m===null?"none":"all",placeholder:d})}),a(Ze,{children:a(D.Options,{children:a(F,{mah:280,children:A.slice(0,H||A.length).map(e=>a(D.Option,{value:e.value,children:G?a(G,{...e}):e.label},e.key))})})})]})})}const F=n.forwardRef(({style:s,...i},o)=>{const t=n.useRef(),r=n.useContext(Me),g=h=>{t&&t.current&&t.current.scrollTop===t.current.scrollHeight-t.current.offsetHeight&&r.handleDropdownScrollEnded()};return a(ue.Autosize,{...i,style:{width:"100%",...s},viewportProps:{tabIndex:-1},viewportRef:t,onScrollPositionChange:g,children:i.children})});F.displayName="CustomSelectScrollArea";try{F.displayName="CustomSelectScrollArea",F.__docgenInfo={description:"",displayName:"CustomSelectScrollArea",props:{allowDeselect:{defaultValue:{value:"true"},description:"Permite ou não desselecionar um item",name:"allowDeselect",required:!1,type:{name:"boolean"}},clearable:{defaultValue:{value:"true"},description:"Indicador se permite limpar o select",name:"clearable",required:!1,type:{name:"boolean"}},dataSource:{defaultValue:null,description:"Fonte de dados onde será atribuido o item selecionado",name:"dataSource",required:!1,type:{name:"ArchbaseDataSource<T, ID>"}},dataField:{defaultValue:null,description:"Campo onde deverá ser atribuido o item selecionado na fonte de dados",name:"dataField",required:!1,type:{name:"string"}},debounceTime:{defaultValue:{value:"500"},description:"Tempo de espero antes de realizar a busca",name:"debounceTime",required:!1,type:{name:"number"}},minCharsToSearch:{defaultValue:{value:"3"},description:"Minimo caracteres para busca",name:"minCharsToSearch",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"Indicador se o select está desabilitado",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:{value:"false"},description:"Indicador se o select é somente leitura. Obs: usado em conjunto com o status da fonte de dados",name:"readOnly",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:null,description:"Texto explicativo do select",name:"placeholder",required:!1,type:{name:"string"}},label:{defaultValue:null,description:"Título do select",name:"label",required:!1,type:{name:"string"}},description:{defaultValue:null,description:"Descrição do select",name:"description",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Último erro ocorrido no select",name:"error",required:!1,type:{name:"string"}},searchable:{defaultValue:{value:"true"},description:"Permite pesquisar no select",name:"searchable",required:!1,type:{name:"boolean"}},icon:{defaultValue:null,description:"Icon a esquerda do select",name:"icon",required:!1,type:{name:"ReactNode"}},iconWidth:{defaultValue:null,description:"Largura do icone a esquerda do select",name:"iconWidth",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},value:{defaultValue:null,description:"Valor de entrada controlado",name:"value",required:!1,type:{name:"any"}},defaultValue:{defaultValue:null,description:"Valor padrão de entrada não controlado",name:"defaultValue",required:!1,type:{name:"any"}},filter:{defaultValue:null,description:"Função com base em quais itens no menu suspenso são filtrados",name:"filter",required:!1,type:{name:"OptionsFilter"}},style:{defaultValue:null,description:"Estilo do select",name:"style",required:!1,type:{name:"CSSProperties"}},size:{defaultValue:null,description:"Tamanho do campo",name:"size",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},width:{defaultValue:null,description:"Largura do select",name:"width",required:!1,type:{name:"string | number"}},initiallyOpened:{defaultValue:null,description:"Estado aberto do menu suspenso inicial",name:"initiallyOpened",required:!1,type:{name:"boolean"}},itemComponent:{defaultValue:null,description:"Alterar renderizador de item",name:"itemComponent",required:!1,type:{name:"FC<any>"}},onDropdownOpen:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownOpen",required:!1,type:{name:"() => void"}},onDropdownClose:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownClose",required:!1,type:{name:"() => void"}},limit:{defaultValue:null,description:"Limite a quantidade de itens exibidos por vez para seleção pesquisável",name:"limit",required:!1,type:{name:"number"}},nothingFound:{defaultValue:null,description:"Rótulo nada encontrado",name:"nothingFound",required:!1,type:{name:"ReactNode"}},zIndex:{defaultValue:null,description:"Índice z dropdown",name:"zIndex",required:!1,type:{name:"ZIndex"}},dropdownPosition:{defaultValue:null,description:"Comportamento de posicionamento dropdown",name:"dropdownPosition",required:!1,type:{name:"enum",value:[{value:'"top"'},{value:'"right"'},{value:'"bottom"'},{value:'"left"'},{value:'"top-end"'},{value:'"top-start"'},{value:'"right-end"'},{value:'"right-start"'},{value:'"bottom-end"'},{value:'"bottom-start"'},{value:'"left-end"'},{value:'"left-start"'}]}},onSelectValue:{defaultValue:null,description:"Evento quando um valor é selecionado",name:"onSelectValue",required:!1,type:{name:"(value: O) => void"}},onFocusExit:{defaultValue:null,description:"Evento quando o foco sai do select",name:"onFocusExit",required:!1,type:{name:"FocusEventHandler<T>"}},onFocusEnter:{defaultValue:null,description:"Evento quando o select recebe o foco",name:"onFocusEnter",required:!1,type:{name:"FocusEventHandler<T>"}},initialOptions:{defaultValue:{value:"{ options: [], page: 0, totalPages: 0 }"},description:"Opções de seleção iniciais",name:"initialOptions",required:!1,type:{name:"OptionsResult<O>"}},getOptionLabel:{defaultValue:null,description:"Function que retorna o label de uma opção",name:"getOptionLabel",required:!0,type:{name:"(option: O) => string"}},getOptionValue:{defaultValue:null,description:"Function que retorna o valor de uma opção",name:"getOptionValue",required:!0,type:{name:"(option: O) => any"}},getOptionImage:{defaultValue:null,description:"Function que retorna a imagem de uma opção",name:"getOptionImage",required:!1,type:{name:"(option: O) => any"}},getOptions:{defaultValue:null,description:"Function responsável por retornar uma promessa contendo opções. Usado para buscar dados remotos.",name:"getOptions",required:!0,type:{name:"(page: number, value: string) => Promise<OptionsResult<O>>"}},onErrorLoadOptions:{defaultValue:null,description:"Evento quando ocorreu um erro carregando dados através da promessa fornecida por getOptions.",name:"onErrorLoadOptions",required:!1,type:{name:"(error: string) => void"}},required:{defaultValue:null,description:"Indica se o select tem o preenchimento obrigatório",name:"required",required:!1,type:{name:"boolean"}},innerRef:{defaultValue:null,description:"Referência para o componente interno",name:"innerRef",required:!1,type:{name:"RefObject<HTMLInputElement>"}},onSearchChange:{defaultValue:null,description:"Chamado sempre que o valor da pesquisa muda",name:"onSearchChange",required:!1,type:{name:"(query: string) => void"}},converter:{defaultValue:null,description:"Converte o valor antes de atribuir ao field do registro atual no datasource",name:"converter",required:!1,type:{name:"(value: O) => any"}},getConvertedOption:{defaultValue:null,description:"Function que busca o valor original antes de converter pelo valor de retorno do converter",name:"getConvertedOption",required:!1,type:{name:"(value: any) => Promise<O>"}}}}}catch{}const to=ao,ro=10,no=()=>{const s=je(),i=Ge(Le.Pessoa),{dataSource:o}=ke({initialData:to,name:"dsPedidos"});o!=null&&o.isBrowsing()&&!(o!=null&&o.isEmpty())&&o.edit(),Ue({dataSource:o,listener:r=>{switch(r.type){case f.fieldChanged:{s();break}}}});const t=async(r,g)=>new Promise(async(h,y)=>{try{const d=await i.findAllWithFilter(g.trim(),r,ro);h({options:d.content,page:d.pageable.pageNumber,totalPages:d.totalPages})}catch(d){y(oo(d))}});return P(z,{children:[a(z.Col,{offset:1,span:6,children:P(x,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[a(x.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:a(te,{justify:"space-between",children:a(re,{fw:500,children:"AsyncSelect Component"})})}),a($e,{style:{height:100},children:a(de,{label:"Nome",dataSource:o,dataField:"cliente",getOptionLabel:r=>r&&r.nome,getOptionValue:r=>r,getOptions:t,minCharsToSearch:0})})]})}),a(z.Col,{span:4,children:P(x,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[a(x.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:a(te,{justify:"space-between",children:a(re,{fw:500,children:"DataSource dsPedidos"})})}),a(ue,{style:{height:500},children:a(eo,{data:o})})]})})]})},ya={title:"Editores/AsyncSelect",component:de},O={name:"Exemplo básico",render:()=>a(no,{})};var le,se,ie;O.parameters={...O.parameters,docs:{...(le=O.parameters)==null?void 0:le.docs,source:{originalSource:`{
  name: 'Exemplo básico',
  render: () => <ArchbaseAsyncSelectExample />
}`,...(ie=(se=O.parameters)==null?void 0:se.docs)==null?void 0:ie.source}}};export{O as Primary,ya as default};
