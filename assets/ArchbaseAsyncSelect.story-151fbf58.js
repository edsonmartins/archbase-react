import{j as t,a as O}from"./jsx-runtime-c9381026.js";import{A as ze}from"./DemoIOCTypes-d657846a.js";import{b as Be,d as Ne,c as je,u as ke,a as Ue}from"./useArchbaseDataSource-c5d317be.js";import{D as f,u as Ge}from"./useArchbaseDataSourceListener-92dd263c.js";import{u as He}from"./useArchbaseRemoteServiceApi-5974aa1a.js";import{l as te}from"./lodash-4d0be66a.js";import{R as Me,r as n}from"./index-8b3efc3f.js";import"./index-9e992aa6.js";import{u as We,C as D,a as Qe,b as Ze}from"./Combobox-d5a4e168.js";import{u as Ye}from"./use-debounced-value-a36920eb.js";import{I as Je}from"./InputBase-46c7ce5b.js";import{L as Ke}from"./Loader-a46c68a6.js";import{C as Xe}from"./Input-7a6e621e.js";import{S as ue}from"./ScrollArea-d2c70305.js";import{G as z}from"./Grid-93307f43.js";import{C as P}from"./Card-171745c8.js";import{G as ae}from"./Group-5b3c182b.js";import{T as re}from"./Text-70cb1fd9.js";import{B as $e}from"./polymorphic-factory-bf652503.js";import{A as eo}from"./ArchbaseObjectInspector-191de42c.js";import{p as oo}from"./ArchbaseErrorHelper-1b9b234b.js";import{p as to}from"./pedidosData-e328d4f3.js";import"./i18next-a4b2730f.js";import"./index-1905cc86.js";import"./index-d0400ba7.js";import"./_commonjsHelpers-de833af9.js";import"./Popover-f9771438.js";import"./OptionalPortal-8c3f6fc2.js";import"./Mantine.context-41afb47e.js";import"./index-a38d0dca.js";import"./use-isomorphic-effect-aa890e3d.js";import"./use-merged-ref-a374cf59.js";import"./use-resolved-styles-api-07b5b463.js";import"./DirectionProvider-1e219af7.js";import"./use-floating-auto-update-1c50c118.js";import"./use-did-update-bccd292e.js";import"./FocusTrap-c341c68f.js";import"./Transition-fcb0e8e9.js";import"./use-reduced-motion-73d958ef.js";import"./use-media-query-91643880.js";import"./create-safe-context-941c9e18.js";import"./noop-1bad6ac0.js";import"./use-uncontrolled-f56237fb.js";import"./use-id-f896cdc5.js";import"./use-input-props-5361677b.js";import"./create-optional-context-86e78b6c.js";import"./UnstyledButton-5ea781f1.js";import"./get-sorted-breakpoints-e9679440.js";import"./px-90b8b31c.js";import"./Paper-e7399838.js";import"./use-mantine-color-scheme-12883fe8.js";import"./types-5decf4ed.js";const de=Me.createContext({}),ao=de.Provider;function ne(s,i,o,a){return s?a?s.map(r=>({label:i(r),value:o(r),image:a(r),origin:r,key:te.uniqueId("select")})):s.map(r=>({label:i(r),value:o(r),origin:r,key:te.uniqueId("select")})):[]}function ce({allowDeselect:s=!0,clearable:i=!0,dataSource:o,dataField:a,disabled:r=!1,debounceTime:g=500,minCharsToSearch:h=3,readOnly:y=!1,placeholder:d,initialOptions:b={options:[],page:0,totalPages:0},searchable:so=!0,label:pe,description:me,error:fe,icon:he,iconWidth:ge,required:ye,getOptionLabel:c,getOptionValue:B,getOptionImage:N,getOptions:be,onFocusEnter:j,onFocusExit:k,onSelectValue:v,value:U,defaultValue:io,filter:uo,size:co,style:ve,width:Ee,initiallyOpened:po,itemComponent:G,onDropdownOpen:mo,onDropdownClose:fo,limit:H,nothingFound:ho,zIndex:qe,dropdownPosition:Ce,onErrorLoadOptions:E,innerRef:Ve,onSearchChange:M,converter:I,getConvertedOption:W}){const p=We({onDropdownClose:()=>p.resetSelectedOption()}),[R,Q]=n.useState(ne(b.options,c,B,N)),[m,T]=n.useState(),[go,we]=n.useState(0),[q,C]=n.useState(""),[u]=Ye(q,g),[Se,V]=n.useState(!1),[w,xe]=n.useState(b.page),[_,De]=n.useState(b.totalPages),[yo,Pe]=n.useState(w===_-1),[Ae,Oe]=n.useState(b.options);Ve||n.useRef();const[Fe,Z]=n.useState(fe),S=async()=>{let e=U;o&&a&&(e=o.getFieldValue(a),e||(e=null)),W&&I&&e&&(e=await W(e)),T(e),C(c(e)||"")},Y=n.useCallback(()=>{S()},[]),J=n.useCallback(e=>{o&&a&&((e.type===f.dataChanged||e.type===f.recordChanged||e.type===f.afterScroll||e.type===f.afterCancel)&&S(),e.type===f.beforeClose&&Q([]),e.type===f.onFieldError&&e.fieldName===a&&Z(e.error))},[]);Be(()=>{S(),o&&a&&(o.addListener(J),o.addFieldChangeListener(a,Y))}),Ne(()=>{o&&a&&(o.removeListener(J),o.removeFieldChangeListener(a,Y))}),n.useEffect(()=>{M&&M(u),u&&u.length>=h&&u!==c(m)&&(V(!0),X(0,!1))},[u]),n.useEffect(()=>{},[w,_]),je(()=>{S()},[]),n.useEffect(()=>{Z(void 0)},[U,m,u]);const K=e=>I&&e?I(e):e,Ie=e=>{T(ee=>e),o&&!o.isBrowsing()&&a&&o.getFieldValue(a)!==K(e)&&o.setFieldValue(a,K(e)),v&&v(e)},Re=e=>{k&&k(e)},Te=e=>{j&&j(e)},_e=()=>{u&&u.length>=h&&w<_-1&&(V(!0),X(w+1,!0))},L=e=>{m||C(e),e&&c(m)!==e&&e.length>=h&&p.openDropdown()},X=async(e,ee=!1)=>{be(e,u).then(l=>{V(!1),(l===void 0||l==null)&&E&&E("Response incorreto.");const oe=ee?Ae.concat(l.options):l.options;Oe(oe),Q(ne(oe,c,B,N)),xe(l.page),De(l.totalPages),Pe(l.page===l.totalPages-1),we(Le=>Le+1)},l=>{V(!1),E&&E(l)})},$=()=>{let e=y;return o&&!y&&(e=o.isBrowsing()),e},x=R.every(e=>e!==q)?R.filter(e=>e.label.toLowerCase().includes(q.toLowerCase().trim())):R;return t(ao,{value:{handleDropdownScrollEnded:_e},children:O(D,{store:p,withinPortal:!0,position:Ce,zIndex:qe,onOptionSubmit:e=>{Ie(e),L(c(e)),p.closeDropdown()},children:[t(Qe,{children:t(Je,{disabled:r,readOnly:$(),style:ve,w:Ee,required:ye,leftSection:he,leftSectionWidth:ge,label:pe,description:me,error:Fe,value:q,onChange:e=>{C(e.currentTarget.value),x.length>0&&p.openDropdown(),p.updateSelectedOptionIndex(),L(e.currentTarget.value)},onBlur:e=>{Re(e),L(c(m)||"")},onFocus:e=>Te(e),rightSection:Se?t(Ke,{size:"xs"}):m!==null&&i&&!r&&!$()?t(Xe,{size:"sm",onMouseDown:e=>e.preventDefault(),onClick:()=>{C(""),T(null),v&&v(null)},"aria-label":"Clear value"}):t(D.Chevron,{}),onClick:()=>{x.length>0&&p.openDropdown()},rightSectionPointerEvents:m===null?"none":"all",placeholder:d})}),t(Ze,{children:t(D.Options,{children:t(F,{mah:280,children:x.slice(0,H||x.length).map(e=>t(D.Option,{value:e.value,children:G?t(G,{...e}):e.label},e.key))})})})]})})}const F=n.forwardRef(({style:s,...i},o)=>{const a=n.useRef(),r=n.useContext(de),g=h=>{a&&a.current&&a.current.scrollTop===a.current.scrollHeight-a.current.offsetHeight&&r.handleDropdownScrollEnded()};return t(ue.Autosize,{...i,style:{width:"100%",...s},viewportProps:{tabIndex:-1},viewportRef:a,onScrollPositionChange:g,children:i.children})});F.displayName="CustomSelectScrollArea";try{F.displayName="CustomSelectScrollArea",F.__docgenInfo={description:"",displayName:"CustomSelectScrollArea",props:{allowDeselect:{defaultValue:{value:"true"},description:"Permite ou não desselecionar um item",name:"allowDeselect",required:!1,type:{name:"boolean"}},clearable:{defaultValue:{value:"true"},description:"Indicador se permite limpar o select",name:"clearable",required:!1,type:{name:"boolean"}},dataSource:{defaultValue:null,description:"Fonte de dados onde será atribuido o item selecionado",name:"dataSource",required:!1,type:{name:"ArchbaseDataSource<T, ID>"}},dataField:{defaultValue:null,description:"Campo onde deverá ser atribuido o item selecionado na fonte de dados",name:"dataField",required:!1,type:{name:"string"}},debounceTime:{defaultValue:{value:"500"},description:"Tempo de espero antes de realizar a busca",name:"debounceTime",required:!1,type:{name:"number"}},minCharsToSearch:{defaultValue:{value:"3"},description:"Minimo caracteres para busca",name:"minCharsToSearch",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"Indicador se o select está desabilitado",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:{value:"false"},description:"Indicador se o select é somente leitura. Obs: usado em conjunto com o status da fonte de dados",name:"readOnly",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:null,description:"Texto explicativo do select",name:"placeholder",required:!1,type:{name:"string"}},label:{defaultValue:null,description:"Título do select",name:"label",required:!1,type:{name:"string"}},description:{defaultValue:null,description:"Descrição do select",name:"description",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Último erro ocorrido no select",name:"error",required:!1,type:{name:"string"}},searchable:{defaultValue:{value:"true"},description:"Permite pesquisar no select",name:"searchable",required:!1,type:{name:"boolean"}},icon:{defaultValue:null,description:"Icon a esquerda do select",name:"icon",required:!1,type:{name:"ReactNode"}},iconWidth:{defaultValue:null,description:"Largura do icone a esquerda do select",name:"iconWidth",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},value:{defaultValue:null,description:"Valor de entrada controlado",name:"value",required:!1,type:{name:"any"}},defaultValue:{defaultValue:null,description:"Valor padrão de entrada não controlado",name:"defaultValue",required:!1,type:{name:"any"}},filter:{defaultValue:null,description:"Função com base em quais itens no menu suspenso são filtrados",name:"filter",required:!1,type:{name:"OptionsFilter"}},style:{defaultValue:null,description:"Estilo do select",name:"style",required:!1,type:{name:"CSSProperties"}},size:{defaultValue:null,description:"Tamanho do campo",name:"size",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},width:{defaultValue:null,description:"Largura do select",name:"width",required:!1,type:{name:"string | number"}},initiallyOpened:{defaultValue:null,description:"Estado aberto do menu suspenso inicial",name:"initiallyOpened",required:!1,type:{name:"boolean"}},itemComponent:{defaultValue:null,description:"Alterar renderizador de item",name:"itemComponent",required:!1,type:{name:"FC<any>"}},onDropdownOpen:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownOpen",required:!1,type:{name:"() => void"}},onDropdownClose:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownClose",required:!1,type:{name:"() => void"}},limit:{defaultValue:null,description:"Limite a quantidade de itens exibidos por vez para seleção pesquisável",name:"limit",required:!1,type:{name:"number"}},nothingFound:{defaultValue:null,description:"Rótulo nada encontrado",name:"nothingFound",required:!1,type:{name:"ReactNode"}},zIndex:{defaultValue:null,description:"Índice z dropdown",name:"zIndex",required:!1,type:{name:"ZIndex"}},dropdownPosition:{defaultValue:null,description:"Comportamento de posicionamento dropdown",name:"dropdownPosition",required:!1,type:{name:"enum",value:[{value:'"top"'},{value:'"right"'},{value:'"bottom"'},{value:'"left"'},{value:'"top-end"'},{value:'"top-start"'},{value:'"right-end"'},{value:'"right-start"'},{value:'"bottom-end"'},{value:'"bottom-start"'},{value:'"left-end"'},{value:'"left-start"'}]}},onSelectValue:{defaultValue:null,description:"Evento quando um valor é selecionado",name:"onSelectValue",required:!1,type:{name:"(value: O) => void"}},onFocusExit:{defaultValue:null,description:"Evento quando o foco sai do select",name:"onFocusExit",required:!1,type:{name:"FocusEventHandler<T>"}},onFocusEnter:{defaultValue:null,description:"Evento quando o select recebe o foco",name:"onFocusEnter",required:!1,type:{name:"FocusEventHandler<T>"}},initialOptions:{defaultValue:{value:"{ options: [], page: 0, totalPages: 0 }"},description:"Opções de seleção iniciais",name:"initialOptions",required:!1,type:{name:"OptionsResult<O>"}},getOptionLabel:{defaultValue:null,description:"Function que retorna o label de uma opção",name:"getOptionLabel",required:!0,type:{name:"(option: O) => string"}},getOptionValue:{defaultValue:null,description:"Function que retorna o valor de uma opção",name:"getOptionValue",required:!0,type:{name:"(option: O) => any"}},getOptionImage:{defaultValue:null,description:"Function que retorna a imagem de uma opção",name:"getOptionImage",required:!1,type:{name:"(option: O) => any"}},getOptions:{defaultValue:null,description:"Function responsável por retornar uma promessa contendo opções. Usado para buscar dados remotos.",name:"getOptions",required:!0,type:{name:"(page: number, value: string) => Promise<OptionsResult<O>>"}},onErrorLoadOptions:{defaultValue:null,description:"Evento quando ocorreu um erro carregando dados através da promessa fornecida por getOptions.",name:"onErrorLoadOptions",required:!1,type:{name:"(error: string) => void"}},required:{defaultValue:null,description:"Indica se o select tem o preenchimento obrigatório",name:"required",required:!1,type:{name:"boolean"}},innerRef:{defaultValue:null,description:"Referência para o componente interno",name:"innerRef",required:!1,type:{name:"RefObject<HTMLInputElement>"}},onSearchChange:{defaultValue:null,description:"Chamado sempre que o valor da pesquisa muda",name:"onSearchChange",required:!1,type:{name:"(query: string) => void"}},converter:{defaultValue:null,description:"Converte o valor antes de atribuir ao field do registro atual no datasource",name:"converter",required:!1,type:{name:"(value: O) => any"}},getConvertedOption:{defaultValue:null,description:"Function que busca o valor original antes de converter pelo valor de retorno do converter",name:"getConvertedOption",required:!1,type:{name:"(value: any) => Promise<O>"}}}}}catch{}const ro=to,no=10,lo=()=>{const s=ke(),i=He(ze.Pessoa),{dataSource:o}=Ue({initialData:ro,name:"dsPedidos"});o!=null&&o.isBrowsing()&&!(o!=null&&o.isEmpty())&&o.edit(),Ge({dataSource:o,listener:r=>{switch(r.type){case f.fieldChanged:{s();break}}}});const a=async(r,g)=>new Promise(async(h,y)=>{try{const d=await i.findAllWithFilter(g.trim(),r,no);h({options:d.content,page:d.pageable.pageNumber,totalPages:d.totalPages})}catch(d){y(oo(d))}});return O(z,{children:[t(z.Col,{offset:1,span:6,children:O(P,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[t(P.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:t(ae,{justify:"space-between",children:t(re,{fw:500,children:"AsyncSelect Component"})})}),t($e,{style:{height:100},children:t(ce,{label:"Nome",dataSource:o,dataField:"cliente",getOptionLabel:r=>r&&r.nome,getOptionValue:r=>r,getOptions:a,minCharsToSearch:0})})]})}),t(z.Col,{span:4,children:O(P,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[t(P.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:t(ae,{justify:"space-between",children:t(re,{fw:500,children:"DataSource dsPedidos"})})}),t(ue,{style:{height:500},children:t(eo,{data:o})})]})})]})},bt={title:"Editores/AsyncSelect",component:ce},A={name:"Exemplo básico",render:()=>t(lo,{})};var le,se,ie;A.parameters={...A.parameters,docs:{...(le=A.parameters)==null?void 0:le.docs,source:{originalSource:`{
  name: 'Exemplo básico',
  render: () => <ArchbaseAsyncSelectExample />
}`,...(ie=(se=A.parameters)==null?void 0:se.docs)==null?void 0:ie.source}}};export{A as Primary,bt as default};
