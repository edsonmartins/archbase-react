import{j as a,a as q}from"./jsx-runtime-29545a09.js";import{A as te}from"./DemoIOCTypes-d657846a.js";import{b as ne,c as le,d as se,u as ue,a as de}from"./useArchbaseDataSource-0bdc03a6.js";import{D as m,i as pe,u as ce}from"./useArchbaseDataSourceListener-cbed610e.js";import{u as me,p as fe}from"./useArchbaseRemoteServiceApi-05255476.js";import{A as he}from"./ArchbaseEdit-8e23860f.js";import{r as c}from"./index-76fb7be0.js";import{b as ye,B as Ee}from"./polymorphic-factory-e212381f.js";import{u as be}from"./use-mantine-color-scheme-940af2ab.js";import{T as ge}from"./TextInput-256f3fb5.js";import{T as ve}from"./Tooltip-6d7d1342.js";import{A as qe}from"./ActionIcon-23bc393d.js";import{I as Ve}from"./IconSearch-ce888152.js";import{f as V}from"./string-utils-e92dc4e1.js";import{G as L,C as A}from"./Grid-72b79d89.js";import{G as B}from"./Group-ec80c87c.js";import{T as j}from"./Text-052cbebe.js";import{F as Ae}from"./Flex-472ba316.js";import{S as Ce}from"./ScrollArea-d1e51cef.js";import{A as we}from"./ArchbaseObjectInspector-39e1a2c0.js";import{A as N}from"./ArchbaseNotifications-c6fc9152.js";import{p as xe}from"./pedidosData-e328d4f3.js";import"./i18next-a4b2730f.js";import"./lodash-4d0be66a.js";import"./_commonjsHelpers-de833af9.js";import"./index-83127612.js";import"./index-1076ae77.js";import"./use-force-update-df6d2b99.js";import"./Mantine.context-0732ca39.js";import"./use-media-query-404d9c84.js";import"./InputBase-b1a2e9dc.js";import"./Input-abb5d566.js";import"./create-optional-context-e52a7171.js";import"./use-id-9525279e.js";import"./use-isomorphic-effect-f46ba680.js";import"./use-input-props-0bcecfab.js";import"./OptionalPortal-d3ff2b4f.js";import"./index-d3ea75b5.js";import"./use-merged-ref-962e80ee.js";import"./DirectionProvider-3f93a9e9.js";import"./use-floating-auto-update-8b56efba.js";import"./use-did-update-4c7f685e.js";import"./Transition-7fd90e94.js";import"./use-reduced-motion-94535b68.js";import"./get-style-object-71cabcb5.js";import"./Loader-2934e180.js";import"./UnstyledButton-6bceb5b8.js";import"./createReactComponent-1d99d95b.js";import"./index-9d475cdf.js";import"./index-44ceb156.js";import"./Paper-9304c07a.js";import"./create-safe-context-978e3819.js";import"./get-sorted-breakpoints-91e0685a.js";import"./px-90b8b31c.js";import"./notifications.store-cc6c29fc.js";import"./store-8002eacc.js";import"./IconBug-81bb8ee5.js";import"./types-5decf4ed.js";function w({dataSource:o,dataField:n,lookupField:r,iconSearch:h,disabled:x=!1,readOnly:y=!1,style:k,placeholder:s,label:D,description:I,error:f,required:M,size:W,width:Y,lookupValueDelegator:T,onLookupError:u,onLookupResult:E,validateMessage:d,tooltipIconSearch:J="Clique aqui para Localizar",validateOnExit:O=!0,onFocusExit:P=()=>{},onFocusEnter:z=()=>{},onChangeValue:S=()=>{},onActionSearchExecute:K=()=>{},innerRef:Q}){const b=ye(),{colorScheme:X}=be(),[t,g]=c.useState(""),F=Q||c.useRef(),[Z,p]=c.useState(f);c.useEffect(()=>{p(void 0)},[t]);const v=()=>{let e=t;o&&r&&(e=o.getFieldValue(r),e||(e="")),g(e),p(void 0)},R=c.useCallback(()=>{v()},[]),_=c.useCallback(e=>{o&&n&&((e.type===m.dataChanged||e.type===m.recordChanged||e.type===m.afterScroll||e.type===m.afterCancel)&&v(),e.type===m.onFieldError&&e.fieldName===n&&p(e.error))},[]);ne(()=>{v(),o&&r&&(o.addListener(_),o.addFieldChangeListener(r,R))}),le(()=>{v()},[]),se(()=>{o&&n&&(o.removeListener(_),o.removeFieldChangeListener(n,R))});const $=e=>{p(void 0),e.preventDefault();const i=e.target.value;e.persist(),g(l=>i),S&&S(e,i)},ee=()=>{o&&n&&!o.isBrowsing()&&r?t!=o.getFieldValue(r)&&(!t||t==null?o.setFieldValue(n,null):T(t).then(i=>{(!i||i==null)&&O&&d&&u&&u(V(d,t)),E&&E(i),o.setFieldValue(n,i)}).catch(i=>{var l;o.setFieldValue(n,void 0),(l=F.current)==null||l.focus(),d&&p(V(d,t)),u&&u(i)})):t&&t!=null&&T(t).then(i=>{(!i||i==null)&&O&&d&&u&&u(V(d,t)),E&&E(i);let l=pe.getNestedProperty(i,r);l||(l=""),g(l)}).catch(i=>{var l;g(void 0),d&&p(V(d,t)),(l=F.current)==null||l.focus(),u&&u(i)})},oe=e=>{ee(),P&&P(e)},re=e=>{z&&z(e)},ae=()=>{let e=y;return o&&!y&&(e=o.isBrowsing()),e},ie=h||a(Ve,{size:"1rem"});return a(ge,{ref:F,disabled:x,readOnly:ae(),type:"text",value:t,required:M,onChange:$,onBlur:oe,onFocus:re,placeholder:s,description:I,label:D,error:Z,size:W,rightSection:a(ve,{withinPortal:!0,withArrow:!0,label:J,children:a(qe,{style:{backgroundColor:X==="dark"?b.colors[b.primaryColor][5]:b.colors[b.primaryColor][6]},tabIndex:-1,variant:"filled",onClick:K,children:ie})}),style:{width:Y,...k}})}try{w.displayName="ArchbaseLookupEdit",w.__docgenInfo={description:"",displayName:"ArchbaseLookupEdit",props:{dataSource:{defaultValue:null,description:"Fonte de dados onde será atribuido o valor do lookup edit",name:"dataSource",required:!1,type:{name:"ArchbaseDataSource<T, ID>"}},dataField:{defaultValue:null,description:"Campo onde deverá ser atribuido o valor do lookup edit na fonte de dados",name:"dataField",required:!1,type:{name:"string"}},lookupField:{defaultValue:null,description:"Campo da fonte de dados que será usado para apresentar o valor no lookup edit",name:"lookupField",required:!1,type:{name:"string"}},disabled:{defaultValue:{value:"false"},description:"Indicador se o lookup edit está desabilitado",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:{value:"false"},description:"Indicador se o lookup edit é somente leitura. Obs: usado em conjunto com o status da fonte de dados",name:"readOnly",required:!1,type:{name:"boolean"}},required:{defaultValue:null,description:"Indicador se o preenchimento do lookup edit é obrigatório",name:"required",required:!1,type:{name:"boolean"}},validateOnExit:{defaultValue:{value:"true"},description:"Validar ao sair do campo se localizou o valor",name:"validateOnExit",required:!1,type:{name:"boolean"}},validateMessage:{defaultValue:null,description:"Mensagem caso falhe ao localizar o valor",name:"validateMessage",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"Estilo do lookup edit",name:"style",required:!1,type:{name:"CSSProperties"}},size:{defaultValue:null,description:"Tamanho do campo",name:"size",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},width:{defaultValue:null,description:"Largura do lookup edit",name:"width",required:!1,type:{name:"string | number"}},placeholder:{defaultValue:null,description:"Texto sugestão do lookup edit",name:"placeholder",required:!1,type:{name:"string"}},label:{defaultValue:null,description:"Título do lookup edit",name:"label",required:!1,type:{name:"string"}},description:{defaultValue:null,description:"Descrição do lookup edit",name:"description",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Último erro ocorrido no lookup edit",name:"error",required:!1,type:{name:"string"}},iconSearch:{defaultValue:null,description:"Icone para apresentar lado direito do lookup edit que representa a busca",name:"iconSearch",required:!1,type:{name:"ReactNode"}},tooltipIconSearch:{defaultValue:{value:"Clique aqui para Localizar"},description:"Dica para botão localizar",name:"tooltipIconSearch",required:!1,type:{name:"string"}},onActionSearchExecute:{defaultValue:{value:"() => {}"},description:"Evento ocorre quando clica no botão localizar",name:"onActionSearchExecute",required:!1,type:{name:"() => void"}},onFocusExit:{defaultValue:{value:"() => {}"},description:"Evento quando o foco sai do lookup edit",name:"onFocusExit",required:!1,type:{name:"FocusEventHandler<T>"}},onFocusEnter:{defaultValue:{value:"() => {}"},description:"Evento quando o lookup edit recebe o foco",name:"onFocusEnter",required:!1,type:{name:"FocusEventHandler<T>"}},onChangeValue:{defaultValue:{value:"() => {}"},description:"Evento quando o valor do lookup edit é alterado",name:"onChangeValue",required:!1,type:{name:"(value: any, event: any) => void"}},onLookupResult:{defaultValue:null,description:"Evento ocorre quando um valor é localizado",name:"onLookupResult",required:!1,type:{name:"(value: O) => void"}},onLookupError:{defaultValue:null,description:"Evento ocorre quando se obtém um erro ao localizar valor",name:"onLookupError",required:!1,type:{name:"(error: string) => void"}},lookupValueDelegator:{defaultValue:null,description:"Função responsável por localizar um valor",name:"lookupValueDelegator",required:!0,type:{name:"(value: any) => Promise<O>"}},innerRef:{defaultValue:null,description:"Referência para o componente interno",name:"innerRef",required:!1,type:{name:"RefObject<HTMLInputElement>"}}}}}catch{}const ke=xe,De=()=>{const o=ue(),n=me(te.Pessoa),{dataSource:r}=de({initialData:ke,name:"dsPedidos"});r!=null&&r.isBrowsing()&&!(r!=null&&r.isEmpty())&&r.edit(),ce({dataSource:r,listener:s=>{switch(s.type){case m.fieldChanged:{o();break}}}});const h=s=>new Promise(async(D,I)=>{try{const f=await n.findOne(parseInt(s));D(f)}catch(f){I(fe(f))}}),x=s=>{N.showError(s,"Atenção")},y=s=>{},k=()=>{N.showError("Clicou ação localizar.","Atenção")};return q(L,{children:[a(L.Col,{offset:1,span:6,children:q(A,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[a(A.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:a(B,{justify:"space-between",children:a(j,{fw:500,children:"Lookup Edit Component"})})}),a(Ee,{style:{height:100},children:q(Ae,{justify:"flex-start",align:"center",direction:"row",wrap:"nowrap",gap:"xs",children:[a(w,{label:"Código",dataSource:r,dataField:"cliente",lookupField:"cliente.id",lookupValueDelegator:h,onLookupError:x,onLookupResult:y,onActionSearchExecute:k,validateOnExit:!0,required:!0,validateMessage:"Pessoa {0} não encontrada.",width:150}),a(he,{label:"Nome",dataSource:r,dataField:"cliente.nome",disabled:!0,width:500})]})})]})}),a(L.Col,{span:4,children:q(A,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[a(A.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:a(B,{justify:"space-between",children:a(j,{fw:500,children:"DataSource dsPedidos"})})}),a(Ce,{style:{height:500},children:a(we,{data:r})})]})})]})},Po={title:"Editores/Lookup Edit",component:w},C={name:"Exemplo simples",render:()=>a(De,{})};var G,U,H;C.parameters={...C.parameters,docs:{...(G=C.parameters)==null?void 0:G.docs,source:{originalSource:`{
  name: 'Exemplo simples',
  render: () => <ArchbaseLookupEditExample />
}`,...(H=(U=C.parameters)==null?void 0:U.docs)==null?void 0:H.source}}};export{C as Primary,Po as default};
