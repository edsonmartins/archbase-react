import{j as a,a as O}from"./jsx-runtime-c9381026.js";import{A as _e}from"./DemoIOCTypes-d657846a.js";import{b as Le,d as ze,c as Be,u as Ne,a as je}from"./useArchbaseDataSource-c5d317be.js";import{D as f,u as ke}from"./useArchbaseDataSourceListener-92dd263c.js";import{u as Ue}from"./useArchbaseRemoteServiceApi-5974aa1a.js";import{l as te}from"./lodash-4d0be66a.js";import{r as n}from"./index-8b3efc3f.js";import"./index-9e992aa6.js";import{A as We,a as Ge}from"./ArchbaseAsyncSelect.context-0429ae81.js";import{u as He,C as A,a as Me,b as Qe}from"./Combobox-77ce269d.js";import{u as Ze}from"./use-debounced-value-a36920eb.js";import{I as Ye}from"./InputBase-8ff9b957.js";import{L as Je}from"./Loader-ca6f2ca5.js";import{C as Ke}from"./CloseButton-cc9ab058.js";import{S as de}from"./ScrollArea-d64d5d85.js";import{G as L}from"./Grid-8b653004.js";import{C as D}from"./Card-40454cf0.js";import{G as re}from"./Group-3f75be89.js";import{T as ne}from"./Text-892c464b.js";import{B as Xe}from"./polymorphic-factory-a4611e92.js";import{A as $e}from"./ArchbaseObjectInspector-4ab874a7.js";import{p as eo}from"./ArchbaseErrorHelper-1b9b234b.js";import{p as oo}from"./pedidosData-e328d4f3.js";import"./i18next-a4b2730f.js";import"./index-1905cc86.js";import"./index-d0400ba7.js";import"./_commonjsHelpers-de833af9.js";import"./Popover-3b96ff35.js";import"./OptionalPortal-2778d3e2.js";import"./index-a38d0dca.js";import"./use-isomorphic-effect-aa890e3d.js";import"./use-merged-ref-add91123.js";import"./DirectionProvider-1e219af7.js";import"./use-floating-auto-update-0ad8ad15.js";import"./use-did-update-bccd292e.js";import"./create-safe-context-941c9e18.js";import"./FocusTrap-03f7f7d2.js";import"./use-id-3df0f1f4.js";import"./Transition-fa62c8ad.js";import"./use-reduced-motion-98306cff.js";import"./use-media-query-78751440.js";import"./use-uncontrolled-f56237fb.js";import"./Input-4fafcb95.js";import"./create-optional-context-86e78b6c.js";import"./use-input-props-33fafcda.js";import"./UnstyledButton-a8273c7a.js";import"./get-sorted-breakpoints-e9679440.js";import"./px-90b8b31c.js";import"./Paper-3fe2af31.js";import"./Mantine.context-e727d900.js";import"./use-mantine-color-scheme-a3f41383.js";import"./types-5decf4ed.js";function le(s,i,o,t){return s?t?s.map(r=>({label:i(r),value:o(r),image:t(r),origin:r,key:te.uniqueId("select")})):s.map(r=>({label:i(r),value:o(r),origin:r,key:te.uniqueId("select")})):[]}function ce({allowDeselect:s=!0,clearable:i=!0,dataSource:o,dataField:t,disabled:r=!1,debounceTime:y=500,minCharsToSearch:h=3,readOnly:g=!1,placeholder:d,initialOptions:b={options:[],page:0,totalPages:0},searchable:no=!0,label:pe,description:me,error:fe,icon:he,iconWidth:ye,required:ge,getOptionLabel:c,getOptionValue:z,getOptionImage:B,getOptions:be,onFocusEnter:N,onFocusExit:j,onSelectValue:k,value:U,defaultValue:lo,filter:so,size:io,style:uo,width:W,initiallyOpened:co,itemComponent:G,onDropdownOpen:po,onDropdownClose:mo,limit:H,nothingFound:fo,zIndex:ve,dropdownPosition:Ee,onErrorLoadOptions:v,innerRef:qe,onSearchChange:M,converter:F,getConvertedOption:Q}){const p=He({onDropdownClose:()=>p.resetSelectedOption()}),[I,Z]=n.useState(le(b.options,c,z,B)),[m,T]=n.useState(),[ho,Ce]=n.useState(0),[E,q]=n.useState(""),[u]=Ze(E,y),[Ve,C]=n.useState(!1),[V,we]=n.useState(b.page),[R,Se]=n.useState(b.totalPages),[yo,Ae]=n.useState(V===R-1),[De,xe]=n.useState(b.options);qe||n.useRef();const[Oe,Y]=n.useState(fe),w=async()=>{let e=U;o&&t&&(e=o.getFieldValue(t),e||(e=null)),Q&&F&&e&&(e=await Q(e)),T(e),q(c(e)||"")},J=n.useCallback(()=>{w()},[]),K=n.useCallback(e=>{o&&t&&((e.type===f.dataChanged||e.type===f.recordChanged||e.type===f.afterScroll||e.type===f.afterCancel)&&w(),e.type===f.beforeClose&&Z([]),e.type===f.onFieldError&&e.fieldName===t&&Y(e.error))},[]);Le(()=>{w(),o&&t&&(o.addListener(K),o.addFieldChangeListener(t,J))}),ze(()=>{o&&t&&(o.removeListener(K),o.removeFieldChangeListener(t,J))}),n.useEffect(()=>{M&&M(u),u&&u.length>=h&&u!==c(m)&&(C(!0),$(0,!1))},[u]),n.useEffect(()=>{},[V,R]),Be(()=>{w()},[]),n.useEffect(()=>{Y(void 0)},[U,m,u]);const X=e=>F&&e?F(e):e,Pe=e=>{T(oe=>e),o&&!o.isBrowsing()&&t&&o.getFieldValue(t)!==X(e)&&o.setFieldValue(t,X(e)),k&&k(e)},Fe=e=>{j&&j(e)},Ie=e=>{N&&N(e)},Te=()=>{u&&u.length>=h&&V<R-1&&(C(!0),$(V+1,!0))},_=e=>{m||q(e),e&&c(m)!==e&&e.length>=h&&p.openDropdown()},$=async(e,oe=!1)=>{be(e,u).then(l=>{C(!1),(l===void 0||l==null)&&v&&v("Response incorreto.");const ae=oe?De.concat(l.options):l.options;xe(ae),Z(le(ae,c,z,B)),we(l.page),Se(l.totalPages),Ae(l.page===l.totalPages-1),Ce(Re=>Re+1)},l=>{C(!1),v&&v(l)})},ee=()=>{let e=g;return o&&!g&&(e=o.isBrowsing()),e},S=I.every(e=>e!==E)?I.filter(e=>e.label.toLowerCase().includes(E.toLowerCase().trim())):I;return a(We,{value:{handleDropdownScrollEnded:Te},children:O(A,{store:p,withinPortal:!0,position:Ee,zIndex:ve,width:W,onOptionSubmit:e=>{Pe(e),_(c(e)),p.closeDropdown()},children:[a(Me,{children:a(Ye,{disabled:r,readOnly:ee(),style:{minWidth:W},required:ge,leftSection:he,leftSectionWidth:ye,label:pe,description:me,error:Oe,value:E,onChange:e=>{q(e.currentTarget.value),S.length>0&&p.openDropdown(),p.updateSelectedOptionIndex(),_(e.currentTarget.value)},onBlur:e=>{Fe(e),_(c(m)||"")},onFocus:e=>Ie(e),rightSection:Ve?a(Je,{size:"xs"}):m!==null&&i&&!r&&!ee()?a(Ke,{size:"sm",onMouseDown:e=>e.preventDefault(),onClick:()=>{q(""),T(null)},"aria-label":"Clear value"}):a(A.Chevron,{}),onClick:()=>{S.length>0&&p.openDropdown()},rightSectionPointerEvents:m===null?"none":"all",placeholder:d})}),a(Qe,{children:a(A.Options,{children:a(P,{mah:280,children:S.slice(0,H||S.length).map(e=>a(A.Option,{value:e.value,children:G?a(G,{...e}):e.label},e.key))})})})]})})}const P=n.forwardRef(({style:s,...i},o)=>{const t=n.useRef(),r=n.useContext(Ge),y=h=>{t&&t.current&&t.current.scrollTop===t.current.scrollHeight-t.current.offsetHeight&&r.handleDropdownScrollEnded()};return a(de.Autosize,{...i,style:{width:"100%",...s},viewportProps:{tabIndex:-1},viewportRef:t,onScrollPositionChange:y,children:i.children})});P.displayName="CustomSelectScrollArea";try{P.displayName="CustomSelectScrollArea",P.__docgenInfo={description:"",displayName:"CustomSelectScrollArea",props:{allowDeselect:{defaultValue:{value:"true"},description:"Permite ou não desselecionar um item",name:"allowDeselect",required:!1,type:{name:"boolean"}},clearable:{defaultValue:{value:"true"},description:"Indicador se permite limpar o select",name:"clearable",required:!1,type:{name:"boolean"}},dataSource:{defaultValue:null,description:"Fonte de dados onde será atribuido o item selecionado",name:"dataSource",required:!1,type:{name:"ArchbaseDataSource<T, ID>"}},dataField:{defaultValue:null,description:"Campo onde deverá ser atribuido o item selecionado na fonte de dados",name:"dataField",required:!1,type:{name:"string"}},debounceTime:{defaultValue:{value:"500"},description:"Tempo de espero antes de realizar a busca",name:"debounceTime",required:!1,type:{name:"number"}},minCharsToSearch:{defaultValue:{value:"3"},description:"Minimo caracteres para busca",name:"minCharsToSearch",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"Indicador se o select está desabilitado",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:{value:"false"},description:"Indicador se o select é somente leitura. Obs: usado em conjunto com o status da fonte de dados",name:"readOnly",required:!1,type:{name:"boolean"}},placeholder:{defaultValue:null,description:"Texto explicativo do select",name:"placeholder",required:!1,type:{name:"string"}},label:{defaultValue:null,description:"Título do select",name:"label",required:!1,type:{name:"string"}},description:{defaultValue:null,description:"Descrição do select",name:"description",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Último erro ocorrido no select",name:"error",required:!1,type:{name:"string"}},searchable:{defaultValue:{value:"true"},description:"Permite pesquisar no select",name:"searchable",required:!1,type:{name:"boolean"}},icon:{defaultValue:null,description:"Icon a esquerda do select",name:"icon",required:!1,type:{name:"ReactNode"}},iconWidth:{defaultValue:null,description:"Largura do icone a esquerda do select",name:"iconWidth",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},value:{defaultValue:null,description:"Valor de entrada controlado",name:"value",required:!1,type:{name:"any"}},defaultValue:{defaultValue:null,description:"Valor padrão de entrada não controlado",name:"defaultValue",required:!1,type:{name:"any"}},filter:{defaultValue:null,description:"Função com base em quais itens no menu suspenso são filtrados",name:"filter",required:!1,type:{name:"OptionsFilter"}},style:{defaultValue:null,description:"Estilo do select",name:"style",required:!1,type:{name:"CSSProperties"}},size:{defaultValue:null,description:"Tamanho do campo",name:"size",required:!1,type:{name:"enum",value:[{value:'"xs"'},{value:'"sm"'},{value:'"md"'},{value:'"lg"'},{value:'"xl"'}]}},width:{defaultValue:null,description:"Largura do select",name:"width",required:!1,type:{name:"string | number"}},initiallyOpened:{defaultValue:null,description:"Estado aberto do menu suspenso inicial",name:"initiallyOpened",required:!1,type:{name:"boolean"}},itemComponent:{defaultValue:null,description:"Alterar renderizador de item",name:"itemComponent",required:!1,type:{name:"FC<any>"}},onDropdownOpen:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownOpen",required:!1,type:{name:"() => void"}},onDropdownClose:{defaultValue:null,description:"Chamado quando o menu suspenso é aberto",name:"onDropdownClose",required:!1,type:{name:"() => void"}},limit:{defaultValue:null,description:"Limite a quantidade de itens exibidos por vez para seleção pesquisável",name:"limit",required:!1,type:{name:"number"}},nothingFound:{defaultValue:null,description:"Rótulo nada encontrado",name:"nothingFound",required:!1,type:{name:"ReactNode"}},zIndex:{defaultValue:null,description:"Índice z dropdown",name:"zIndex",required:!1,type:{name:"ZIndex"}},dropdownPosition:{defaultValue:null,description:"Comportamento de posicionamento dropdown",name:"dropdownPosition",required:!1,type:{name:"enum",value:[{value:'"top"'},{value:'"right"'},{value:'"bottom"'},{value:'"left"'},{value:'"top-end"'},{value:'"top-start"'},{value:'"right-end"'},{value:'"right-start"'},{value:'"bottom-end"'},{value:'"bottom-start"'},{value:'"left-end"'},{value:'"left-start"'}]}},onSelectValue:{defaultValue:null,description:"Evento quando um valor é selecionado",name:"onSelectValue",required:!1,type:{name:"(value: O) => void"}},onFocusExit:{defaultValue:null,description:"Evento quando o foco sai do select",name:"onFocusExit",required:!1,type:{name:"FocusEventHandler<T>"}},onFocusEnter:{defaultValue:null,description:"Evento quando o select recebe o foco",name:"onFocusEnter",required:!1,type:{name:"FocusEventHandler<T>"}},initialOptions:{defaultValue:{value:"{ options: [], page: 0, totalPages: 0 }"},description:"Opções de seleção iniciais",name:"initialOptions",required:!1,type:{name:"OptionsResult<O>"}},getOptionLabel:{defaultValue:null,description:"Function que retorna o label de uma opção",name:"getOptionLabel",required:!0,type:{name:"(option: O) => string"}},getOptionValue:{defaultValue:null,description:"Function que retorna o valor de uma opção",name:"getOptionValue",required:!0,type:{name:"(option: O) => any"}},getOptionImage:{defaultValue:null,description:"Function que retorna a imagem de uma opção",name:"getOptionImage",required:!1,type:{name:"(option: O) => any"}},getOptions:{defaultValue:null,description:"Function responsável por retornar uma promessa contendo opções. Usado para buscar dados remotos.",name:"getOptions",required:!0,type:{name:"(page: number, value: string) => Promise<OptionsResult<O>>"}},onErrorLoadOptions:{defaultValue:null,description:"Evento quando ocorreu um erro carregando dados através da promessa fornecida por getOptions.",name:"onErrorLoadOptions",required:!1,type:{name:"(error: string) => void"}},required:{defaultValue:null,description:"Indica se o select tem o preenchimento obrigatório",name:"required",required:!1,type:{name:"boolean"}},innerRef:{defaultValue:null,description:"Referência para o componente interno",name:"innerRef",required:!1,type:{name:"RefObject<HTMLInputElement>"}},onSearchChange:{defaultValue:null,description:"Chamado sempre que o valor da pesquisa muda",name:"onSearchChange",required:!1,type:{name:"(query: string) => void"}},converter:{defaultValue:null,description:"Converte o valor antes de atribuir ao field do registro atual no datasource",name:"converter",required:!1,type:{name:"(value: O) => any"}},getConvertedOption:{defaultValue:null,description:"Function que busca o valor original antes de converter pelo valor de retorno do converter",name:"getConvertedOption",required:!1,type:{name:"(value: any) => Promise<O>"}}}}}catch{}const ao=oo,to=10,ro=()=>{const s=Ne(),i=Ue(_e.Pessoa),{dataSource:o}=je({initialData:ao,name:"dsPedidos"});o!=null&&o.isBrowsing()&&!(o!=null&&o.isEmpty())&&o.edit(),ke({dataSource:o,listener:r=>{switch(r.type){case f.fieldChanged:{s();break}}}});const t=async(r,y)=>new Promise(async(h,g)=>{try{const d=await i.findAllWithFilter(y.trim(),r,to);h({options:d.content,page:d.pageable.pageNumber,totalPages:d.totalPages})}catch(d){g(eo(d))}});return O(L,{children:[a(L.Col,{offset:1,span:6,children:O(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[a(D.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:a(re,{justify:"space-between",children:a(ne,{fw:500,children:"AsyncSelect Component"})})}),a(Xe,{style:{height:100},children:a(ce,{label:"Nome",dataSource:o,dataField:"cliente",getOptionLabel:r=>r&&r.nome,getOptionValue:r=>r,getOptions:t,minCharsToSearch:0})})]})}),a(L.Col,{span:4,children:O(D,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[a(D.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:a(re,{justify:"space-between",children:a(ne,{fw:500,children:"DataSource dsPedidos"})})}),a(de,{style:{height:500},children:a($e,{data:o})})]})})]})},ga={title:"Editores/AsyncSelect",component:ce},x={name:"Exemplo básico",render:()=>a(ro,{})};var se,ie,ue;x.parameters={...x.parameters,docs:{...(se=x.parameters)==null?void 0:se.docs,source:{originalSource:`{
  name: 'Exemplo básico',
  render: () => <ArchbaseAsyncSelectExample />
}`,...(ue=(ie=x.parameters)==null?void 0:ie.docs)==null?void 0:ue.source}}};export{x as Primary,ga as default};
