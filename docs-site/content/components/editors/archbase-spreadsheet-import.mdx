import * as demos from '../../../demos/components/editors';

# ArchbaseSpreadsheetImport

`ArchbaseSpreadsheetImport` é um componente para importação de dados de arquivos CSV, XLSX e XLS, baseado na biblioteca `react-spreadsheet-import` (MIT License).

## Uso Básico

O componente abre um modal onde o usuário pode fazer upload de um arquivo de planilha e mapear as colunas antes da importação.

<Demo data={demos.spreadsheetImportUsage} />

## Campos Disponíveis

O componente suporta vários tipos de campos para validação e mapeamento:

```tsx
const campos = [
  // Campo de texto simples
  { key: 'nome', label: 'Nome Completo', required: true },

  // Campo numérico
  { key: 'preco', label: 'Preço', fieldType: 'number', required: true },

  // Campo select com opções
  {
    key: 'categoria',
    label: 'Categoria',
    fieldType: 'select',
    options: ['Eletrônicos', 'Roupas', 'Alimentos', 'Móveis']
  },

  // Campo booleano
  { key: 'ativo', label: 'Ativo', fieldType: 'boolean' },

  // Campo de e-mail
  { key: 'email', label: 'E-mail', fieldType: 'email', required: true },

  // Campo de data
  { key: 'dataNascimento', label: 'Data de Nascimento', fieldType: 'date' },
];
```

## Tipos de Campo

| Tipo | Descrição | Validação |
|------|-----------|-----------|
| `text` | Campo de texto padrão | - |
| `number` | Campo numérico | Validação de formato numérico |
| `email` | Campo de e-mail | Validação de formato de e-mail |
| `date` | Campo de data | Validação de formato de data |
| `boolean` | Campo booleano | Aceita `true/false`, `sim/nao`, `1/0` |
| `select` | Campo de seleção | Opções predefinidas |

## Mapeamento de Dados

Use a prop `mapRows` para transformar os dados da planilha no formato esperado pela sua aplicação:

```tsx
<ArchbaseSpreadsheetImport<Produto>
  isOpen={isOpen}
  onClose={() => setIsOpen(false)}
  fields={campos}
  mapRows={(rows) =>
    rows.map((row) => ({
      id: crypto.randomUUID(),
      nome: row.nome || '',
      preco: parseFloat(row.preco) || 0,
      categoria: row.categoria || 'Geral',
      ativo: row.ativo === true || row.ativo === 'sim' || row.ativo === 'true',
    }))
  }
  onDataLoaded={(data) => {
    console.log('Produtos importados:', data);
  }}
/>
```

## Com DataSource

A integração com DataSource permite adicionar automaticamente cada linha importada:

<Demo data={demos.spreadsheetImportWithDataSource} />

### Integração Completa

```tsx
import { ArchbaseSpreadsheetImport } from '@archbase/components';
import { ArchbaseDataSource, ArchbaseRemoteDelegate } from '@archbase/data';

const dataSource = new ArchbaseDataSource<Funcionario, string>(
  'funcionarios',
  delegate,
  initialState
);

<ArchbaseSpreadsheetImport<Funcionario>
  isOpen={isOpen}
  onClose={() => setIsOpen(false)}
  fields={campos}
  dataSource={dataSource}
  maxRows={1000}
  onRowAdded={async (row) => {
    // Cada linha é automaticamente adicionada ao DataSource
    await dataSource.create(row);
  }}
  onDataLoaded={async (data) => {
    // Após importar todas as linhas, recarrega o DataSource
    await dataSource.load();
  }}
  mapRows={(rows) => rows.map(mapFuncionario)}
/>
```

## Configurações

### Limite de Linhas

Controla o número máximo de linhas que podem ser importadas:

```tsx
<ArchbaseSpreadsheetImport
  maxRows={500}
  fields={campos}
/>
```

### Tamanho Máximo de Arquivo

Define o tamanho máximo do arquivo em bytes:

```tsx
<ArchbaseSpreadsheetImport
  maxFileSize={10 * 1024 * 1024} // 10MB
  fields={campos}
/>
```

### Tipos de Arquivo

Define quais formatos são aceitos:

```tsx
<ArchbaseSpreadsheetImport
  allowedFileTypes={['csv', 'xlsx', 'xls']}
  fields={campos}
/>
```

## Traduções

Customize os textos da interface:

```tsx
<ArchbaseSpreadsheetImport
  translations={{
    uploadStep: 'Carregar Arquivo',
    dragDrop: 'Arraste e solte seu arquivo aqui',
    supportedFormats: 'Formatos: CSV, XLSX, XLS',
    reviewStep: 'Revisar Dados',
    confirmStep: 'Confirmar Importação',
    successStep: 'Importação Completa',
    closeButton: 'Fechar',
  }}
  fields={campos}
/>
```

## Callbacks

| Prop | Descrição |
|------|-----------|
| `onDataLoaded` | Chamado após todas as linhas serem importadas |
| `onRowAdded` | Chamado para cada linha adicionada (com DataSource) |
| `onClose` | Chamado ao fechar o modal |

```tsx
<ArchbaseSpreadsheetImport
  onDataLoaded={(data) => {
    console.log('Linhas importadas:', data.length);
    notificationService.show({
      message: `${data.length} linhas importadas com sucesso!`,
      color: 'green',
    });
  }}
  onRowAdded={(row) => {
    console.log('Linha adicionada:', row);
  }}
  onClose={() => {
    console.log('Modal fechado');
  }}
/>
```

## Validação

O componente valida automaticamente os campos baseado nas configurações. Campos marcados como `required` exigem valores não vazios:

```tsx
const camposComValidacao = [
  {
    key: 'cpf',
    label: 'CPF',
    required: true,
    validations: {
      pattern: '\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}',
      errorMessage: 'CPF inválido',
    },
  },
];
```

## Exemplos Práticos

### Importação de Produtos

```tsx
interface Produto {
  id: string;
  nome: string;
  preco: number;
  estoque: number;
}

const camposProdutos = [
  { key: 'nome', label: 'Nome do Produto', required: true },
  { key: 'preco', label: 'Preço (R$)', fieldType: 'number', required: true },
  { key: 'estoque', label: 'Estoque', fieldType: 'number', required: true },
];

<ArchbaseSpreadsheetImport<Produto>
  isOpen={isImportOpen}
  onClose={() => setIsImportOpen(false)}
  title="Importar Catálogo de Produtos"
  description="Faça upload do arquivo com os produtos (CSV ou XLSX)"
  fields={camposProdutos}
  maxRows={1000}
  mapRows={(rows) =>
    rows.map((row) => ({
      id: crypto.randomUUID(),
      nome: row.nome,
      preco: parseFloat(row.preco) || 0,
      estoque: parseInt(row.estoque) || 0,
    }))
  }
  onDataLoaded={(produtos) => {
    produtoService.bulkCreate(produtos);
  }}
/>
```

### Importação de Clientes

```tsx
interface Cliente {
  id: string;
  nome: string;
  email: string;
  telefone: string;
  ativo: boolean;
}

const camposClientes = [
  { key: 'nome', label: 'Nome Completo', required: true },
  { key: 'email', label: 'E-mail', fieldType: 'email', required: true },
  { key: 'telefone', label: 'Telefone' },
  { key: 'ativo', label: 'Status', fieldType: 'boolean' },
];

<ArchbaseSpreadsheetImport<Cliente>
  isOpen={isOpen}
  fields={camposClientes}
  mapRows={(rows) =>
    rows.map((row) => ({
      id: crypto.randomUUID(),
      nome: row.nome,
      email: row.email?.toLowerCase(),
      telefone: row.telefone || '',
      ativo: row.ativo === true || row.ativo === 'sim',
    }))
  }
/>
```

## Acessibilidade

O componente segue as melhores práticas de acessibilidade:
- Interface responsiva para diferentes dispositivos
- Feedback visual durante o upload e processamento
- Mensagens de erro claras para arquivos inválidos
- Suporte a navegação por teclado

## Licença

Este componente utiliza a biblioteca `react-spreadsheet-import` sob a licença MIT.
