import * as demos from '../../../demos/components/editors';

## Uso Básico

`ArchbasePasswordEdit` é um campo de senha com botão para mostrar/ocultar o conteúdo, integração automática ao DataSource e suporte a validação.

<Demo data={demos.passwordEditUsage} />

## Estados

Diferentes estados visuais para feedback ao usuário:

<Demo data={demos.passwordEditStates} />

## Com DataSource

A integração com DataSource funciona automaticamente:

<Demo data={demos.passwordEditWithDataSource} />

### Como funciona

```tsx
<ArchbasePasswordEdit
  dataSource={dataSource}
  dataField="senha"
  label="Senha"
/>
```

O componente:
- **Em modo browse**: fica somente leitura automaticamente
- **Em modo edit/insert**: permite edição com toggle de visibilidade
- **Sincroniza**: valor bidirecional com o DataSource
- **Valida**: erros são exibidos automaticamente
- **Protege**: o valor nunca é exibido em texto plain no modo de visualização

## Segurança

### Toggle de Visibilidade

O componente inclui um botão para mostrar/ocultar a senha:

```tsx
<ArchbasePasswordEdit
  label="Senha"
  placeholder="Digite sua senha..."
/>
```

O ícone de "olho" permite ao usuário:
- **Ocultar** (padrão): mostra `••••••••`
- **Mostrar**: revela a senha digitada temporariamente

### Boas Práticas

1. **Sempre use HTTPS** em produção
2. **Valide no backend** - nunca confie apenas na validação frontend
3. **Use requisitos de complexidade** - exija letras, números e caracteres especiais
4. **Limite o tamanho** - senhas muito longas podem causar problemas
5. **Nunca log senhas** - em console, arquivos ou serviços externos

## Validação

Use decorators do `@archbase/core` para validação automática:

```tsx
import { IsNotEmpty, MinLength, Matches } from '@archbase/core';

class Usuario {
  @IsNotEmpty({ message: 'Senha é obrigatória' })
  @MinLength(8, { message: 'Senha deve ter pelo menos 8 caracteres' })
  @Matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/, {
    message: 'Senha deve conter letra maiúscula, minúscula, número e caractere especial'
  })
  senha: string;
}
```

### Regras Comuns de Senha

| Regra | Implementação |
|-------|---------------|
| Mínimo de caracteres | `@MinLength(8)` |
| Letra maiúscula | `@Matches(/.*[A-Z].*/)` |
| Letra minúscula | `@Matches(/.*[a-z].*/)` |
| Número | `@Matches(/.*\d.*/)` |
| Caractere especial | `@Matches(/.*[@$!%*?&].*/)` |

## Integração com Formulários

### Com ArchbaseFormTemplate

```tsx
import { ArchbaseFormTemplate, ArchbaseFormFieldPanel } from '@archbase/template';
import { ArchbasePasswordEdit } from '@archbase/components';

function FormularioSenha() {
  return (
    <ArchbaseFormTemplate
      dataSource={dataSource}
      onSave={handleSave}
      onCancel={handleCancel}
    >
      <ArchbaseFormFieldPanel>
        <ArchbasePasswordEdit
          dataSource={dataSource}
          dataField="senha"
          label="Senha"
          required
        />
        <ArchbasePasswordEdit
          dataSource={dataSource}
          dataField="confirmacaoSenha"
          label="Confirmar Senha"
          required
        />
      </ArchbaseFormFieldPanel>
    </ArchbaseFormTemplate>
  );
}
```

### Com React Hook Form

```tsx
import { useForm, Controller } from 'react-hook-form';
import { ArchbasePasswordEdit } from '@archbase/components';

function FormularioSenha() {
  const { control, handleSubmit, watch } = useForm();

  const onSubmit = (data) => {
    if (data.senha !== data.confirmacaoSenha) {
      alert('Senhas não conferem!');
      return;
    }
    // Enviar para o servidor
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <Controller
        name="senha"
        control={control}
        rules={{ required: 'Senha é obrigatória', minLength: 8 }}
        render={({ field }) => (
          <ArchbasePasswordEdit
            label="Senha"
            value={field.value}
            onChangeValue={field.onChange}
            error={errors.senha?.message}
          />
        )}
      />
      <Controller
        name="confirmacaoSenha"
        control={control}
        render={({ field }) => (
          <ArchbasePasswordEdit
            label="Confirmar Senha"
            value={field.value}
            onChangeValue={field.onChange}
          />
        )}
      />
    </form>
  );
}
```

## Acessibilidade

O `ArchbasePasswordEdit` segue as melhores práticas de acessibilidade:

- Labels associadas corretamente via `htmlFor`
- Tipo `password` no input HTML para segurança nativa
- Toggle de visibilidade acessível por teclado
- Erros anunciados via `aria-describedby`
- Campos obrigatórios indicados via `aria-required`
- Compatível com screen readers
- `aria-label` no botão de toggle

## Dicas de Performance

### DataSource V2

O DataSource V2 oferece otimizações de performance:

```tsx
// V2 detectado automaticamente
const { dataSource } = useArchbaseDataSourceV2<Usuario>({
  initialData: usuarios,
  name: 'dsUsuarios',
});

// O componente usa re-renders otimizados internamente
<ArchbasePasswordEdit dataSource={dataSource} dataField="senha" />
```

### Evite re-renders desnecessários

```tsx
// Ruim: cria nova função a cada render
<ArchbasePasswordEdit onChangeValue={(e, v) => setValue(v)} />

// Bom: callback estável
const handleChange = useCallback((e, v) => setValue(v), []);
<ArchbasePasswordEdit onChangeValue={handleChange} />
```

## Configurações Avançadas

### Forçar Senha Visível

```tsx
<ArchbasePasswordEdit
  label="Senha (visível por padrão)"
  defaultVisible={true}
/>
```

### Personalizar Placeholder

```tsx
<ArchbasePasswordEdit
  label="Senha"
  placeholder="Mínimo 8 caracteres com letras e números"
/>
```

### Descrição de Ajuda

```tsx
<ArchbasePasswordEdit
  label="Senha"
  description="Use letras maiúsculas, minúsculas, números e símbolos"
  required
/>
```

### Strength Indicator (Exemplo Customizado)

```tsx
import { Progress, Text } from '@mantine/core';

function PasswordWithStrength() {
  const [password, setPassword] = useState('');
  const [strength, setStrength] = useState(0);

  const calculateStrength = (pwd: string) => {
    let score = 0;
    if (pwd.length >= 8) score++;
    if (pwd.length >= 12) score++;
    if (/[A-Z]/.test(pwd)) score++;
    if (/[a-z]/.test(pwd)) score++;
    if (/\d/.test(pwd)) score++;
    if (/[^A-Za-z0-9]/.test(pwd)) score++;
    return (score / 6) * 100;
  };

  const handleChange = (value: string) => {
    setPassword(value);
    setStrength(calculateStrength(value));
  };

  return (
    <Stack>
      <ArchbasePasswordEdit
        label="Senha"
        value={password}
        onChangeValue={(e, v) => handleChange(v)}
      />
      <Progress value={strength} color={strength < 40 ? 'red' : strength < 80 ? 'yellow' : 'green'} />
      <Text size="xs">Força: {strength < 40 ? 'Fraca' : strength < 80 ? 'Média' : 'Forte'}</Text>
    </Stack>
  );
}
```
