
# ArchbaseDataGrid

O DataGrid é um componente avançado para exibição e manipulação de dados tabulares.

## Exemplo Básico

```tsx
import { ArchbaseDataGrid } from '@archbase/components';
import { useArchbaseDataSourceV2 } from '@archbase/data';

interface Pessoa {
  id: number;
  nome: string;
  email: string;
  idade: number;
}

function PessoasGrid() {
  const { dataSource } = useArchbaseDataSourceV2<Pessoa>({
    initialData: pessoas,
    name: 'pessoas-grid-ds',
  });

  return (
    <ArchbaseDataGrid
      dataSource={dataSource}
      columns={[
        { field: 'id', header: 'ID', width: 80 },
        { field: 'nome', header: 'Nome', width: 200 },
        { field: 'email', header: 'E-mail', width: 250 },
        { field: 'idade', header: 'Idade', width: 100 },
      ]}
      height={400}
    />
  );
}
```

## Props Principais

| Prop | Tipo | Padrão | Descrição |
|------|------|--------|-----------|
| `dataSource` | `ArchbaseDataSource<T>` | - | Fonte de dados |
| `columns` | `Column[]` | - | Definição das colunas |
| `height` | `number \| string` | `'auto'` | Altura do grid |
| `width` | `number \| string` | `'100%'` | Largura do grid |
| `selectable` | `boolean` | `true` | Permite seleção de linhas |
| `multiSelect` | `boolean` | `false` | Seleção múltipla |
| `striped` | `boolean` | `false` | Linhas zebradas |
| `highlightOnHover` | `boolean` | `true` | Destaca linha no hover |

## Definição de Colunas

```tsx
const columns = [
  {
    field: 'id',
    header: 'ID',
    width: 80,
    align: 'center',
    sortable: true,
  },
  {
    field: 'nome',
    header: 'Nome',
    width: 200,
    sortable: true,
    filterable: true,
  },
  {
    field: 'preco',
    header: 'Preço',
    width: 120,
    align: 'right',
    formatter: (value) => `R$ ${value.toFixed(2)}`,
  },
  {
    field: 'status',
    header: 'Status',
    width: 100,
    render: (record) => (
      <Badge color={record.status === 'ativo' ? 'green' : 'red'}>
        {record.status}
      </Badge>
    ),
  },
  {
    field: 'acoes',
    header: 'Ações',
    width: 100,
    render: (record) => (
      <Group>
        <ActionIcon onClick={() => handleEdit(record)}>
          <IconEdit size={16} />
        </ActionIcon>
        <ActionIcon color="red" onClick={() => handleDelete(record)}>
          <IconTrash size={16} />
        </ActionIcon>
      </Group>
    ),
  },
];
```

## Propriedades de Coluna

| Prop | Tipo | Descrição |
|------|------|-----------|
| `field` | `string` | Nome do campo no objeto |
| `header` | `string` | Título da coluna |
| `width` | `number` | Largura em pixels |
| `minWidth` | `number` | Largura mínima |
| `maxWidth` | `number` | Largura máxima |
| `align` | `'left' \| 'center' \| 'right'` | Alinhamento |
| `sortable` | `boolean` | Permite ordenação |
| `filterable` | `boolean` | Permite filtro |
| `resizable` | `boolean` | Permite redimensionar |
| `visible` | `boolean` | Visibilidade |
| `formatter` | `(value) => string` | Formatador de valor |
| `render` | `(record) => ReactNode` | Renderização customizada |

## Funcionalidades

### Ordenação

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  defaultSortField="nome"
  defaultSortDirection="asc"
  onSort={(field, direction) => {
    console.log(`Ordenar por ${field} ${direction}`);
  }}
/>
```

### Filtro

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  showFilter
  filterDelay={300}
  onFilter={(filters) => {
    console.log('Filtros aplicados:', filters);
  }}
/>
```

### Filtros Compostos (ArchbaseCompositeFilters)

O ArchbaseDataGrid suporta filtros compostos avançados através do `ArchbaseCompositeFilters`, gerando saída RSQL para integração com APIs REST.

```tsx
import { ArchbaseDataGrid } from '@archbase/components';
import type { ArchbaseFilterDefinition } from '@archbase/components';

const filterDefinitions: ArchbaseFilterDefinition[] = [
  { key: 'nome', label: 'Nome', type: 'text' },
  { key: 'idade', label: 'Idade', type: 'integer' },
  {
    key: 'status',
    label: 'Status',
    type: 'enum',
    options: [
      { value: 'ativo', label: 'Ativo' },
      { value: 'inativo', label: 'Inativo' },
    ],
  },
  { key: 'dataAdmissao', label: 'Data de Admissão', type: 'date' },
];

function GridComFiltros() {
  const [activeFilters, setActiveFilters] = useState([]);

  return (
    <ArchbaseDataGrid
      dataSource={dataSource}
      columns={columns}
      useCompositeFilters={true}
      filterDefinitions={filterDefinitions}
      activeFilters={activeFilters}
      onFiltersChange={(filters, rsql) => {
        setActiveFilters(filters);
        console.log('RSQL gerado:', rsql);
        /* Exemplo: "nome=like=*João*;idade>18;status==ativo" */
      }}
      hideMuiFilters={true}
    />
  );
}
```

#### Tipos de Dados Suportados

**Tipos de dados suportados pelo sistema de filtros:**

- **text** - Texto simples: `contains`, `starts_with`, `ends_with`, `=`, `!=`
- **integer** - Números inteiros: `=`, `!=`, `>`, `<`, `>=`, `<=`, `between`
- **float** - Números decimais: `=`, `!=`, `>`, `<`, `>=`, `<=`, `between`
- **currency** - Valores monetários: `=`, `!=`, `>`, `<`, `>=`, `<=`, `between`
- **boolean** - Verdadeiro/Falso: `=`, `!=`
- **date** - Data: `=`, `!=`, `>`, `<`, `>=`, `<=`, `date_before`, `date_after`
- **datetime** - Data e hora: `=`, `!=`, `>`, `<`, `>=`, `<=`, `date_before`, `date_after`
- **time** - Horário: `=`, `!=`, `>`, `<`, `>=`, `<=`
- **enum** - Lista de opções: `=`, `!=`, `in`, `not_in`
- **uuid** - Identificador único: `=`, `!=`

#### Auto-geração de Filtros

Se você não fornecer `filterDefinitions`, o DataGrid gera automaticamente a partir das colunas:

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  useCompositeFilters={true}
  // filterDefinitions será gerado automaticamente das colunas
/>
```

#### Quick Filters

Filtros pré-definidos podem ser configurados:

```tsx
const quickFilters = [
  {
    id: 'ativos',
    name: 'Usuários Ativos',
    filters: [
      { key: 'ativo', label: 'Status', type: 'boolean', operator: '=', value: true },
    ],
  },
];

<ArchbaseDataGrid
  useCompositeFilters={true}
  filterDefinitions={filterDefinitions}
  quickFilters={quickFilters}
/>
```

Veja a documentação completa de [ArchbaseCompositeFilters](/components/filters/archbase-composite-filters).

### Paginação

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  paginated
  pageSize={10}
  pageSizeOptions={[10, 25, 50, 100]}
  onPageChange={(page, pageSize) => {
    console.log(`Página ${page}, ${pageSize} registros`);
  }}
/>
```

### Seleção

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  selectable
  multiSelect
  selectedRows={selectedIds}
  onSelectionChange={(selected) => {
    setSelectedIds(selected);
  }}
/>
```

### Exportação

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  exportable
  exportFormats={['csv', 'excel', 'pdf']}
  exportFilename="relatorio-pessoas"
/>
```

## Toolbar Customizada

```tsx
<ArchbaseDataGrid
  dataSource={dataSource}
  columns={columns}
  toolbar={
    <Group>
      <Button onClick={handleNovo}>Novo</Button>
      <Button onClick={handleRefresh}>Atualizar</Button>
      <TextInput placeholder="Buscar..." />
    </Group>
  }
/>
```

## Exemplo Completo

```tsx
import { ArchbaseDataGrid } from '@archbase/components';
import { useArchbaseDataSourceV2 } from '@archbase/data';
import { Badge, ActionIcon, Group } from '@mantine/core';
import { IconEdit, IconTrash } from '@tabler/icons-react';

function ProdutosGrid() {
  const { dataSource, remove, goTo } = useArchbaseDataSourceV2<Produto>({
    initialData: produtos,
    name: 'produtos-ds',
  });

  const handleEdit = (record: Produto) => {
    const index = dataSource.data.findIndex(p => p.id === record.id);
    goTo(index);
    // Abrir modal de edição
  };

  const handleDelete = (record: Produto) => {
    if (confirm('Excluir este produto?')) {
      const index = dataSource.data.findIndex(p => p.id === record.id);
      goTo(index);
      remove();
    }
  };

  const columns = [
    { field: 'id', header: 'ID', width: 80, sortable: true },
    { field: 'nome', header: 'Nome', width: 200, sortable: true, filterable: true },
    {
      field: 'preco',
      header: 'Preço',
      width: 120,
      align: 'right' as const,
      formatter: (value: number) => `R$ ${value.toFixed(2)}`,
    },
    {
      field: 'status',
      header: 'Status',
      width: 100,
      render: (record: Produto) => (
        <Badge color={record.status === 'disponivel' ? 'green' : 'red'}>
          {record.status}
        </Badge>
      ),
    },
    {
      field: 'acoes',
      header: 'Ações',
      width: 100,
      render: (record: Produto) => (
        <Group gap="xs">
          <ActionIcon variant="subtle" onClick={() => handleEdit(record)}>
            <IconEdit size={16} />
          </ActionIcon>
          <ActionIcon variant="subtle" color="red" onClick={() => handleDelete(record)}>
            <IconTrash size={16} />
          </ActionIcon>
        </Group>
      ),
    },
  ];

  return (
    <ArchbaseDataGrid
      dataSource={dataSource}
      columns={columns}
      height={500}
      paginated
      pageSize={10}
      striped
      highlightOnHover
      exportable
    />
  );
}
```

## Próximos Passos

- [Listas](/components/data-display/lists) - TreeView, Masonry
- [Templates](/templates/grid-template) - Grid Template
