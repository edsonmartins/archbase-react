
# Migra√ß√£o do v2 para v3

Guia para migrar do Archbase React v2 para v3.

## Vis√£o Geral

<Card icon="üöÄ" title="Novidades do v3" color="blue">
  <strong>Archbase React v3</strong> traz uma arquitetura modular aprimorada, melhor performance e uma experi√™ncia de desenvolvimento ainda melhor.
  <ul>
    <li>Pacotes independentes para instala√ß√£o sob demanda</li>
    <li>Mantine 8 com suporte a React 19</li>
    <li>DataSource V2 com Immer para imutabilidade autom√°tica</li>
    <li>Typescript aprimorado em todo o ecossistema</li>
  </ul>
</Card>

## Principais Mudan√ßas

### 1. Pacotes Modulares

<Comparison left="v2 (Monol√≠tico)" right="v3 (Modular)">
  <Comparison.Row label="Estrutura" left="@archbase/archbase-react-components" right="@archbase/components, @archbase/data, etc." highlight="right" />
  <Comparison.Row label="Instala√ß√£o" left="Tudo junto" left="Apenas o necess√°rio" highlight="right" />
  <Comparison.Row label="Bundle Size" left="Maior" right="Menor (tree-shaking)" highlight="right" />
  <Comparison.Row label="Manuten√ß√£o" left="Complexo" right="Simplificado" highlight="right" />
</Comparison>

### 2. Imports Atualizados

<Comparison left="v2" right="v3">
  <Comparison.Row
    label="Componentes"
    left="@archbase/archbase-react-components"
    right="@archbase/components"
    highlight="both"
  />
  <Comparison.Row
    label="DataSource"
    left="@archbase/archbase-react-data"
    right="@archbase/data"
    highlight="both"
  />
  <Comparison.Row
    label="Layout"
    left="@archbase/archbase-react-layout"
    right="@archbase/layout"
    highlight="both"
  />
</Comparison>

```tsx
// v2
import { ArchbaseEdit } from '@archbase/archbase-react-components';

// v3
import { ArchbaseEdit } from '@archbase/components';
```

### 3. DataSource V2

O DataSource V2 √© totalmente compat√≠vel com v2, mas com melhorias significativas:

<Card icon="üîÑ" title="DataSource V2" color="green">
  <strong>Imutabilidade Autom√°tica:</strong> O V2 usa Immer internamente, garantindo que o estado nunca seja mutado acidentalmente.
</Card>

```tsx
// v2 e v3 - API compat√≠vel
const { dataSource, edit, save } = useArchbaseDataSourceV2<Pessoa>({
  initialData: dados,
  name: 'pessoas-ds',
});
```

<Details summary="Novidades do DataSource V2">
  <ul>
    <li><strong>Imutabilidade autom√°tica</strong> com Immer</li>
    <li><strong>Opera√ß√µes type-safe</strong> para arrays</li>
    <li><strong>Estados expl√≠citos</strong> (BROWSE, EDIT, INSERT)</li>
    <li><strong>Backup autom√°tico</strong> ao entrar em modo de edi√ß√£o</li>
    <li><strong>Performance otimizada</strong> com memoiza√ß√£o</li>
  </ul>
</Details>

### 4. Mantine 8

Atualiza√ß√£o do Mantine 7 para 8:

<CodeGroup>
  <CodeTab label="v2">
// Mantine 7
import { MantineProvider } from '@mantine/core';
import '@mantine/core/styles.css';
  </CodeTab>
  <CodeTab label="v3">
// Mantine 8 - mesmo API!
import { MantineProvider } from '@mantine/core';
import '@mantine/core/styles.css';
  </CodeTab>
</CodeGroup>

<Card icon="‚ú®" title="Mantine 8" color="purple">
  A migra√ß√£o √© transparente! A API do Mantine 8 √© praticamente id√™ntica √† do 7.
  <br /><br />
  Principais novidades:
  <ul>
    <li>Suporte nativo a React 19</li>
    <li>Performance melhorada</li>
    <li>Novos componentes</li>
    <li>Typescript aprimorado</li>
  </ul>
</Card>

## Checklist de Migra√ß√£o

<Card icon="‚úÖ" title="Checklist" color="green">
  Siga este checklist para garantir uma migra√ß√£o tranquila:
  <ol>
    <li>Atualizar imports para novos pacotes</li>
    <li>Verificar peer dependencies</li>
    <li>Atualizar Mantine para v8</li>
    <li>Testar componentes de formul√°rio</li>
    <li>Testar DataGrid</li>
    <li>Testar sistema de seguran√ßa</li>
  </ol>
</Card>

## Breaking Changes

<Details summary="Ver breaking changes detalhados">
  <table>
    <thead>
      <tr>
        <th>Componente</th>
        <th>Mudan√ßa</th>
        <th>A√ß√£o Necess√°ria</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>ArchbaseSelect</code></td>
        <td>Prop <code>options</code> renomeada para <code>data</code></td>
        <td>Renomear a prop</td>
      </tr>
      <tr>
        <td><code>ArchbaseModal</code></td>
        <td>Prop <code>visible</code> renomeada para <code>opened</code></td>
        <td>Renomear a prop</td>
      </tr>
      <tr>
        <td><code>ArchbaseAsyncSelect</code></td>
        <td>Prop <code>options</code> renomeada para <code>data</code></td>
        <td>Renomear a prop</td>
      </tr>
    </tbody>
  </table>
</Details>

## Exemplo Completo de Migra√ß√£o

<Details summary="Ver exemplo de migra√ß√£o">
  <strong>Antes (v2):</strong>
  ```tsx
  import { ArchbaseEdit } from '@archbase/archbase-react-components';
  import { ArchbaseSelect } from '@archbase/archbase-react-components';
  import { useArchbaseDataSourceV2 } from '@archbase/archbase-react-data';

  function PessoaForm() {
    const { dataSource, edit, save } = useArchbaseDataSourceV2<Pessoa>({
      initialData: dados,
      name: 'pessoas-ds',
    });

    return (
      <>
        <ArchbaseEdit dataSource={dataSource} dataField="nome" />
        <ArchbaseSelect
          dataSource={dataSource}
          dataField="cidade"
          options={cidades}
        />
      </>
    );
  }
  ```

  <strong>Depois (v3):</strong>
  ```tsx
  import { ArchbaseEdit } from '@archbase/components';
  import { ArchbaseSelect } from '@archbase/components';
  import { useArchbaseDataSourceV2 } from '@archbase/data';

  function PessoaForm() {
    const { dataSource, edit, save } = useArchbaseDataSourceV2<Pessoa>({
      initialData: dados,
      name: 'pessoas-ds',
    });

    return (
      <>
        <ArchbaseEdit dataSource={dataSource} dataField="nome" />
        <ArchbaseSelect
          dataSource={dataSource}
          dataField="cidade"
          data={cidades}  // Renomeado de 'options'
        />
      </>
    );
  }
  ```
</Details>

## Suporte

Em caso de problemas durante a migra√ß√£o:

<Card icon="üí¨" title="Precisa de Ajuda?" color="orange">
  <ul>
    <li>Abra uma <a href="https://github.com/edsonmartins/archbase-react/issues" target="_blank">issue no GitHub</a></li>
    <li>Consulte a <a href="/">documenta√ß√£o completa</a></li>
    <li>Veja os <a href="/components/overview">exemplos de componentes</a></li>
  </ul>
</Card>
